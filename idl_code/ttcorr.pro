pro ttcorr,hd,wav,flux,notime=notime,version=version,tcorr=tcorr,silent=silent,$
	wcorr=wcorr,time=time,notemp=notemp
;+
;
; 98jul17 - time and temperature correction for STIS low dispersion
; INPUT:
;	hd - stis header
;	wav - Instrumental. obs wavelength vector w/ heliocentric vel removed.
;	flux - vector to correct, eg NET or FLUX
;	notime - keyword: do not make time corr. (just temp corr)
;	notemp - do not make temp correction for tcorrel.pro
; OUTPUT:
;	flux - as corrected for time and/or temp changes
;	tcorr - keyword w/ value of temp correction
;	wcorr - the time correction, added by DJL
;	time - keyword: for time of obs.
; REFERENCE - Bohlin, R. 1999,Instrument Science Report, STIS 99-07.
; HISTORY
;	99dec7 - DJL, added version, corrections, time, and silent keyword
;		parameters, modified to work for Medium and Echelle
;	Jan 21, 2000 - DJL, modfied to use EXPSTART keyword when PSTRTIME is
;		missing
;	02jul23 - L-flat for G140L & 0.36 PX WL fix for G230L
;	06apr13 - install G430L and G750L L-flats (~negligible diffs)
;	14sep18 - add gwidth=11 time corrections for G750L.
;	14sep22 - add gwidth=11 temperture corrections for G750L.
;	2017jan27 - fix ttcorr for g750L tchange for ht=7 HZ43. Vega?
; 2019mar20 - add gwidth=11 corr for g230lb and g430L & use for all gwid>=11
; 	2019may9 - Switch to spline node fits to time change. Hgt=7 Not done, so
;		use hgt 11 results for odd hgt=7 processing, eg HZ43.
;-
	VERSION = 'Bohlin/Dec, 2019 ttcorr '

;G140L time change array
; 1175. 1225. 1275. 1325. 1375. 1425. 1475. 1525. 1575. 1625. 1675.
; Nodes: 1997.38   1999.20   2001.80   2004.00   2004.50   2009.50   2013.00
; 2016.00   2019.10
tc140l=[								$
;  1.114143,  1.074316,  1.004755,  0.965878,  0.959160,  0.940097,  0.921153, $
;  0.892941,  0.865632,  1.044697,  1.021319,  0.997855,  0.987456,  0.977098, $
;  0.988434,  0.971455,  0.973130,  0.957524,  1.038942,  1.022597,  0.994332, $
;  0.985452,  0.981506,  0.990289,  0.975015,  0.975650,  0.965846,  1.043744, $
;  1.028826,  0.992086,  0.980767,  0.977093,  0.983828,  0.971649,  0.969740, $
;  0.964516,  1.051049,  1.034946,  0.994503,  0.977083,  0.972228,  0.973901, $
;  0.965786,  0.960335,  0.953314,  1.074285,  1.047467,  0.992637,  0.971480, $
;  0.963754,  0.963764,  0.951455,  0.945762,  0.931733,  1.095026,  1.054927, $
;  0.992947,  0.965647,  0.958623,  0.949697,  0.942449,  0.935825,  0.918560, $
;  1.116278,  1.062346,  0.992879,  0.955813,  0.948763,  0.940857,  0.932057, $
;  0.928830,  0.902482,  1.121695,  1.065225,  0.987205,  0.951617,  0.946900, $
;  0.930379,  0.935318,  0.934035,  0.906248,  1.128722,  1.071873,  0.981400, $
;  0.949671,  0.942545,  0.928566,  0.931515,  0.933495,  0.898275,  1.099208, $
;  1.075878,  0.984139,  0.953878,  0.950204,  0.934493,  0.932993,  0.932016, $
;  0.896904]	; 2019aug
  1.115778,  1.075892,  1.006229,  0.967295,  0.960569,  0.941470,  0.922510, $
  0.894238,  0.866943,  1.045179,  1.021782,  0.998312,  0.987924,  0.977602, $
  0.988774,  0.972001,  0.973317,  0.958790,  1.039189,  1.022810,  0.994556, $
  0.985734,  0.981958,  0.990054,  0.975650,  0.974813,  0.969445,  1.044003, $
  1.029053,  0.992320,  0.981054,  0.977537,  0.983645,  0.972257,  0.969004, $
  0.967833,  1.051430,  1.035291,  0.994850,  0.977483,  0.972791,  0.973810, $
  0.966517,  0.959670,  0.956853,  1.074910,  1.048042,  0.993201,  0.972099, $
  0.964560,  0.963797,  0.952464,  0.945111,  0.936068,  1.095840,  1.055678, $
  0.993671,  0.966412,  0.959557,  0.949919,  0.943565,  0.935419,  0.922718, $
  1.117252,  1.063227,  0.993728,  0.956719,  0.949915,  0.940983,  0.933471, $
  0.928058,  0.908269,  1.122710,  1.066157,  0.988086,  0.952529,  0.947986, $
  0.930737,  0.936585,  0.933773,  0.910567,  1.129789,  1.072837,  0.982310, $
  0.950646,  0.943779,  0.928743,  0.933004,  0.932770,  0.904199,  1.100310, $
  1.076920,  0.985112,  0.954892,  0.951416,  0.934869,  0.934413,  0.931672, $
  0.901840]	; 2020jan
; G230L time change array 
; 1650. 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850.
; 2950. 3050.
; nodes: 1997.38   1998.60   1999.00   1999.20   1999.40   2002.60   2004.00
; 2004.50   2009.50   2011.20   2013.30   2015.60   2019.10
tc230l=[								$
;  1.020851,  1.034719,  1.038296,  1.042045,  1.040679,  0.985475,  0.981136, $
;  0.985408,  0.950172,  0.960551,  0.965229,  0.974747,  0.963735,  1.031009, $
;  1.045303,  1.047623,  1.048973,  1.047867,  0.978653,  0.968136,  0.966022, $
;  0.948526,  0.960265,  0.963181,  0.959464,  0.955430,  1.028801,  1.047093, $
;  1.054037,  1.055907,  1.054923,  0.978797,  0.969191,  0.969231,  0.950261, $
;  0.969031,  0.957182,  0.944206,  0.947561,  1.036015,  1.055118,  1.063424, $
;  1.066184,  1.064196,  0.977975,  0.969219,  0.971592,  0.953218,  0.968829, $
;  0.948411,  0.928378,  0.935520,  1.040794,  1.062478,  1.067026,  1.067163, $
;  1.065362,  0.977409,  0.971571,  0.973656,  0.952948,  0.963535,  0.943762, $
;  0.922956,  0.924833,  1.036760,  1.060951,  1.062391,  1.060401,  1.057723, $
;  0.983542,  0.975852,  0.975382,  0.956801,  0.961010,  0.948808,  0.931901, $
;  0.923921,  1.029369,  1.060922,  1.053987,  1.051864,  1.049911,  0.987375, $
;  0.979816,  0.977103,  0.958887,  0.957751,  0.954009,  0.936970,  0.929891, $
;  1.033447,  1.057052,  1.050856,  1.049736,  1.046588,  0.992807,  0.981600, $
;  0.980039,  0.958830,  0.959570,  0.952852,  0.938503,  0.932788,  1.038023, $
;  1.048840,  1.050122,  1.045281,  1.041804,  0.997610,  0.984053,  0.983903, $
;  0.957066,  0.961770,  0.952189,  0.942505,  0.929369,  1.035493,  1.042359, $
;  1.043463,  1.042379,  1.039002,  1.000605,  0.986370,  0.987685,  0.962585, $
;  0.966030,  0.954977,  0.947242,  0.933023,  1.026924,  1.040574,  1.038949, $
;  1.036341,  1.034035,  0.998648,  0.989144,  0.992673,  0.964733,  0.968877, $
;  0.960405,  0.953219,  0.939120,  1.023200,  1.036417,  1.037011,  1.034823, $
;  1.032492,  0.999972,  0.990651,  0.994783,  0.969713,  0.971174,  0.963078, $
;  0.955999,  0.942012,  1.020881,  1.034498,  1.032504,  1.029363,  1.027855, $
;  0.998055,  0.992462,  0.993997,  0.974500,  0.971651,  0.971031,  0.961172, $
;  0.947498,  1.017411,  1.034337,  1.029344,  1.030731,  1.028633,  1.001036, $
;  0.990274,  0.992261,  0.975897,  0.975035,  0.969143,  0.959937,  0.951138, $
;  1.014778,  1.032565,  1.029456,  1.028705,  1.026888,  0.999659,  0.992838, $
;  0.992158,  0.975756,  0.976746,  0.973830,  0.962679,  0.954328]  ;2019aug
  1.021203,  1.035075,  1.038657,  1.042414,  1.041046,  0.985817,  0.981472, $
  0.985736,  0.950659,  0.960738,  0.965810,  0.974634,  0.965427,  1.031489, $
  1.045790,  1.048111,  1.049462,  1.048356,  0.979110,  0.968588,  0.966473, $
  0.948946,  0.960733,  0.963597,  0.959973,  0.955691,  1.029330,  1.047632, $
  1.054579,  1.056450,  1.055466,  0.979301,  0.969690,  0.969731,  0.950739, $
  0.969539,  0.957659,  0.944718,  0.947967,  1.036699,  1.055815,  1.064128, $
  1.066889,  1.064900,  0.978620,  0.969860,  0.972243,  0.953740,  0.969567, $
  0.948868,  0.929296,  0.935214,  1.041586,  1.063286,  1.067838,  1.067975, $
  1.066173,  0.978152,  0.972310,  0.974402,  0.953616,  0.964320,  0.944390, $
  0.923820,  0.925046,  1.037527,  1.061736,  1.063176,  1.061185,  1.058506, $
  0.984270,  0.976572,  0.976093,  0.957594,  0.961644,  0.949643,  0.932351, $
  0.925332,  1.030109,  1.061685,  1.054744,  1.052619,  1.050665,  0.988085, $
  0.980521,  0.977806,  0.959548,  0.958465,  0.954652,  0.937720,  0.930329, $
  1.034154,  1.057775,  1.051575,  1.050454,  1.047304,  0.993486,  0.982271, $
  0.980710,  0.959475,  0.960234,  0.953489,  0.939171,  0.933346,  1.038720, $
  1.049543,  1.050819,  1.045960,  1.042484,  0.998277,  0.984712,  0.984540, $
  0.957885,  0.962252,  0.953107,  0.942630,  0.931524,  1.036167,  1.043037, $
  1.044142,  1.043056,  1.039678,  1.001257,  0.987010,  0.988313,  0.963364, $
  0.966521,  0.955835,  0.947431,  0.934925,  1.027561,  1.041219,  1.039594, $
  1.036983,  1.034676,  0.999268,  0.989757,  0.993281,  0.965404,  0.969412, $
  0.961114,  0.953606,  0.940322,  1.023792,  1.037017,  1.037610,  1.035421, $
  1.033089,  1.000551,  0.991224,  0.995351,  0.970379,  0.971642,  0.963796, $
  0.956261,  0.943437,  1.021374,  1.034998,  1.033002,  1.029859,  1.028351, $
  0.998538,  0.992939,  0.994458,  0.975152,  0.971958,  0.971780,  0.961130, $
  0.949488,  1.017957,  1.034890,  1.029901,  1.031301,  1.029200,  1.001575, $
  0.990805,  0.992803,  0.976355,  0.975620,  0.969559,  0.960642,  0.951076, $
  1.015267,  1.033061,  1.029952,  1.029201,  1.027383,  1.000140,  0.993316, $
  0.992638,  0.976204,  0.977235,  0.974266,  0.963201,  0.954609]  ;2020jan

; G230LB time change array
; 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850. 2950.
; nodes: 1997.38   1998.60   1999.00   1999.20   1999.40   2002.60   2004.00
; 2004.50   2009.50   2011.20   2013.30   2015.60   2019.10
tc230lb=[								$
;  1.089602,  1.091699,  1.095906,  1.094072,  1.091832,  1.010972,  1.000031, $
;  0.995348,  0.969595,  0.975684,  0.974407,  0.969818,  0.956441,  1.084264, $
;  1.096710,  1.106347,  1.105546,  1.103758,  1.013355,  1.003047,  1.000153, $
;  0.974838,  0.984219,  0.969274,  0.953445,  0.951786,  1.090140,  1.107491, $
;  1.114205,  1.113531,  1.111357,  1.015762,  1.006330,  1.003226,  0.981692, $
;  0.989470,  0.964570,  0.940689,  0.944617,  1.103275,  1.115628,  1.120189, $
;  1.117242,  1.113700,  1.017939,  1.008096,  1.005829,  0.984739,  0.985330, $
;  0.963296,  0.940055,  0.936291,  1.091812,  1.104144,  1.106518,  1.103602, $
;  1.100613,  1.020456,  1.011249,  1.008353,  0.981134,  0.982789,  0.966846, $
;  0.948121,  0.937868,  1.079428,  1.094948,  1.095119,  1.092080,  1.089420, $
;  1.022617,  1.013253,  1.010215,  0.979617,  0.979948,  0.968842,  0.955836, $
;  0.939229,  1.071330,  1.087065,  1.085043,  1.083058,  1.081045,  1.024448, $
;  1.014416,  1.011040,  0.979665,  0.980313,  0.970660,  0.958454,  0.941553, $
;  1.066578,  1.081329,  1.078888,  1.076970,  1.074838,  1.023759,  1.013549, $
;  1.011350,  0.982801,  0.981098,  0.971434,  0.961402,  0.944532,  1.059138, $
;  1.070244,  1.069484,  1.066747,  1.065020,  1.022377,  1.014502,  1.012032, $
;  0.985465,  0.982520,  0.974195,  0.964819,  0.949683,  1.051489,  1.061966, $
;  1.060187,  1.059435,  1.057930,  1.022084,  1.014477,  1.012272,  0.987216, $
;  0.984800,  0.975722,  0.967689,  0.953407,  1.048486,  1.057513,  1.056072, $
;  1.055363,  1.053966,  1.021863,  1.014287,  1.013156,  0.987644,  0.984462, $
;  0.977282,  0.969829,  0.955173,  1.050417,  1.055962,  1.054108,  1.052379, $
;  1.050887,  1.021587,  1.013878,  1.011918,  0.988595,  0.985138,  0.977521, $
;  0.970908,  0.956239,  1.050914,  1.052768,  1.050662,  1.049122,  1.048023, $
;  1.020113,  1.013487,  1.011539,  0.989027,  0.985307,  0.978567,  0.972600, $
;  0.958384]					; 2019 aug
  1.090522,  1.092619,  1.096831,  1.094998,  1.092754,  1.011826,  1.000872, $
  0.996196,  0.970328,  0.976639,  0.974983,  0.971068,  0.955945,  1.085305, $
  1.097765,  1.107413,  1.106615,  1.104823,  1.014331,  1.004006,  1.001134, $
  0.975597,  0.985448,  0.969685,  0.955281,  0.949935,  1.091247,  1.108616, $
  1.115338,  1.114668,  1.112491,  1.016796,  1.007348,  1.004263,  0.982529, $
  0.990731,  0.965080,  0.942475,  0.943079,  1.104478,  1.116846,  1.121413, $
  1.118465,  1.114918,  1.019051,  1.009194,  1.006936,  0.985728,  0.986541, $
  0.964096,  0.941524,  0.935981,  1.092972,  1.105318,  1.107694,  1.104776, $
  1.101784,  1.021541,  1.012323,  1.009431,  0.982123,  0.983918,  0.967718, $
  0.949405,  0.938036,  1.080622,  1.096160,  1.096332,  1.093293,  1.090629, $
  1.023750,  1.014372,  1.011342,  0.980626,  0.981152,  0.969693,  0.957283, $
  0.939097,  1.072477,  1.088229,  1.086206,  1.084220,  1.082203,  1.025546, $
  1.015500,  1.012131,  0.980640,  0.981480,  0.971483,  0.959864,  0.941408, $
  1.067675,  1.082443,  1.079999,  1.078082,  1.075946,  1.024815,  1.014591, $
  1.012400,  0.983737,  0.982230,  0.972211,  0.962785,  0.944321,  1.060176, $
  1.071294,  1.070534,  1.067798,  1.066068,  1.023382,  1.015494,  1.013037, $
  0.986323,  0.983657,  0.974831,  0.966331,  0.948914,  1.052445,  1.062932, $
  1.061152,  1.060403,  1.058895,  1.023015,  1.015398,  1.013204,  0.988015, $
  0.985853,  0.976319,  0.969081,  0.952732,  1.049443,  1.058477,  1.057037, $
  1.056330,  1.054930,  1.022797,  1.015209,  1.014093,  0.988422,  0.985555, $
  0.977814,  0.971347,  0.954137,  1.051314,  1.056864,  1.055009,  1.053282, $
  1.051787,  1.022461,  1.014741,  1.012791,  0.989352,  0.986117,  0.978101, $
  0.972187,  0.955704,  1.051789,  1.053646,  1.051539,  1.050000,  1.048899, $
  1.020965,  1.014330,  1.012393,  0.989752,  0.986286,  0.979091,  0.973925, $
  0.957636]					; 2020jan
 
; G430L time change array:
; 3000. 3200. 3400. 3600. 3800. 4000. 4200. 4400. 4600. 4800. 5000. 5200. 5400.
; 5600.
; nodes: 1997.38   1999.00   2004.00   2004.50   2009.50   2012.00   2014.50
; 2015.50   2018.00   2019.10
tc430l=[								$ 
;  1.025021,  1.026869,  1.006280,  1.007278,  0.995830,  0.991780,  0.987736, $
;  0.986489,  0.976331,  0.975020,  1.030890,  1.031205,  1.007505,  1.007365, $
;  0.995672,  0.989319,  0.984770,  0.981912,  0.972950,  0.971054,  1.030984, $
;  1.029072,  1.008249,  1.008021,  0.996157,  0.989123,  0.984983,  0.982860, $
;  0.974006,  0.972359,  1.032173,  1.026936,  1.008131,  1.007640,  0.996779, $
;  0.989758,  0.985788,  0.984342,  0.975343,  0.973184,  1.031319,  1.027638, $
;  1.008224,  1.007702,  0.995065,  0.989146,  0.985555,  0.983955,  0.975792, $
;  0.974179,  1.029767,  1.025779,  1.008600,  1.007947,  0.995330,  0.989705, $
;  0.986110,  0.984398,  0.976691,  0.973961,  1.030866,  1.026309,  1.008614, $
;  1.008077,  0.995203,  0.989303,  0.985766,  0.983855,  0.976916,  0.975075, $
;  1.031523,  1.024710,  1.008420,  1.007585,  0.995702,  0.990397,  0.985887, $
;  0.984798,  0.977617,  0.975278,  1.031284,  1.025645,  1.008684,  1.008157, $
;  0.995230,  0.990043,  0.985331,  0.984529,  0.977235,  0.974796,  1.031825, $
;  1.025028,  1.008886,  1.008174,  0.996046,  0.989953,  0.985310,  0.984287, $
;  0.977241,  0.974989,  1.031922,  1.023965,  1.008824,  1.007857,  0.995750, $
;  0.990326,  0.986019,  0.984715,  0.977701,  0.976127,  1.031896,  1.024317, $
;  1.008429,  1.007549,  0.996036,  0.989332,  0.986255,  0.984930,  0.978954, $
;  0.976149,  1.032539,  1.023895,  1.008683,  1.007836,  0.995354,  0.990045, $
;  0.986367,  0.984924,  0.979033,  0.976484,  1.030269,  1.023041,  1.008234, $
;  1.007519,  0.995641,  0.989721,  0.986877,  0.985786,  0.979976,  0.978690]
; 19aug
  1.025530,  1.027325,  1.006791,  1.007793,  0.996548,  0.992286,  0.988303, $
  0.986637,  0.977380,  0.973604,  1.031479,  1.031741,  1.008092,  1.007955, $
  0.996467,  0.989896,  0.985410,  0.982113,  0.974091,  0.969622,  1.031550, $
  1.029582,  1.008812,  1.008587,  0.996929,  0.989676,  0.985599,  0.983041, $
  0.975121,  0.970918,  1.032653,  1.027363,  1.008614,  1.008128,  0.997439, $
  0.990263,  0.986321,  0.984660,  0.976124,  0.972680,  1.031778,  1.028045, $
  1.008688,  1.008170,  0.995704,  0.989631,  0.986069,  0.984249,  0.976559, $
  0.973638,  1.030254,  1.026214,  1.009091,  1.008442,  0.996001,  0.990212, $
  0.986652,  0.984688,  0.977523,  0.973299,  1.031359,  1.026749,  1.009110, $
  1.008576,  0.995892,  0.989801,  0.986314,  0.984057,  0.977862,  0.973981, $
  1.032013,  1.025145,  1.008912,  1.008080,  0.996385,  0.990896,  0.986431, $
  0.985014,  0.978540,  0.974264,  1.031786,  1.026092,  1.009187,  1.008664, $
  0.995926,  0.990551,  0.985887,  0.984746,  0.978181,  0.973745,  1.032333, $
  1.025481,  1.009395,  1.008687,  0.996753,  0.990462,  0.985872,  0.984479, $
  0.978230,  0.973795,  1.032426,  1.024412,  1.009328,  1.008363,  0.996461, $
  0.990822,  0.986578,  0.984841,  0.978757,  0.974643,  1.032409,  1.024773, $
  1.008942,  1.008064,  0.996752,  0.989839,  0.986822,  0.985085,  0.979996, $
  0.974769,  1.033019,  1.024318,  1.009165,  1.008321,  0.996029,  0.990531, $
  0.986901,  0.985116,  0.979964,  0.975391,  1.030736,  1.023452,  1.008702, $
  1.007990,  0.996319,  0.990180,  0.987402,  0.985859,  0.981023,  0.977081]
; 20jan

; G750L time change array:
; 5700. 6100. 6500. 6900. 7300. 7700. 8100. 8500. 8900. 9300. 9700.
; nodes: 1997.38   1999.30   2004.00   2004.50   2009.50   2012.00   2014.50
; 2015.50   2018.00   2019.10
tc750l=[								$ 
;  1.011815,  1.009419,  1.002286,  1.001687,  0.996942,  0.991717,  0.992625, $
;  0.991747,  0.988054,  0.986493,  1.013802,  1.011163,  1.003082,  1.002116, $
;  0.996668,  0.990430,  0.989952,  0.988580,  0.985944,  0.983463,  1.015058, $
;  1.011122,  1.002604,  1.001711,  0.996435,  0.991302,  0.989871,  0.989742, $
;  0.985782,  0.983181,  1.016390,  1.012044,  1.003330,  1.002281,  0.995526, $
;  0.989234,  0.989523,  0.988585,  0.985122,  0.982311,  1.019292,  1.012573, $
;  1.004001,  1.002828,  0.996446,  0.989387,  0.987878,  0.986833,  0.982818, $
;  0.980456,  1.018654,  1.012944,  1.005409,  1.004191,  0.995906,  0.988598, $
;  0.986906,  0.986028,  0.981137,  0.978516,  1.019744,  1.012140,  1.006782, $
;  1.005784,  0.995024,  0.990912,  0.986804,  0.985688,  0.979546,  0.976799, $
;  1.028863,  1.018606,  1.005802,  1.005070,  0.994053,  0.985849,  0.982760, $
;  0.981270,  0.974775,  0.972224,  1.025127,  1.016779,  1.005917,  1.005014, $
;  0.994918,  0.987688,  0.983271,  0.983147,  0.975145,  0.973271,  1.030712, $
;  1.018928,  1.006926,  1.006310,  0.993939,  0.985608,  0.982743,  0.980742, $
;  0.973218,  0.968319,  1.042462,  1.027746,  1.003359,  1.003747,  0.992363, $
;  0.982097,  0.978654,  0.976231,  0.967392,  0.964146]	;2019aug
  1.012087,  1.009686,  1.002551,  1.001950,  0.997247,  0.991942,  0.992894, $
  0.991736,  0.988642,  0.985464,  1.014106,  1.011464,  1.003379,  1.002412, $
  0.996997,  0.990694,  0.990251,  0.988657,  0.986496,  0.982735,  1.015293, $
  1.011357,  1.002836,  1.001944,  0.996662,  0.991536,  0.990100,  0.989999, $
  0.985977,  0.983541,  1.016637,  1.012291,  1.003574,  1.002526,  0.995763, $
  0.989481,  0.989764,  0.988860,  0.985322,  0.982712,  1.019609,  1.012887, $
  1.004312,  1.003137,  0.996774,  0.989675,  0.988187,  0.987008,  0.983278, $
  0.980146,  1.019002,  1.013288,  1.005750,  1.004531,  0.996265,  0.988914, $
  0.987244,  0.986223,  0.981638,  0.978185,  1.020125,  1.012516,  1.007155, $
  1.006155,  0.995419,  0.991255,  0.987174,  0.985881,  0.980116,  0.976347, $
  1.029328,  1.019063,  1.006252,  1.005520,  0.994536,  0.986257,  0.983207, $
  0.981466,  0.975505,  0.971506,  1.025545,  1.017192,  1.006324,  1.005420, $
  0.995347,  0.988065,  0.983674,  0.983377,  0.975743,  0.972869,  1.031175, $
  1.019386,  1.007379,  1.006762,  0.994385,  0.986053,  0.983185,  0.981193, $
  0.973644,  0.968802,  1.042942,  1.028219,  1.003822,  1.004210,  0.992805, $
  0.982563,  0.979103,  0.976784,  0.967714,  0.965079]		;2020jan
  
opt_elem=strtrim(sxpar(hd,'opt_elem'),2)
case opt_elem of	
  'G140L' : mode = 'G140L'
  'G140M' : mode = 'G140L'
  'E140M' : mode = 'G140L'
  'E140H' : mode = 'G140L'
  'G230L' : mode = 'G230L'
  'G230M' : mode = 'G230L'
  'E230M' : mode = 'G230L'
  'E230H' : mode = 'G230L'
  'PRISM' : mode = 'G230L'
  'G230LB': Mode = 'G230LB'
  'G230MB': Mode = 'G230LB'
  'G430L' : Mode = 'G430L'
  'G430M' : Mode = 'G430L'
  'G750L' : Mode = 'G750L'
  'G750M' : Mode = 'G750L'
  else: return
  endcase

; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1
;###change (BUT not before getting the new nodes from make-tchang)
; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1

if mode eq 'G140L' then nodtim=[1997.38,1999.20,2001.80,2004.00,2004.50,$
	2009.50,2013.00,2016.00,2019.10]
if mode eq 'G230L' then nodtim=[1997.38,1998.60,1999.00,1999.20,	$
	1999.40,2002.60,2004.00,2004.50,2009.50,2011.20,		$
	2013.30,2015.60,2019.10]
if mode eq 'G230LB' then nodtim=[1997.38,1998.60,1999.00,1999.20,	$
	1999.40,2002.60,2004.00,2004.50,2009.50,2011.20,		$
	2013.30,2015.60,2019.10]
if mode eq 'G430L' then nodtim=[1997.38,1999.00,2004.00,2004.50,	$
	2009.50,2012.00,2014.50,2015.50,2018.00,2019.10]
if mode eq 'G750L' then nodtim=[1997.38,1999.30,2004.00,2004.50,	$
	2009.50,2012.00,2014.50,2015.50,2018.00,2019.10]

; ******** END SECTION FOR UPDATES (except temp coeff below) ***************

time=absdate(sxpar(hd,'pstrtime'))  &  time=time(0)	; change yyddd to yr.xxx
if time eq 0 then begin					;use MJD from EXPSTART
        mjd = sxpar(hd,'texpstrt')			; 02sep23
 	caldat,mjd+2400000.5d0,month,day,year,hour	; Julian to calendar
	time = year + (ymd2dn(year,month,day)+hour/24.0)/365.25d0
	endif
tcorr = 1.0				; default, applies to G230L
wcorr = 1.0

case mode of
; TEMPERATURE corrections from temp only fits. Time changes SHOULD be removed!
  'G140L' : begin
 	temp=sxpar(hd,'om1cat')
	if temp le 20 or temp ge 50 then begin			; idiot check
		print,'WARNING: NO om1cat for temp corr in TTCOR',	$
				format='(///8x,a///)'
	    end else begin
		tcorr=1-(temp-36)*.0036		; 19dec  +-.00037 w/ spline fits

		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endelse
	endcase
  'G230LB': begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
		tcorr=1+(temp-19)*.0034 	;19dec+/-.00015 for gwidth=11
		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endif
	endcase
  'G430L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
		tcorr=1+(temp-19)*.0020 	;19dec+/-.00012 for gwidth=11
		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endif
	endcase
  'G750L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
		tcorr=1+(temp-19)*.0012 	;19jul+/-.00014
		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endif
	endcase
  else:
  endcase
  if not keyword_set(silent) and not keyword_set(notemp)		$
			then print,mode,' temp. corr(flux devisor)=',tcorr
if keyword_set(notime) then return

; TIME correction
;###change for new nodes
case mode of	; reform: eg reformat 10 nodes x 11wl-bins to 10x11 array
  'G140L' : begin & timcor=reform(tc140l,9,11) & wch=indgen(11)*50.+1175 & end
  'G230L' : begin & timcor=reform(tc230l,13,15) & wch=indgen(15)*100.+1650 & end
  'G230LB': begin & timcor=reform(tc230lb,13,13) & wch=indgen(13)*100.+1750 &end
  'G430L' : begin & timcor=reform(tc430l,10,14) & wch=indgen(14)*200.+3000 & end
  'G750L' : begin & timcor=reform(tc750l,10,11) & wch=indgen(11)*400.+5700 & end
  endcase


; ******** END SECTION FOR UPDATES  ***************

if time le 1997 or time ge max(nodtim)+1 then begin	; idiot check
	print,'ttcorr: Invalid Observation Date in Header = ',time
	stop
	endif
corr=timefit(nodtim,timcor,time)	; get corr in ea WL bin @ t=time
; 2019aug28 - renorm to make old gwidth=7 sensitities work:
gwid=long(sxpar(hd,'gwidth'))

; ***
;  ff makes Net from stisflx NOT comparable for gwid = 7 vs 11!!!!
; ***

if gwid eq 7 then corr=corr/timcor(0,*)	;renorm to 1 at 1997.38
wcorr=interpol(corr,wch,wav)		; 14Jul24 - extrap beyond wch ends

del=wch(1)-wch(0)
bad=where(wav lt wch(0)-del/2)  &  wcorr(bad)=wcorr(bad(-1))
bad=where(wav gt wch(-1)+del/2)  &  wcorr(bad)=wcorr(bad(0))
if n_elements(flux) gt 1 then flux=flux/wcorr
if not keyword_set(silent) then $
    if min(wcorr) lt 1 or max(wcorr) gt 1 then 				$
	print,version,mode,' Time corr made to NET in STISFLX (or FLUX) @ ',time
return
END
