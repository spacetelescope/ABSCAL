pro ttcorr_old,hd,wav,flux,notime=notime,version=version,tcorr=tcorr,silent=silent,$
	wcorr=wcorr,time=time,notemp=notemp
;+
;
; 98jul17 - time and temperature correction for STIS low dispersion
; INPUT:
;	hd - stis header
;	wav - wavelength vector for flux
;	flux - vector to correct, eg NET or FLUX
;	notime - keyword: do not make time corr. (just temp corr)
;	notemp - do not make temp correction for tcorrel.pro
; OUTPUT:
;	flux - as corrected for time and/or temp changes
;	tcorr - keyword w/ value of temp correction
;	time - keyword: for time of obs.
; REFERENCE - Bohlin, R. 1999,Instrument Science Report, STIS 99-07.
; HISTORY
;	99dec7 - DJL, added version, corrections, time, and silent keyword
;		parameters, modified to work for Medium and Echelle
;	Jan 21, 2000 - DJL, modfied to use EXPSTART keyword when PSTRTIME is
;		missing
;	01mar - rcb, tidy up comments,etc.
;	02apr4  - use two discontinuous segments for G140L
;	02apr4  - add notemp keyword for tcorrel.
;	02jul23 - L-flat for G140L & 0.36 PX WL fix for G230L
;	02nov17 - add 2 WL bins for G230L & one for G430L
;	02nov18 - go to 3 line segments for G230L
;	03mar 1 - add temp corrections for G230LB and G430L
;	03may1  - new flats, new WLs, new bkg for CTE corr
;	03May15 - added prism support
;	03Dec   - new time nodes for G140L, G230Ls
;	05may   - new time, temp corr coef.
;	05oct3	- G750L is solid 3sig result for temp change... add this code.
;	05dec   - new time, temp corr coef. per new CTE
;	06mar2  - .............................new Trace files (slight changes)
;	06apr13 - install G430L and G750L L-flats (~negligible diffs)
;	06jul31 - 6th digit update for G750L per early GD153 fix
;	08nov24 - few 4th digit changes to G140L
;	09jul20 - new 2009 pts
; 09sep11-'big' fix of G=4 ratio & avg occdhav ~09aug7 & ctecorr tweak
;	10May   - new break points
;	11Aug   - new segments & and endpts for G230L & LB
;	14Feb - new G230L 2002.6, instead of 2002.5 
;		& new 2011.5 endpt for G230*)
;	14jul - add new 1999.3 pt for G430 & 750L, plus 2009.5 for G750L
;	14sep18 - add gwidth=11 time corrections.
;	14sep22 - add gwidth=11 temperture corrections.
;	14dec23 - New monitor obs in 2014Nov.
;	2017jan27 - fix ttcorr for g750L tchange for ht=7 HZ43. Vega?
;-
	VERSION = 'Bohlin/May, 2017'

;G140L time change array
; 1175. 1225. 1275. 1325. 1375. 1425. 1475. 1525. 1575. 1625. 1675.
;   1997.38   1999.20   2002.70   2018.00
tc140l=[								$
;  1.000000,  0.965804,  0.961709,  0.880122,  0.796499,  1.000000,  0.970643, $
;  0.969151,  0.944037,  0.916397,  1.000000,  0.984552,  0.980421,  0.949510, $
;  0.935958,  1.000000,  0.989477,  0.982847,  0.941959,  0.929092,  1.000000, $
;  0.983952,  0.983117,  0.932787,  0.912188,  1.000000,  0.981289,  0.970851, $
;  0.910630,  0.878700,  1.000000,  0.967599,  0.959040,  0.889182,  0.850838, $
;  1.000000,  0.952310,  0.947884,  0.865962,  0.826420,  1.000000,  0.951193, $
;  0.946048,  0.854741,  0.827542,  1.000000,  0.954611,  0.943782,  0.845225, $
;  0.821801,  1.000000,  0.981514,  0.976236,  0.868406,  0.839888]	;17jan
;  1.000000,  0.966594,  0.962129,  0.881386,  0.794939,  1.000000,  0.971430, $
;  0.969564,  0.945033,  0.917835,  1.000000,  0.985349,  0.980840,  0.950595, $
;  0.935800,  1.000000,  0.990278,  0.983269,  0.943140,  0.928229,  1.000000, $
;  0.984751,  0.983540,  0.933963,  0.911237,  1.000000,  0.982087,  0.971271, $
;  0.911917,  0.877116,  1.000000,  0.968388,  0.959456,  0.890510,  0.848926, $
;  1.000000,  0.953091,  0.948296,  0.867263,  0.824492,  1.000000,  0.951975, $
;  0.946462,  0.856038,  0.825556,  1.000000,  0.955393,  0.944196,  0.846514, $
;  0.819852,  1.000000,  0.982313,  0.976666,  0.869651,  0.838297]	;17may
;  1.000000,  0.966594,  0.962129,  0.881536,  0.794285,  1.000000,  0.971430, $
;  0.969564,  0.944871,  0.918556,  1.000000,  0.985349,  0.980840,  0.950583, $
;  0.935856,  1.000000,  0.990278,  0.983269,  0.943086,  0.928464,  1.000000, $
;  0.984751,  0.983540,  0.933970,  0.911208,  1.000000,  0.982087,  0.971271, $
;  0.911933,  0.877045,  1.000000,  0.968388,  0.959456,  0.890440,  0.849233, $
;  1.000000,  0.953091,  0.948296,  0.867228,  0.824642,  1.000000,  0.951975, $
;  0.946462,  0.856029,  0.825595,  1.000000,  0.955393,  0.944196,  0.846631, $
;  0.819339,  1.000000,  0.982313,  0.976666,  0.869694,  0.838106]	;17aug
;   1997.38   1999.20   2002.70   2019.00
  1.000000,  0.966594,  0.962129,  0.881928,  0.786954,  1.000000,  0.971430, $
  0.969564,  0.945174,  0.915424,  1.000000,  0.985349,  0.980840,  0.950707, $
  0.934304,  1.000000,  0.990278,  0.983269,  0.943119,  0.927309,  1.000000, $
  0.984751,  0.983540,  0.933976,  0.909715,  1.000000,  0.982087,  0.971271, $
  0.912088,  0.874110,  1.000000,  0.968388,  0.959456,  0.890529,  0.846275, $
  1.000000,  0.953091,  0.948296,  0.867450,  0.821165,  1.000000,  0.951975, $
  0.946462,  0.856307,  0.822647,  1.000000,  0.955393,  0.944196,  0.847078, $
  0.815742,  1.000000,  0.982313,  0.976666,  0.869977,  0.834824]	;18jun
  
; G230L time change array 
;   1997.38   1998.84   1999.50   2002.70   2012.00  -- old
;   1997.38   1998.12   1999.05   2002.70   2012.00  -- old
;new 14feb17 1997.38   1998.40   1999.30   2002.60   2009.50   2011.20   2018.00
; 1650. 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850.
; 2950. 3050.
tc230l=[								$
;  1.000000,  1.011024,  1.020722,  0.960947,  0.966704,  0.930445,  0.938931, $
;  0.959695,  1.000000,  1.012274,  1.021680,  0.947009,  0.915203,  0.919745, $
;  0.933389,  0.929678,  1.000000,  1.015462,  1.032093,  0.948955,  0.929294, $
;  0.922227,  0.945658,  0.907696,  1.000000,  1.015680,  1.032157,  0.940112, $
;  0.927317,  0.917809,  0.938038,  0.878835,  1.000000,  1.019259,  1.029315, $
;  0.936455,  0.923811,  0.916174,  0.925992,  0.868795,  1.000000,  1.022032, $
;  1.025069,  0.945976,  0.922641,  0.924716,  0.926201,  0.884048,  1.000000, $
;  1.031599,  1.024362,  0.957351,  0.926652,  0.933735,  0.930069,  0.897648, $
;  1.000000,  1.024863,  1.014345,  0.957684,  0.921375,  0.926651,  0.929728, $
;  0.898185,  1.000000,  1.011182,  1.006599,  0.959320,  0.913929,  0.919319, $
;  0.929404,  0.899346,  1.000000,  1.007585,  1.003458,  0.963206,  0.923110, $
;  0.924155,  0.936643,  0.906909,  1.000000,  1.014336,  1.007400,  0.969297, $
;  0.948667,  0.935792,  0.944719,  0.920367,  1.000000,  1.013165,  1.010371, $
;  0.974767,  0.953536,  0.947354,  0.948388,  0.926585,  1.000000,  1.013200, $
;  1.008319,  0.975552,  0.961113,  0.952952,  0.952900,  0.933127,  1.000000, $
;  1.018072,  1.009831,  0.981213,  0.946860,  0.954944,  0.960413,  0.935526, $
;  1.000000,  1.017931,  1.012488,  0.984003,  0.952612,  0.959825,  0.963970, $
;  0.941083]				; 17jan
;  1.000000,  1.011024,  1.020722,  0.960947,  0.966704,  0.930445,  0.939100, $
;  0.958801,  1.000000,  1.012274,  1.021680,  0.947009,  0.915203,  0.919745, $
;  0.933462,  0.929294,  1.000000,  1.015462,  1.032093,  0.948955,  0.929294, $
;  0.922227,  0.945398,  0.909072,  1.000000,  1.015680,  1.032157,  0.940112, $
;  0.927317,  0.917809,  0.937527,  0.881546,  1.000000,  1.019259,  1.029316, $
;  0.936455,  0.923812,  0.916174,  0.925665,  0.870529,  1.000000,  1.022032, $
;  1.025069,  0.945976,  0.922641,  0.924716,  0.926078,  0.884696,  1.000000, $
;  1.031599,  1.024362,  0.957351,  0.926652,  0.933735,  0.930060,  0.897699, $
;  1.000000,  1.024863,  1.014345,  0.957684,  0.921375,  0.926651,  0.929885, $
;  0.897350,  1.000000,  1.011182,  1.006599,  0.959320,  0.913929,  0.919319, $
;  0.929558,  0.898526,  1.000000,  1.007585,  1.003458,  0.963206,  0.923110, $
;  0.924155,  0.936850,  0.905809,  1.000000,  1.014336,  1.007400,  0.969297, $
;  0.948667,  0.935792,  0.944968,  0.919046,  1.000000,  1.013165,  1.010371, $
;  0.974767,  0.953536,  0.947354,  0.948700,  0.924933,  1.000000,  1.013200, $
;  1.008319,  0.975552,  0.961113,  0.952952,  0.953148,  0.931811,  1.000000, $
;  1.018072,  1.009831,  0.981213,  0.946860,  0.954944,  0.960552,  0.934791, $
;  1.000000,  1.017931,  1.012488,  0.984003,  0.952612,  0.959825,  0.964212, $
;  0.939801]				 ; 17may
;  1.000000,  1.011024,  1.020722,  0.960947,  0.966704,  0.930445,  0.939088, $
;  0.958859,  1.000000,  1.012274,  1.021680,  0.947009,  0.915203,  0.919745, $
;  0.933270,  0.930231,  1.000000,  1.015462,  1.032093,  0.948955,  0.929294, $
;  0.922227,  0.944965,  0.911191,  1.000000,  1.015680,  1.032157,  0.940112, $
;  0.927317,  0.917809,  0.936834,  0.884938,  1.000000,  1.019259,  1.029316, $
;  0.936455,  0.923811,  0.916174,  0.925033,  0.873622,  1.000000,  1.022032, $
;  1.025069,  0.945976,  0.922642,  0.924716,  0.925744,  0.886334,  1.000000, $
;  1.031599,  1.024362,  0.957351,  0.926651,  0.933735,  0.929746,  0.899233, $
;  1.000000,  1.024863,  1.014345,  0.957684,  0.921375,  0.926651,  0.929647, $
;  0.898518,  1.000000,  1.011182,  1.006599,  0.959320,  0.913929,  0.919319, $
;  0.929447,  0.899073,  1.000000,  1.007585,  1.003458,  0.963206,  0.923110, $
;  0.924155,  0.936798,  0.906064,  1.000000,  1.014336,  1.007400,  0.969297, $
;  0.948667,  0.935792,  0.944905,  0.919357,  1.000000,  1.013165,  1.010371, $
;  0.974767,  0.953537,  0.947354,  0.948599,  0.925427,  1.000000,  1.013200, $
;  1.008319,  0.975553,  0.961113,  0.952952,  0.952956,  0.932755,  1.000000, $
;  1.018072,  1.009831,  0.981213,  0.946860,  0.954944,  0.960644,  0.934340, $
;  1.000000,  1.017931,  1.012488,  0.984003,  0.952612,  0.959825,  0.964127, $
;  0.940220]				 ; 17AUG
  1.000000,  1.011024,  1.020722,  0.960947,  0.966704,  0.930445,  0.939458, $
  0.959502,  1.000000,  1.012274,  1.021680,  0.947009,  0.915203,  0.919745, $
  0.933370,  0.928962,  1.000000,  1.015462,  1.032093,  0.948955,  0.929294, $
  0.922227,  0.944088,  0.911288,  1.000000,  1.015680,  1.032157,  0.940112, $
  0.927317,  0.917809,  0.935681,  0.884035,  1.000000,  1.019259,  1.029316, $
  0.936455,  0.923811,  0.916174,  0.923955,  0.871838,  1.000000,  1.022032, $
  1.025069,  0.945976,  0.922642,  0.924716,  0.925151,  0.883298,  1.000000, $
  1.031599,  1.024362,  0.957351,  0.926651,  0.933735,  0.929186,  0.896951, $
  1.000000,  1.024863,  1.014345,  0.957684,  0.921375,  0.926651,  0.929405, $
  0.895156,  1.000000,  1.011182,  1.006599,  0.959320,  0.913929,  0.919319, $
  0.929316,  0.895696,  1.000000,  1.007585,  1.003458,  0.963206,  0.923110, $
  0.924155,  0.936771,  0.902525,  1.000000,  1.014336,  1.007400,  0.969297, $
  0.948667,  0.935792,  0.944876,  0.916090,  1.000000,  1.013165,  1.010371, $
  0.974767,  0.953537,  0.947354,  0.948456,  0.922605,  1.000000,  1.013200, $
  1.008319,  0.975553,  0.961113,  0.952952,  0.952729,  0.930675,  1.000000, $
  1.018072,  1.009831,  0.981213,  0.946860,  0.954944,  0.960392,  0.932131, $
  1.000000,  1.017931,  1.012488,  0.984003,  0.952612,  0.959825,  0.963944, $
  0.937494]				; 18jun
; G230LB time change array
;  1997.38   1999.00   2000.50   2002.50   2009.50   2015.00
;  1997.38   1999.00   2000.50   2002.50   2009.50   2011.20   2016.00 2014Feb17
;   1997.38   1999.00   2000.50   2002.50   2009.50   2011.20   2018.00
; 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850. 2950.
tc230lb=[								$
; 13jul -- new FF
;  1.000000,  1.011792,  0.986376,  0.931945,  0.881679,  0.896196,  0.902087, $
;  0.891898,  1.000000,  1.028074,  1.002278,  0.939903,  0.901414,  0.907499, $
;  0.916928,  0.872151,  1.000000,  1.028549,  0.997652,  0.933279,  0.896497, $
;  0.904680,  0.912452,  0.844838,  1.000000,  1.020858,  0.984871,  0.924549, $
;  0.890538,  0.897569,  0.897897,  0.835443,  1.000000,  1.017676,  0.986427, $
;  0.935323,  0.898967,  0.901006,  0.903071,  0.853410,  1.000000,  1.016534, $
;  0.988965,  0.945954,  0.907447,  0.906544,  0.909172,  0.871849,  1.000000, $
;  1.013686,  0.990340,  0.953360,  0.908554,  0.911073,  0.913766,  0.879128, $
;  1.000000,  1.012705,  0.990032,  0.956864,  0.917110,  0.918301,  0.917808, $
;  0.886935,  1.000000,  1.011385,  0.993383,  0.964813,  0.930878,  0.929168, $
;  0.927005,  0.898529,  1.000000,  1.008549,  0.992330,  0.968821,  0.936431, $
;  0.935212,  0.933083,  0.905205,  1.000000,  1.007460,  0.992649,  0.972000, $
;  0.943284,  0.939037,  0.935725,  0.911412,  1.000000,  1.002848,  0.989190, $
;  0.970441,  0.935702,  0.937915,  0.934520,  0.910556,  1.000000,  0.998719, $
;  0.987033,  0.969026,  0.939583,  0.938681,  0.934122,  0.912004]	; 17jan
;  1.000000,  1.011792,  0.986376,  0.931945,  0.881679,  0.896196,  0.902274, $
;  0.890919,  1.000000,  1.028074,  1.002278,  0.939903,  0.901414,  0.907499, $
;  0.916610,  0.873801,  1.000000,  1.028549,  0.997652,  0.933279,  0.896497, $
;  0.904680,  0.912004,  0.847160,  1.000000,  1.020858,  0.984871,  0.924549, $
;  0.890539,  0.897569,  0.897550,  0.837247,  1.000000,  1.017676,  0.986427, $
;  0.935323,  0.898967,  0.901006,  0.902977,  0.853896,  1.000000,  1.016534, $
;  0.988965,  0.945954,  0.907447,  0.906544,  0.909251,  0.871438,  1.000000, $
;  1.013686,  0.990340,  0.953360,  0.908554,  0.911073,  0.913832,  0.878786, $
;  1.000000,  1.012705,  0.990032,  0.956864,  0.917110,  0.918301,  0.917902, $
;  0.886448,  1.000000,  1.011385,  0.993383,  0.964813,  0.930878,  0.929168, $
;  0.927145,  0.897801,  1.000000,  1.008549,  0.992330,  0.968821,  0.936431, $
;  0.935212,  0.933130,  0.904962,  1.000000,  1.007460,  0.992649,  0.972000, $
;  0.943284,  0.939037,  0.935816,  0.910938,  1.000000,  1.002848,  0.989190, $
;  0.970441,  0.935702,  0.937915,  0.934583,  0.910232,  1.000000,  0.998719, $
;  0.987033,  0.969026,  0.939583,  0.938681,  0.934173,  0.911733]	; 17may
;  1.000000,  1.011792,  0.986376,  0.931945,  0.881679,  0.896196,  0.902254, $
;  0.891002,  1.000000,  1.028074,  1.002278,  0.939903,  0.901414,  0.907499, $
;  0.916003,  0.876704,  1.000000,  1.028549,  0.997652,  0.933279,  0.896497, $
;  0.904680,  0.911049,  0.851730,  1.000000,  1.020858,  0.984871,  0.924549, $
;  0.890538,  0.897569,  0.896875,  0.840471,  1.000000,  1.017676,  0.986427, $
;  0.935323,  0.898967,  0.901006,  0.902587,  0.855757,  1.000000,  1.016534, $
;  0.988965,  0.945954,  0.907447,  0.906544,  0.909099,  0.872162,  1.000000, $
;  1.013686,  0.990340,  0.953360,  0.908554,  0.911073,  0.913685,  0.879487, $
;  1.000000,  1.012705,  0.990032,  0.956864,  0.917110,  0.918301,  0.917807, $
;  0.886896,  1.000000,  1.011385,  0.993383,  0.964813,  0.930878,  0.929168, $
;  0.926984,  0.898574,  1.000000,  1.008549,  0.992330,  0.968821,  0.936431, $
;  0.935212,  0.932966,  0.905751,  1.000000,  1.007460,  0.992649,  0.972000, $
;  0.943284,  0.939037,  0.935683,  0.911577,  1.000000,  1.002848,  0.989190, $
;  0.970441,  0.935702,  0.937915,  0.934509,  0.910584,  1.000000,  0.998719, $
;  0.987033,  0.969026,  0.939583,  0.938681,  0.934019,  0.912470]	 ; 17aug
  1.000000,  1.011792,  0.986351,  0.932008,  0.881578,  0.896184,  0.902325, $
  0.888768,  1.000000,  1.028074,  1.002253,  0.939967,  0.901313,  0.907778, $
  0.915186,  0.876128,  1.000000,  1.028549,  0.997627,  0.933343,  0.896397, $
  0.905117,  0.909488,  0.851185,  1.000000,  1.020858,  0.984846,  0.924611, $
  0.890440,  0.897645,  0.895911,  0.838374,  1.000000,  1.017676,  0.986403, $
  0.935387,  0.898867,  0.901079,  0.902062,  0.852768,  1.000000,  1.016534, $
  0.988940,  0.946019,  0.907345,  0.906599,  0.908993,  0.868697,  1.000000, $
  1.013686,  0.990315,  0.953425,  0.908452,  0.911141,  0.913735,  0.875539, $
  1.000000,  1.012705,  0.990006,  0.956929,  0.917008,  0.918485,  0.917974, $
  0.882775,  1.000000,  1.011385,  0.993357,  0.964879,  0.930775,  0.929273, $
  0.927154,  0.895000,  1.000000,  1.008549,  0.992304,  0.968887,  0.936328, $
  0.935446,  0.933066,  0.902139,  1.000000,  1.007460,  0.992624,  0.972066, $
  0.943181,  0.939428,  0.935821,  0.908021,  1.000000,  1.002848,  0.989165, $
  0.970508,  0.935599,  0.938069,  0.934652,  0.907456,  1.000000,  0.998719, $
  0.987007,  0.969092,  0.939480,  0.938663,  0.934263,  0.909283]	; 18jun 

; G430L time change array:
;   1997.38   2009.50   2015.00
;   1997.38   1999.30   2009.50   2018.00
; 3000. 3200. 3400. 3600. 3800. 4000. 4200. 4400. 4600. 4800. 5000. 5200. 5400.
; 5600.
tc430l=[								$ 
; 13jul - new flats
; 2014aug18 - fix end WL bins.
;  1.000000,  1.007144,  0.966143,  0.976898,  0.961050,  1.000000,  1.002923, $
;  0.962383,  0.970976,  0.951399,  1.000000,  0.999254,  0.963083,  0.969395, $
;  0.950685,  1.000000,  0.996110,  0.966310,  0.969548,  0.952204,  1.000000, $
;  0.995852,  0.963316,  0.967296,  0.951274,  1.000000,  0.994712,  0.966440, $
;  0.968302,  0.953063,  1.000000,  0.993262,  0.964521,  0.966576,  0.950725, $
;  1.000000,  0.991663,  0.963587,  0.965972,  0.949449,  1.000000,  0.992785, $
;  0.963918,  0.965859,  0.948908,  1.000000,  0.991566,  0.964222,  0.965674, $
;  0.946411,  1.000000,  0.989550,  0.962689,  0.964158,  0.945334,  1.000000, $
;  0.990569,  0.963765,  0.964329,  0.945555,  1.000000,  0.988827,  0.962729, $
;  0.962445,  0.942898,  1.000000,  0.990250,  0.965704,  0.964240,  0.944988]
; 17jan
;  1.000000,  1.007144,  0.966143,  0.977119,  0.960363,  1.000000,  1.002923, $
;  0.962383,  0.971359,  0.950201,  1.000000,  0.999254,  0.963083,  0.969706, $
;  0.949709,  1.000000,  0.996110,  0.966310,  0.969890,  0.951131,  1.000000, $
;  0.995852,  0.963316,  0.967538,  0.950517,  1.000000,  0.994712,  0.966440, $
;  0.968495,  0.952457,  1.000000,  0.993262,  0.964521,  0.966708,  0.950310, $
;  1.000000,  0.991663,  0.963587,  0.966051,  0.949200,  1.000000,  0.992785, $
;  0.963918,  0.965992,  0.948490,  1.000000,  0.991566,  0.964222,  0.965708, $
;  0.946305,  1.000000,  0.989550,  0.962689,  0.964199,  0.945203,  1.000000, $
;  0.990569,  0.963765,  0.964287,  0.945688,  1.000000,  0.988827,  0.962729, $
;  0.962326,  0.943270,  1.000000,  0.990250,  0.965704,  0.964106,  0.945405]
; 17 may
;  1.000000,  1.007144,  0.966143,  0.977183,  0.960154,  1.000000,  1.002923, $
;  0.962383,  0.971236,  0.950561,  1.000000,  0.999254,  0.963083,  0.969560, $
;  0.950136,  1.000000,  0.996110,  0.966310,  0.969786,  0.951438,  1.000000, $
;  0.995852,  0.963316,  0.967455,  0.950761,  1.000000,  0.994712,  0.966440, $
;  0.968415,  0.952692,  1.000000,  0.993262,  0.964521,  0.966650,  0.950480, $
;  1.000000,  0.991663,  0.963587,  0.965968,  0.949445,  1.000000,  0.992785, $
;  0.963918,  0.965822,  0.948991,  1.000000,  0.991566,  0.964222,  0.965513, $
;  0.946880,  1.000000,  0.989550,  0.962689,  0.964051,  0.945639,  1.000000, $
;  0.990569,  0.963765,  0.964046,  0.946396,  1.000000,  0.988827,  0.962729, $
;  0.962121,  0.943875,  1.000000,  0.990250,  0.965704,  0.963874,  0.946082]
; 17aug
  1.000000,  1.007144,  0.966143,  0.977298,  0.957695,  1.000000,  1.002923, $
  0.962383,  0.971345,  0.947837,  1.000000,  0.999254,  0.963083,  0.969603, $
  0.947688,  1.000000,  0.996110,  0.966310,  0.969986,  0.948713,  1.000000, $
  0.995852,  0.963316,  0.967584,  0.948456,  1.000000,  0.994712,  0.966440, $
  0.968573,  0.950423,  1.000000,  0.993262,  0.964521,  0.966622,  0.948665, $
  1.000000,  0.991663,  0.963587,  0.965984,  0.947504,  1.000000,  0.992785, $
  0.963918,  0.965891,  0.946801,  1.000000,  0.991566,  0.964222,  0.965535, $
  0.944676,  1.000000,  0.989550,  0.962689,  0.964030,  0.943587,  1.000000, $
  0.990569,  0.963765,  0.964007,  0.944487,  1.000000,  0.988827,  0.962729, $
  0.962114,  0.941924,  1.000000,  0.990250,  0.965704,  0.963777,  0.944447]
; 18jun

; G750L time change array:
;   1997.38   2016.0
; 5700. 6100. 6500. 6900. 7300. 7700. 8100. 8500. 8900. 9300. 9700.
tc750l=[								$ 
;   1997.38   1999.30   2009.50   2015.00
  1.000000,  0.997970,  0.984762,  0.985602,  0.978012,  1.000000,  0.998179, $
  0.982551,  0.982932,  0.972493,  1.000000,  0.996686,  0.980973,  0.981388, $
  0.970433,  1.000000,  0.995702,  0.979386,  0.977641,  0.967323,  1.000000, $
  0.993745,  0.978995,  0.976174,  0.962808,  1.000000,  0.993273,  0.981307, $
  0.974183,  0.961352,  1.000000,  0.992655,  0.987198,  0.973595,  0.963048, $
  1.000000,  0.985828,  0.966214,  0.959103,  0.946583,  1.000000,  0.987191, $
  0.971510,  0.963247,  0.949702,  1.000000,  0.981083,  0.964509,  0.954902, $
  0.941289,  1.000000,  0.974496,  0.930921,  0.940577,  0.922219]	;14sep23
; #######!!!!!!!!!!!
; HGT=7 above. Do NOT change, but would need to temp. edit back to 2015 end time
;	to use.	So 2017jan27-corr for hz43 use see farther below. 11 just below
;   1997.38   1999.30   2009.50   2018.00
; gwidth=11
tc750l11=[								$ 
;  1.000000,  0.997051,  0.982478,  0.983272,  0.977330,  1.000000,  0.996892, $
;  0.979717,  0.981034,  0.971537,  1.000000,  0.995375,  0.977950,  0.979970, $
;  0.971281,  1.000000,  0.994734,  0.976670,  0.977023,  0.969126,  1.000000, $
;  0.993471,  0.976143,  0.976314,  0.964265,  1.000000,  0.994212,  0.978926, $
;  0.976197,  0.963120,  1.000000,  0.994978,  0.985333,  0.977740,  0.964067, $
;  1.000000,  0.989611,  0.964774,  0.965177,  0.948164,  1.000000,  0.992020, $
;  0.970448,  0.970037,  0.953188,  1.000000,  0.987362,  0.964941,  0.963119, $
;  0.945776,  1.000000,  0.980959,  0.933771,  0.948565,  0.927352]	; 17jan
;  1.000000,  0.997051,  0.982478,  0.983524,  0.976543,  1.000000,  0.996892, $
;  0.979717,  0.981221,  0.970951,  1.000000,  0.995375,  0.977950,  0.980176, $
;  0.970634,  1.000000,  0.994734,  0.976670,  0.977297,  0.968269,  1.000000, $
;  0.993471,  0.976143,  0.976551,  0.963519,  1.000000,  0.994212,  0.978926, $
;  0.976332,  0.962699,  1.000000,  0.994978,  0.985333,  0.978076,  0.963016, $
;  1.000000,  0.989611,  0.964774,  0.965264,  0.947891,  1.000000,  0.992020, $
;  0.970448,  0.970120,  0.952925,  1.000000,  0.987362,  0.964941,  0.962999, $
;  0.946155,  1.000000,  0.980959,  0.933771,  0.948822,  0.926526]	; 17may
;  1.000000,  0.997072,  0.982275,  0.983376,  0.976385,  1.000000,  0.996913, $
;  0.979514,  0.980997,  0.971013,  1.000000,  0.995396,  0.977747,  0.979960, $
;  0.970677,  1.000000,  0.994755,  0.976468,  0.977090,  0.968281,  1.000000, $
;  0.993492,  0.975941,  0.976277,  0.963731,  1.000000,  0.994233,  0.978724, $
;  0.976039,  0.962966,  1.000000,  0.994998,  0.985130,  0.977610,  0.963791, $
;  1.000000,  0.989631,  0.964573,  0.964992,  0.948104,  1.000000,  0.992040, $
;  0.970246,  0.969813,  0.953241,  1.000000,  0.987383,  0.964740,  0.962798, $
;  0.946162,  1.000000,  0.980980,  0.933573,  0.948447,  0.927047]	; 17aug
  1.000000,  0.997051,  0.982478,  0.983343,  0.976314,  1.000000,  0.996892, $
  0.979717,  0.980823,  0.971022,  1.000000,  0.995375,  0.977950,  0.979935, $
  0.970316,  1.000000,  0.994734,  0.976670,  0.976961,  0.968273,  1.000000, $
  0.993471,  0.976143,  0.976184,  0.963175,  1.000000,  0.994212,  0.978926, $
  0.976036,  0.962297,  1.000000,  0.994978,  0.985333,  0.978025,  0.961759, $
  1.000000,  0.989611,  0.964774,  0.965282,  0.945953,  1.000000,  0.992020, $
  0.970448,  0.970036,  0.950430,  1.000000,  0.987362,  0.964941,  0.963297, $
  0.943355,  1.000000,  0.980959,  0.933771,  0.948687,  0.923947]	; 18jun

opt_elem=strtrim(sxpar(hd,'opt_elem'),2)
case opt_elem of	
  'G140L' : mode = 'G140L'
  'G140M' : mode = 'G140L'
  'E140M' : mode = 'G140L'
  'E140H' : mode = 'G140L'
  'G230L' : mode = 'G230L'
  'G230M' : mode = 'G230L'
  'E230M' : mode = 'G230L'
  'E230H' : mode = 'G230L'
  'PRISM' : mode = 'G230L'
  'G230LB': Mode = 'G230LB'
  'G230MB': Mode = 'G230LB'
  'G430L' : Mode = 'G430L'
  'G430M' : Mode = 'G430L'
  'G750L' : Mode = 'G750L'
  'G750M' : Mode = 'G750L'
  else: return
  endcase

; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1
;###change to new yr, (BUT not before getting the new fits from make-tchang??)
; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1
endpts=[1997.38,2019]
gwid=fix(sxpar(hd,'gwidth'))
if gwid eq 11 then tc750l=tc750l11
if gwid eq 7 and mode eq 'G750L' then endpts=[1997.38,2015]

if mode eq 'G140L' then endpts=[endpts(0),1999.2,2002.7,endpts(1)]
if mode eq 'G230L' then endpts=[endpts(0),1998.4,1999.3,2002.6,2009.5,	$
			2011.2,endpts(1)]
if mode eq 'G230LB' then endpts=[endpts(0),1999.0,2000.5,2002.5,2009.5,	$
			2011.2,endpts(1)]
if mode eq 'G430L' then endpts=[endpts(0),1999.30,2009.5,endpts(1)] ; 2014jul22
if mode eq 'G750L' then endpts=[endpts(0),1999.30,2009.5,endpts(1)] ; 2014jul22

; ******** END SECTION FOR UPDATES (except temp coeff below) ***************

time=absdate(sxpar(hd,'pstrtime'))  &  time=time(0)	; change yyddd to yr.xxx
if time eq 0 then begin	;use MJD from EXPSTART
        mjd = sxpar(hd,'texpstrt')			; 02sep23
 	caldat,mjd+2400000.5d0,month,day,year,hour	; Julian to calendar
	time = year + (ymd2dn(year,month,day)+hour/24.0)/365.25d0
	endif
tcorr = 1.0				; default, applies to G230L
wcorr = 1.0

case mode of
; TEMPERATURE corrections from temp only fits. Time changes SHOULD be removed!
  'G140L' : begin
 	temp=sxpar(hd,'om1cat')
	if temp le 20 or temp ge 50 then begin			; idiot check
		print,'WARNING: NO om1cat for temp corr in TTCOR',	$
				format='(///8x,a///)'
	    end else begin
;		tcorr=1-(temp-36)*.00266	;03dec22 +- .00034 3 segments
;		tcorr=1-(temp-36)*.00265	;04mar8 +- .00035 3 segments
;		tcorr=1-(temp-36)*.0027		;06mar2 +- .00035 3 segments
;		tcorr=1-(temp-36)*.0031		;09oct2 +- .00035 3 segments
;		tcorr=1-(temp-36)*.0029		;10May10 +- .00033 3 segments
;		tcorr=1-(temp-36)*.0031		;10jul10 +- .00033 3 segments
;		tcorr=1-(temp-36)*.0030		;11mar15 +- .00033 3 segments
;		tcorr=1-(temp-36)*.0031		;11aug10  +- .00034 3 segments
;		tcorr=1-(temp-36)*.0032		; 13jan  +- .00036 3 segments
;		tcorr=1-(temp-36)*.0033		; 13jun  +- .00037 3 segments
;		tcorr=1-(temp-36)*.0033		; 14feb  +- .00036 3 segments
;		tcorr=1-(temp-36)*.0033		; 14aug  +- .00037 3 segments
;		tcorr=1-(temp-36)*.0033		; 16dec  +- .00037 3 segments
		tcorr=1-(temp-36)*.0035		; 17jul  +- .00038 3 segments
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
	    		if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endelse
	endcase
  'G230LB': begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
; 03may1 - ff are temp only fits and have ~0 change w/ the new flats and WLs
;		tcorr=1+(temp-19)*.00332		;04jun5  +- .0002
;		tcorr=1+(temp-19)*.00337		;05may17  +- .0002
;		tcorr=1+(temp-19)*.0034			;05dec20  +- .00018
;		tcorr=1+(temp-19)*.0031			;09aug13  +- .00021
;		tcorr=1+(temp-19)*.0030			;09oct2  +- .00018
;		tcorr=1+(temp-19)*.0033			;10may11 +- .00021
;		tcorr=1+(temp-19)*.0032			;10jul11 +- .00021
;		tcorr=1+(temp-19)*.0033			;11mar21 +- .00018 w/ E1
;		tcorr=1+(temp-19)*.0033	    ;11jun20 +- .00024 w/ scat lite corr
;		tcorr=1+(temp-19)*.0031			;11aug10 +- .00015
;		tcorr=1+(temp-19)*.0032			;13sep +- .00018
;		tcorr=1+(temp-19)*.0031			;14feb17 +- .00015
;		tcorr=1+(temp-19)*.0031			;14aug08 +- .00014
;		tcorr=1+(temp-19)*.0032			;17aug +- .00017
		tcorr=1+(temp-19)*.0031			;18jun +- .00019
; testing below:
		if gwid eq 11 then tcorr=1+(temp-19)*.0033 	;14sep+/-.00013
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
			if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endif
	endcase
  'G430L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
;		tcorr=1+(temp-19)*.0020			;04jun5 +- .0005
;		tcorr=1+(temp-19)*.0021			;05may13 +- .00045
;		tcorr=1+(temp-19)*.0019			;05dec21  +- .00061
;		tcorr=1+(temp-19)*.0021			;09jul20  +- .00051
;		tcorr=1+(temp-19)*.0023		;09aug13 +/-.00034per fix of g=4
;		tcorr=1+(temp-19)*.0026			;09oct2 +/-.00032
;		tcorr=1+(temp-19)*.0027			;10may7 +/-.00023
;		tcorr=1+(temp-19)*.0023			;11aug11 +/-.00015 w/ E1
;		tcorr=1+(temp-19)*.0021			;12jan12+/-.14 w/3nodes
;		tcorr=1+(temp-19)*.0021			;13jan+/-.14 w/3nodes
;		tcorr=1+(temp-19)*.0021			;14feb+/-.00016 w/3nodes
		tcorr=1+(temp-19)*.0022			;16dec+/-.00019 w/3nodes
		tcorr=1+(temp-19)*.0022			;18jun+/-.00020 w/3nodes
; ### G430L TEST ONLY ### in next line:
		if gwid eq 11 then tcorr=1+(temp-19)*.0019 ;14sep+/-.00017 3nodes
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
			if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endif
	endcase
  'G750L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
;		tcorr=1+(temp-19)*.0011			;09aug13  +- .00020
;		tcorr=1+(temp-19)*.0008			;09oct2  +- .00022
;		tcorr=1+(temp-19)*.0006			;10may7  +- .00017
;		tcorr=1+(temp-19)*.0007			;11aug11  +- .00017
;		tcorr=1+(temp-19)*.0006			;12sep  +- .00016
;		tcorr=1+(temp-19)*.0005			;14feb  +- .00023
		tcorr=1+(temp-19)*.0006			;14jul  +- .00022
;		if gwid eq 11 then tcorr=1+(temp-19)*.0012 	;14sep+/-.00015
;		if gwid eq 11 then tcorr=1+(temp-19)*.0013 	;16sep+/-.00014
;		if gwid eq 11 then tcorr=1+(temp-19)*.0012 	;16dec+/-.00015
		if gwid eq 11 then tcorr=1+(temp-19)*.0013 	;17aug+/-.00015
		if gwid eq 11 then tcorr=1+(temp-19)*.0012 	;18jun+/-.00015
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
			if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endif
	endcase
  else:
  endcase
if keyword_set(notime) then return

; TIME correction

case mode of	; reform: eg reformat 5 endpts*11wl-bins to 5x11 array
  'G140L' : begin & timcor=reform(tc140l,5,11) & wch=indgen(11)*50.+1175 & end
  'G230L' : begin & timcor=reform(tc230l,8,15) & wch=indgen(15)*100.+1650 & end
  'G230LB': begin & timcor=reform(tc230lb,8,13) & wch=indgen(13)*100.+1750 & end
  'G430L' : begin & timcor=reform(tc430l,5,14) & wch=indgen(14)*200.+3000 & end
  'G750L' : begin & timcor=reform(tc750l,5,11) & wch=indgen(11)*400.+5700 & end
  endcase

if time le 1997 or time ge max(endpts) then begin	; idiot check
	print,'ttcorr: Invalid Observation Date in Header = ',time
	stop
	endif
corr=timefit_old(endpts,timcor,time,mode=mode)	; get corr in ea WL bin @ t=time
;orig: linterp,wch,corr,wav,wcorr	;05may truncates to endpt val. Best 4 AGK @ 1mic
wcorr=interpol(corr,wch,wav)		; 14Jul24 - extrap beyond endpts
; 2014Jul24-As the corr can be a bit lumpy, 5 node spline fit makes worse lumps!
;	extrap w/ interpol makes GD71 resid shoot up after 9900A, so extrap only
;	to 9900= last node @ 9700A+dlam/2
del=wch(1)-wch(0)
bad=where(wav lt wch(0)-del/2)  &  wcorr(bad)=wcorr(bad(-1))
bad=where(wav gt wch(-1)+del/2)  &  wcorr(bad)=wcorr(bad(0))
if n_elements(flux) gt 1 then flux=flux/wcorr
if not keyword_set(silent) then $
    if min(wcorr) lt 1 or max(wcorr) gt 1 then 				$
		print,version,mode,' Time corr. made to NET or FLUX @ ',time
return
END
