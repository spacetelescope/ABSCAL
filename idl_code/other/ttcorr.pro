pro ttcorr,hd,wav,flux,notime=notime,version=version,tcorr=tcorr,silent=silent,$
	wcorr=wcorr,time=time,notemp=notemp
;+
;
; 98jul17 - time and temperature correction for STIS low dispersion
; INPUT:
;	hd - stis header
;	wav - Instrumental. obs wavelength vector w/ heliocentric vel removed.
;	flux - vector to correct, eg NET or FLUX
;	notime - keyword: do not make time corr. (just temp corr)
;	notemp - do not make temp correction for tcorrel.pro
; OUTPUT:
;	flux - as corrected for time and/or temp changes
;	tcorr - keyword w/ value of temp correction
;	wcorr - the time correction, added by DJL
;	time - keyword: for time of obs.
; REFERENCE - Bohlin, R. 1999,Instrument Science Report, STIS 99-07.
; HISTORY
;	99dec7 - DJL, added version, corrections, time, and silent keyword
;		parameters, modified to work for Medium and Echelle
;	Jan 21, 2000 - DJL, modfied to use EXPSTART keyword when PSTRTIME is
;		missing
;	02jul23 - L-flat for G140L & 0.36 PX WL fix for G230L
;	06apr13 - install G430L and G750L L-flats (~negligible diffs)
;	14sep18 - add gwidth=11 time corrections for G750L.
;	14sep22 - add gwidth=11 temperture corrections for G750L.
;	2017jan27 - fix ttcorr for g750L tchange for ht=7 HZ43. Vega?
; 2019mar20 - add gwidth=11 corr for g230lb and g430L & use for all gwid>=11
; 	2019may9 - Switch to spline node fits to time change. Hgt=7 Not done, so
;		use hgt 11 results for odd hgt=7 processing, eg most G750L HZ43.
;-
	VERSION = 'Bohlin/Mar, 2020 ttcorr '

;G140L time change array
; 1175. 1225. 1275. 1325. 1375. 1425. 1475. 1525. 1575. 1625. 1675.
; Nodes: 1997.38   1999.20   2001.80   2004.00   2004.50   2009.50   2013.00
; 2016.00   2021.10
tc140l=[								$
;  1.115778,  1.075892,  1.006229,  0.967295,  0.960569,  0.941470,  0.922510, $
;  0.894238,  0.866943,  1.045179,  1.021782,  0.998312,  0.987924,  0.977602, $
;  0.988774,  0.972001,  0.973317,  0.958790,  1.039189,  1.022810,  0.994556, $
;  0.985734,  0.981958,  0.990054,  0.975650,  0.974813,  0.969445,  1.044003, $
;  1.029053,  0.992320,  0.981054,  0.977537,  0.983645,  0.972257,  0.969004, $
;  0.967833,  1.051430,  1.035291,  0.994850,  0.977483,  0.972791,  0.973810, $
;  0.966517,  0.959670,  0.956853,  1.074910,  1.048042,  0.993201,  0.972099, $
;  0.964560,  0.963797,  0.952464,  0.945111,  0.936068,  1.095840,  1.055678, $
;  0.993671,  0.966412,  0.959557,  0.949919,  0.943565,  0.935419,  0.922718, $
;  1.117252,  1.063227,  0.993728,  0.956719,  0.949915,  0.940983,  0.933471, $
;  0.928058,  0.908269,  1.122710,  1.066157,  0.988086,  0.952529,  0.947986, $
;  0.930737,  0.936585,  0.933773,  0.910567,  1.129789,  1.072837,  0.982310, $
;  0.950646,  0.943779,  0.928743,  0.933004,  0.932770,  0.904199,  1.100310, $
;  1.076920,  0.985112,  0.954892,  0.951416,  0.934869,  0.934413,  0.931672, $
;  0.901840]	; 2020jan
  1.115778,  1.075892,  1.006230,  0.967296,  0.960570,  0.941481,  0.922506, $
  0.894259,  0.858636,  1.045191,  1.021780,  0.998318,  0.987954,  0.977700, $
  0.988613,  0.972173,  0.973048,  0.951342,  1.039195,  1.022806,  0.994558, $
  0.985753,  0.982024,  0.989940,  0.975780,  0.974630,  0.966766,  1.044005, $
  1.029051,  0.992321,  0.981060,  0.977562,  0.983587,  0.972325,  0.968922, $
  0.967473,  1.051432,  1.035289,  0.994851,  0.977490,  0.972817,  0.973758, $
  0.966587,  0.959599,  0.956513,  1.074916,  1.048037,  0.993202,  0.972120, $
  0.964638,  0.963659,  0.952629,  0.944903,  0.933000,  1.095845,  1.055673, $
  0.993672,  0.966435,  0.959639,  0.949780,  0.943731,  0.935207,  0.918385, $
  1.117261,  1.063220,  0.993729,  0.956751,  0.950034,  0.940768,  0.933709, $
  0.927718,  0.900394,  1.122719,  1.066149,  0.988088,  0.952562,  0.948109, $
  0.930500,  0.936844,  0.933400,  0.901334,  1.129800,  1.072826,  0.982312, $
  0.950691,  0.943949,  0.928415,  0.933359,  0.932247,  0.892176,  1.100317, $
  1.076913,  0.985113,  0.954921,  0.951525,  0.934659,  0.934622,  0.931322, $
  0.889284]	; 2020mar

; G230L time change array 
; 1650. 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850.
; 2950. 3050.
; nodes: 1997.38   1998.60   1999.00   1999.20   1999.40   2002.60   2004.00
; 2004.50   2009.50   2011.20   2013.30   2015.60   2021.10
tc230l=[								$
;  1.021203,  1.035075,  1.038657,  1.042414,  1.041046,  0.985817,  0.981472, $
;  0.985736,  0.950659,  0.960738,  0.965810,  0.974634,  0.965427,  1.031489, $
;  1.045790,  1.048111,  1.049462,  1.048356,  0.979110,  0.968588,  0.966473, $
;  0.948946,  0.960733,  0.963597,  0.959973,  0.955691,  1.029330,  1.047632, $
;  1.054579,  1.056450,  1.055466,  0.979301,  0.969690,  0.969731,  0.950739, $
;  0.969539,  0.957659,  0.944718,  0.947967,  1.036699,  1.055815,  1.064128, $
;  1.066889,  1.064900,  0.978620,  0.969860,  0.972243,  0.953740,  0.969567, $
;  0.948868,  0.929296,  0.935214,  1.041586,  1.063286,  1.067838,  1.067975, $
;  1.066173,  0.978152,  0.972310,  0.974402,  0.953616,  0.964320,  0.944390, $
;  0.923820,  0.925046,  1.037527,  1.061736,  1.063176,  1.061185,  1.058506, $
;  0.984270,  0.976572,  0.976093,  0.957594,  0.961644,  0.949643,  0.932351, $
;  0.925332,  1.030109,  1.061685,  1.054744,  1.052619,  1.050665,  0.988085, $
;  0.980521,  0.977806,  0.959548,  0.958465,  0.954652,  0.937720,  0.930329, $
;  1.034154,  1.057775,  1.051575,  1.050454,  1.047304,  0.993486,  0.982271, $
;  0.980710,  0.959475,  0.960234,  0.953489,  0.939171,  0.933346,  1.038720, $
;  1.049543,  1.050819,  1.045960,  1.042484,  0.998277,  0.984712,  0.984540, $
;  0.957885,  0.962252,  0.953107,  0.942630,  0.931524,  1.036167,  1.043037, $
;  1.044142,  1.043056,  1.039678,  1.001257,  0.987010,  0.988313,  0.963364, $
;  0.966521,  0.955835,  0.947431,  0.934925,  1.027561,  1.041219,  1.039594, $
;  1.036983,  1.034676,  0.999268,  0.989757,  0.993281,  0.965404,  0.969412, $
;  0.961114,  0.953606,  0.940322,  1.023792,  1.037017,  1.037610,  1.035421, $
;  1.033089,  1.000551,  0.991224,  0.995351,  0.970379,  0.971642,  0.963796, $
;  0.956261,  0.943437,  1.021374,  1.034998,  1.033002,  1.029859,  1.028351, $
;  0.998538,  0.992939,  0.994458,  0.975152,  0.971958,  0.971780,  0.961130, $
;  0.949488,  1.017957,  1.034890,  1.029901,  1.031301,  1.029200,  1.001575, $
;  0.990805,  0.992803,  0.976355,  0.975620,  0.969559,  0.960642,  0.951076, $
;  1.015267,  1.033061,  1.029952,  1.029201,  1.027383,  1.000140,  0.993316, $
;  0.992638,  0.976204,  0.977235,  0.974266,  0.963201,  0.954609]  ;2020jan
  1.021204,  1.035075,  1.038656,  1.042412,  1.041044,  0.985817,  0.981470, $
  0.985728,  0.950719,  0.960684,  0.965893,  0.974426,  0.959596,  1.031490, $
  1.045790,  1.048111,  1.049462,  1.048356,  0.979109,  0.968588,  0.966479, $
  0.948891,  0.960784,  0.963502,  0.960054,  0.954574,  1.029330,  1.047632, $
  1.054579,  1.056451,  1.055466,  0.979300,  0.969692,  0.969748,  0.950585, $
  0.969680,  0.957405,  0.945005,  0.950707,  1.036699,  1.055815,  1.064127, $
  1.066891,  1.064900,  0.978618,  0.969863,  0.972267,  0.953525,  0.969763, $
  0.948519,  0.929712,  0.939938,  1.041586,  1.063286,  1.067838,  1.067977, $
  1.066174,  0.978151,  0.972313,  0.974422,  0.953424,  0.964495,  0.944082, $
  0.924199,  0.928330,  1.037528,  1.061736,  1.063177,  1.061187,  1.058507, $
  0.984270,  0.976575,  0.976108,  0.957485,  0.961746,  0.949466,  0.932587, $
  0.925399,  1.030109,  1.061686,  1.054737,  1.052594,  1.050643,  0.988081, $
  0.980525,  0.977821,  0.959396,  0.958604,  0.954407,  0.938033,  0.930808, $
  1.034153,  1.057775,  1.051574,  1.050454,  1.047304,  0.993486,  0.982271, $
  0.980715,  0.959409,  0.960294,  0.953389,  0.939344,  0.933788,  1.038720, $
  1.049542,  1.050825,  1.045981,  1.042502,  0.998280,  0.984710,  0.984541, $
  0.957908,  0.962231,  0.953148,  0.942616,  0.928763,  1.036167,  1.043036, $
  1.044141,  1.043054,  1.039676,  1.001257,  0.987008,  0.988304,  0.963410, $
  0.966478,  0.955914,  0.947353,  0.931031,  1.027561,  1.041219,  1.039600, $
  1.037003,  1.034694,  0.999271,  0.989755,  0.993282,  0.965426,  0.969394, $
  0.961147,  0.953555,  0.935946,  1.023792,  1.037017,  1.037610,  1.035421, $
  1.033089,  1.000551,  0.991223,  0.995346,  0.970411,  0.971612,  0.963851, $
  0.956200,  0.939404,  1.021374,  1.034998,  1.033003,  1.029860,  1.028352, $
  0.998538,  0.992940,  0.994465,  0.975086,  0.972017,  0.971676,  0.961260, $
  0.947178,  1.017957,  1.034891,  1.029902,  1.031301,  1.029200,  1.001575, $
  0.990806,  0.992808,  0.976337,  0.975636,  0.969531,  0.960685,  0.948809, $
  1.015267,  1.033061,  1.029950,  1.029201,  1.027383,  1.000140,  0.993316, $
  0.992639,  0.976158,  0.977276,  0.974196,  0.963313,  0.953428]	;2020mar

; G230LB time change array
; 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850. 2950.
; nodes: 1997.38   1998.60   1999.00   1999.20   1999.40   2002.60   2004.00
; 2004.50   2009.50   2011.20   2013.30   2015.60   2020.10
tc230lb=[								$
;  1.090522,  1.092619,  1.096831,  1.094998,  1.092754,  1.011826,  1.000872, $
;  0.996196,  0.970328,  0.976639,  0.974983,  0.971068,  0.955945,  1.085305, $
;  1.097765,  1.107413,  1.106615,  1.104823,  1.014331,  1.004006,  1.001134, $
;  0.975597,  0.985448,  0.969685,  0.955281,  0.949935,  1.091247,  1.108616, $
;  1.115338,  1.114668,  1.112491,  1.016796,  1.007348,  1.004263,  0.982529, $
;  0.990731,  0.965080,  0.942475,  0.943079,  1.104478,  1.116846,  1.121413, $
;  1.118465,  1.114918,  1.019051,  1.009194,  1.006936,  0.985728,  0.986541, $
;  0.964096,  0.941524,  0.935981,  1.092972,  1.105318,  1.107694,  1.104776, $
;  1.101784,  1.021541,  1.012323,  1.009431,  0.982123,  0.983918,  0.967718, $
;  0.949405,  0.938036,  1.080622,  1.096160,  1.096332,  1.093293,  1.090629, $
;  1.023750,  1.014372,  1.011342,  0.980626,  0.981152,  0.969693,  0.957283, $
;  0.939097,  1.072477,  1.088229,  1.086206,  1.084220,  1.082203,  1.025546, $
;  1.015500,  1.012131,  0.980640,  0.981480,  0.971483,  0.959864,  0.941408, $
;  1.067675,  1.082443,  1.079999,  1.078082,  1.075946,  1.024815,  1.014591, $
;  1.012400,  0.983737,  0.982230,  0.972211,  0.962785,  0.944321,  1.060176, $
;  1.071294,  1.070534,  1.067798,  1.066068,  1.023382,  1.015494,  1.013037, $
;  0.986323,  0.983657,  0.974831,  0.966331,  0.948914,  1.052445,  1.062932, $
;  1.061152,  1.060403,  1.058895,  1.023015,  1.015398,  1.013204,  0.988015, $
;  0.985853,  0.976319,  0.969081,  0.952732,  1.049443,  1.058477,  1.057037, $
;  1.056330,  1.054930,  1.022797,  1.015209,  1.014093,  0.988422,  0.985555, $
;  0.977814,  0.971347,  0.954137,  1.051314,  1.056864,  1.055009,  1.053282, $
;  1.051787,  1.022461,  1.014741,  1.012791,  0.989352,  0.986117,  0.978101, $
;  0.972187,  0.955704,  1.051789,  1.053646,  1.051539,  1.050000,  1.048899, $
;  1.020965,  1.014330,  1.012393,  0.989752,  0.986286,  0.979091,  0.973925, $
;  0.957636]					; 2020jan
  1.091430,  1.093531,  1.097746,  1.095913,  1.093667,  1.012671,  1.001706, $
  0.997032,  0.971103,  0.977511,  0.975681,  0.971979,  0.950279,  1.086316, $
  1.098786,  1.108444,  1.107653,  1.105856,  1.015278,  1.004933,  1.002087, $
  0.976302,  0.986689,  0.969961,  0.956921,  0.947800,  1.092336,  1.109723, $
  1.116453,  1.115792,  1.113607,  1.017815,  1.008345,  1.005295,  0.983233, $
  0.992161,  0.965197,  0.944503,  0.944040,  1.105734,  1.118113,  1.122688, $
  1.119745,  1.116190,  1.020212,  1.010334,  1.008105,  0.986615,  0.988033, $
  0.964484,  0.943530,  0.935291,  1.094212,  1.106570,  1.108952,  1.106035, $
  1.103037,  1.022701,  1.013465,  1.010593,  0.983071,  0.985296,  0.968314, $
  0.951187,  0.934887,  1.081807,  1.097363,  1.097535,  1.094494,  1.091826, $
  1.024874,  1.015484,  1.012458,  0.981647,  0.982318,  0.970587,  0.958549, $
  0.933698,  1.073612,  1.089380,  1.087356,  1.085370,  1.083350,  1.026631, $
  1.016573,  1.013205,  0.981640,  0.982577,  0.972395,  0.961026,  0.935978, $
  1.068767,  1.083550,  1.081104,  1.079186,  1.077047,  1.025863,  1.015628, $
  1.013439,  0.984711,  0.983286,  0.973104,  0.963898,  0.938338,  1.061166, $
  1.072291,  1.071532,  1.068792,  1.067060,  1.024334,  1.016438,  1.013982, $
  0.987217,  0.984610,  0.975661,  0.967297,  0.943461,  1.053399,  1.063898, $
  1.062115,  1.061368,  1.059858,  1.023946,  1.016319,  1.014130,  0.988866, $
  0.986824,  0.977061,  0.970143,  0.946669,  1.050365,  1.059408,  1.057966, $
  1.057261,  1.055859,  1.023697,  1.016101,  1.014989,  0.989258,  0.986476, $
  0.978565,  0.972317,  0.947914,  1.052193,  1.057747,  1.055892,  1.054164, $
  1.052667,  1.023316,  1.015589,  1.013640,  0.990162,  0.986969,  0.978861, $
  0.973054,  0.949885,  1.052668,  1.054524,  1.052417,  1.050878,  1.049775, $
  1.021816,  1.015174,  1.013242,  0.990540,  0.987169,  0.979789,  0.974881, $
  0.951315]					; 2020mar
 
; G430L time change array:
; 3000. 3200. 3400. 3600. 3800. 4000. 4200. 4400. 4600. 4800. 5000. 5200. 5400.
; 5600.
; nodes: 1997.38   1999.00   2004.00   2004.50   2009.50   2012.00   2014.50
; 2015.50   2018.00   2020.10
tc430l=[								$ 
;  1.025530,  1.027325,  1.006791,  1.007793,  0.996548,  0.992286,  0.988303, $
;  0.986637,  0.977380,  0.973604,  1.031479,  1.031741,  1.008092,  1.007955, $
;  0.996467,  0.989896,  0.985410,  0.982113,  0.974091,  0.969622,  1.031550, $
;  1.029582,  1.008812,  1.008587,  0.996929,  0.989676,  0.985599,  0.983041, $
;  0.975121,  0.970918,  1.032653,  1.027363,  1.008614,  1.008128,  0.997439, $
;  0.990263,  0.986321,  0.984660,  0.976124,  0.972680,  1.031778,  1.028045, $
;  1.008688,  1.008170,  0.995704,  0.989631,  0.986069,  0.984249,  0.976559, $
;  0.973638,  1.030254,  1.026214,  1.009091,  1.008442,  0.996001,  0.990212, $
;  0.986652,  0.984688,  0.977523,  0.973299,  1.031359,  1.026749,  1.009110, $
;  1.008576,  0.995892,  0.989801,  0.986314,  0.984057,  0.977862,  0.973981, $
;  1.032013,  1.025145,  1.008912,  1.008080,  0.996385,  0.990896,  0.986431, $
;  0.985014,  0.978540,  0.974264,  1.031786,  1.026092,  1.009187,  1.008664, $
;  0.995926,  0.990551,  0.985887,  0.984746,  0.978181,  0.973745,  1.032333, $
;  1.025481,  1.009395,  1.008687,  0.996753,  0.990462,  0.985872,  0.984479, $
;  0.978230,  0.973795,  1.032426,  1.024412,  1.009328,  1.008363,  0.996461, $
;  0.990822,  0.986578,  0.984841,  0.978757,  0.974643,  1.032409,  1.024773, $
;  1.008942,  1.008064,  0.996752,  0.989839,  0.986822,  0.985085,  0.979996, $
;  0.974769,  1.033019,  1.024318,  1.009165,  1.008321,  0.996029,  0.990531, $
;  0.986901,  0.985116,  0.979964,  0.975391,  1.030736,  1.023452,  1.008702, $
;  1.007990,  0.996319,  0.990180,  0.987402,  0.985859,  0.981023,  0.977081]
; 20jan
  1.026080,  1.027865,  1.007320,  1.008317,  0.997156,  0.992728,  0.988871, $
  0.986604,  0.978566,  0.968609,  1.032069,  1.032323,  1.008662,  1.008522, $
  0.997083,  0.990405,  0.986005,  0.982321,  0.975054,  0.964644,  1.032129, $
  1.030151,  1.009370,  1.009141,  0.997547,  0.990162,  0.986186,  0.983153, $
  0.976209,  0.965805,  1.033216,  1.027914,  1.009155,  1.008666,  0.998041, $
  0.990732,  0.986886,  0.984752,  0.977188,  0.968076,  1.032326,  1.028582, $
  1.009215,  1.008693,  0.996296,  0.990082,  0.986621,  0.984299,  0.977663, $
  0.969236,  1.030796,  1.026749,  1.009616,  1.008965,  0.996565,  0.990686, $
  0.987193,  0.984905,  0.978421,  0.968231,  1.031885,  1.027267,  1.009619, $
  1.009082,  0.996440,  0.990258,  0.986840,  0.984254,  0.978739,  0.969196, $
  1.032535,  1.025658,  1.009417,  1.008582,  0.996929,  0.991350,  0.986953, $
  0.985218,  0.979394,  0.969281,  1.032321,  1.026619,  1.009705,  1.009179, $
  0.996481,  0.991020,  0.986420,  0.984973,  0.979036,  0.968599,  1.032882, $
  1.026020,  1.009926,  1.009214,  0.997327,  0.990936,  0.986421,  0.984673, $
  0.979152,  0.968286,  1.032976,  1.024951,  1.009858,  1.008890,  0.997042, $
  0.991289,  0.987130,  0.984982,  0.979746,  0.969007,  1.032943,  1.025299, $
  1.009460,  1.008580,  0.997295,  0.990319,  0.987353,  0.985391,  0.980751, $
  0.968653,  1.033564,  1.024853,  1.009691,  1.008845,  0.996592,  0.991008, $
  0.987443,  0.985352,  0.980831,  0.969301,  1.031307,  1.024008,  1.009250, $
  1.008533,  0.996938,  0.990645,  0.987980,  0.985892,  0.982188,  0.970206]
; 2020mar

; G750L time change array:
; 5700. 6100. 6500. 6900. 7300. 7700. 8100. 8500. 8900. 9300. 9700.
; nodes: 1997.38   1999.30   2004.00   2004.50   2009.50   2012.00   2014.50
; 2015.50   2018.00   2020.10
tc750l=[								$ 
;  1.012087,  1.009686,  1.002551,  1.001950,  0.997247,  0.991942,  0.992894, $
;  0.991736,  0.988642,  0.985464,  1.014106,  1.011464,  1.003379,  1.002412, $
;  0.996997,  0.990694,  0.990251,  0.988657,  0.986496,  0.982735,  1.015293, $
;  1.011357,  1.002836,  1.001944,  0.996662,  0.991536,  0.990100,  0.989999, $
;  0.985977,  0.983541,  1.016637,  1.012291,  1.003574,  1.002526,  0.995763, $
;  0.989481,  0.989764,  0.988860,  0.985322,  0.982712,  1.019609,  1.012887, $
;  1.004312,  1.003137,  0.996774,  0.989675,  0.988187,  0.987008,  0.983278, $
;  0.980146,  1.019002,  1.013288,  1.005750,  1.004531,  0.996265,  0.988914, $
;  0.987244,  0.986223,  0.981638,  0.978185,  1.020125,  1.012516,  1.007155, $
;  1.006155,  0.995419,  0.991255,  0.987174,  0.985881,  0.980116,  0.976347, $
;  1.029328,  1.019063,  1.006252,  1.005520,  0.994536,  0.986257,  0.983207, $
;  0.981466,  0.975505,  0.971506,  1.025545,  1.017192,  1.006324,  1.005420, $
;  0.995347,  0.988065,  0.983674,  0.983377,  0.975743,  0.972869,  1.031175, $
;  1.019386,  1.007379,  1.006762,  0.994385,  0.986053,  0.983185,  0.981193, $
;  0.973644,  0.968802,  1.042942,  1.028219,  1.003822,  1.004210,  0.992805, $
;  0.982563,  0.979103,  0.976784,  0.967714,  0.965079]		;2020jan
  1.012326,  1.009924,  1.002787,  1.002185,  0.997499,  0.992159,  0.993143, $
  0.991856,  0.989040,  0.982017,  1.014377,  1.011734,  1.003648,  1.002680, $
  0.997263,  0.990958,  0.990523,  0.988921,  0.986801,  0.978966,  1.015586, $
  1.011646,  1.003123,  1.002229,  0.996981,  0.991788,  0.990397,  0.990064, $
  0.986586,  0.980028,  1.016936,  1.012587,  1.003867,  1.002818,  0.996076, $
  0.989748,  0.990062,  0.989003,  0.985839,  0.979199,  1.019965,  1.013236, $
  1.004658,  1.003481,  0.997160,  0.989977,  0.988551,  0.987074,  0.984021, $
  0.975565,  1.019392,  1.013673,  1.006132,  1.004911,  0.996680,  0.989256, $
  0.987638,  0.986362,  0.982332,  0.973383,  1.020501,  1.012887,  1.007524, $
  1.006523,  0.995805,  0.991599,  0.987550,  0.986108,  0.980645,  0.972489, $
  1.029753,  1.019483,  1.006667,  1.005932,  0.994965,  0.986645,  0.983629, $
  0.981742,  0.976069,  0.967881,  1.025973,  1.017613,  1.006741,  1.005836, $
  0.995784,  0.988452,  0.984093,  0.983630,  0.976261,  0.970028,  1.031629, $
  1.019837,  1.007824,  1.007209,  0.994797,  0.986515,  0.983606,  0.981809, $
  0.973832,  0.965302,  1.043409,  1.028681,  1.004272,  1.004660,  0.993248, $
  0.983006,  0.979542,  0.977236,  0.968085,  0.964140]			;2020mar
  
opt_elem=strtrim(sxpar(hd,'opt_elem'),2)
case opt_elem of	
  'G140L' : mode = 'G140L'
  'G140M' : mode = 'G140L'
  'E140M' : mode = 'G140L'
  'E140H' : mode = 'G140L'
  'G230L' : mode = 'G230L'
  'G230M' : mode = 'G230L'
  'E230M' : mode = 'G230L'
  'E230H' : mode = 'G230L'
  'PRISM' : mode = 'G230L'
  'G230LB': Mode = 'G230LB'
  'G230MB': Mode = 'G230LB'
  'G430L' : Mode = 'G430L'
  'G430M' : Mode = 'G430L'
  'G750L' : Mode = 'G750L'
  'G750M' : Mode = 'G750L'
  else: return
  endcase

; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1
;###change (BUT not before getting the new nodes from make-tchang)
;	Follows change of xtim=[1997.38,2021] in make-tchang, eg.   !!!!
; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1

if mode eq 'G140L' then nodtim=[1997.38,1999.20,2001.80,2004.00,2004.50,$
	2009.50,2013.00,2016.00,2020.10]
if mode eq 'G230L' then nodtim=[1997.38,1998.60,1999.00,1999.20,	$
	1999.40,2002.60,2004.00,2004.50,2009.50,2011.20,		$
	2013.30,2015.60,2020.10]
if mode eq 'G230LB' then nodtim=[1997.38,1998.60,1999.00,1999.20,	$
	1999.40,2002.60,2004.00,2004.50,2009.50,2011.20,		$
	2013.30,2015.60,2020.10]
if mode eq 'G430L' then nodtim=[1997.38,1999.00,2004.00,2004.50,	$
	2009.50,2012.00,2014.50,2015.50,2018.00,2020.10]
if mode eq 'G750L' then nodtim=[1997.38,1999.30,2004.00,2004.50,	$
	2009.50,2012.00,2014.50,2015.50,2018.00,2020.10]

; *****###change END SECTION FOR UPDATES (except temp coeff below) *************

time=absdate(sxpar(hd,'pstrtime'))  &  time=time(0)	; change yyddd to yr.xxx
if time eq 0 then begin					;use MJD from EXPSTART
        mjd = sxpar(hd,'texpstrt')			; 02sep23
 	caldat,mjd+2400000.5d0,month,day,year,hour	; Julian to calendar
	time = year + (ymd2dn(year,month,day)+hour/24.0)/365.25d0
	endif
tcorr = 1.0				; default, applies to G230L
wcorr = 1.0

case mode of
; TEMPERATURE corrections from temp only fits. Time changes SHOULD be removed!
  'G140L' : begin
 	temp=sxpar(hd,'om1cat')
	if temp le 20 or temp ge 50 then begin			; idiot check
		print,'WARNING: NO om1cat for temp corr in TTCOR',	$
				format='(///8x,a///)'
	    end else begin
		tcorr=1-(temp-36)*.0036		; 19dec  +-.00037 w/ spline fits

		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endelse
	endcase
  'G230LB': begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
		tcorr=1+(temp-19)*.0034 	;19dec+/-.00015 for gwidth=11
		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endif
	endcase
  'G430L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
		tcorr=1+(temp-19)*.0020 	;19dec+/-.00012 for gwidth=11
		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endif
	endcase
  'G750L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
		tcorr=1+(temp-19)*.0012 	;19jul+/-.00014
		if n_elements(flux) gt 1 and not keyword_set(notemp) then $
			flux=flux/tcorr
		endif
	endcase
  else:
  endcase
  if not keyword_set(silent) and not keyword_set(notemp)		$
			then print,mode,' temp. corr(flux devisor)=',tcorr
if keyword_set(notime) then return

; TIME correction
;###change for new nodes
case mode of	; reform: eg reformat 10 nodes x 11wl-bins to 10x11 array
  'G140L' : begin & timcor=reform(tc140l,9,11) & wch=indgen(11)*50.+1175 & end
  'G230L' : begin & timcor=reform(tc230l,13,15) & wch=indgen(15)*100.+1650 & end
  'G230LB': begin & timcor=reform(tc230lb,13,13) & wch=indgen(13)*100.+1750 &end
  'G430L' : begin & timcor=reform(tc430l,10,14) & wch=indgen(14)*200.+3000 & end
  'G750L' : begin & timcor=reform(tc750l,10,11) & wch=indgen(11)*400.+5700 & end
  endcase


; ******** END SECTION FOR UPDATES  ***************

if time le 1997 or time ge max(nodtim)+1.2 then begin	; idiot check
	print,'ttcorr: Invalid Observation Date in Header = ',time
	stop
	endif
corr=timefit(nodtim,timcor,time)	; get corr in ea WL bin @ t=time

; 2020mar16 - use sens11 for all flux cals:
;;;gwid=long(sxpar(hd,'gwidth'))
;;;if gwid eq 7 then corr=corr/timcor(0,*)	;renorm to 1 at 1997.38
wcorr=interpol(corr,wch,wav)		; 14Jul24 - extrap beyond wch ends

del=wch(1)-wch(0)
bad=where(wav lt wch(0)-del/2)  &  wcorr(bad)=wcorr(bad(-1))
bad=where(wav gt wch(-1)+del/2)  &  wcorr(bad)=wcorr(bad(0))
if n_elements(flux) gt 1 then flux=flux/wcorr
if not keyword_set(silent) then $
    if min(wcorr) lt 1 or max(wcorr) gt 1 then 				$
	print,version,mode,' Time corr made to NET in STISFLX (or FLUX) @ ',time
return
END
