pro ttcorr,hd,wav,flux,notime=notime,version=version,tcorr=tcorr,silent=silent,$
	wcorr=wcorr,time=time,notemp=notemp
;+
;
; 98jul17 - time and temperature correction for STIS low dispersion
; INPUT:
;	hd - stis header
;	wav - wavelength vector for flux
;	flux - vector to correct, eg NET or FLUX
;	notime - keyword: do not make time corr. (just temp corr)
;	notemp - do not make temp correction for tcorrel.pro
; OUTPUT:
;	flux - as corrected for time and/or temp changes
;	tcorr - keyword w/ value of temp correction
;	time - keyword: for time of obs.
; REFERENCE - Bohlin, R. 1999,Instrument Science Report, STIS 99-07.
; HISTORY
;	99dec7 - DJL, added version, corrections, time, and silent keyword
;		parameters, modified to work for Medium and Echelle
;	Jan 21, 2000 - DJL, modfied to use EXPSTART keyword when PSTRTIME is
;		missing
;	01mar - rcb, tidy up comments,etc.
;	02apr4  - use two discontinuous segments for G140L
;	02apr4  - add notemp keyword for tcorrel.
;	02jul23 - L-flat for G140L & 0.36 PX WL fix for G230L
;	02nov17 - add 2 WL bins for G230L & one for G430L
;	02nov18 - go to 3 line segments for G230L
;	03mar 1 - add temp corrections for G230LB and G430L
;	03may1  - new flats, new WLs, new bkg for CTE corr
;	03May15 - added prism support
;	03Dec   - new time nodes for G140L, G230Ls
;	05may   - new time, temp corr coef.
;	05oct3	- G750L is solid 3sig result for temp change... add this code.
;	05dec   - new time, temp corr coef. per new CTE
;	06mar2  - .............................new Trace files (slight changes)
;	06apr13 - install G430L and G750L L-flats (~negligible diffs)
;	06jul31 - 6th digit update for G750L per early GD153 fix
;	08nov24 - few 4th digit changes to G140L
;	09jul20 - new 2009 pts
; 09sep11-'big' fix of G=4 ratio & avg occdhav ~09aug7 & ctecorr tweak
;	10May   - new break points
;	11Aug   - new segments & and endpts for G230L & LB
;	14Feb - new G230L 2002.6, instead of 2002.5 
;		& new 2011.5 endpt for G230*)
;	14jul - add new 1999.3 pt for G430 & 750L, plus 2009.5 for G750L
;	14sep18 - add gwidth=11 time corrections.
;	14sep22 - add gwidth=11 temperture corrections.
;	14dec23 - New monitor obs in 2014Nov.
;-
	VERSION = 'Bohlin/Dec, 2016'

;G140L time change array
; 1175. 1225. 1275. 1325. 1375. 1425. 1475. 1525. 1575. 1625. 1675.
;   1997.38   1999.20   2002.70   2017.00
tc140l=[								$
;  1.000000,  0.965804,  0.961709,  0.879895,  0.802839,  1.000000,  0.970643, $
;  0.969151,  0.944317,  0.917000,  1.000000,  0.984552,  0.980421,  0.949679, $
;  0.936106,  1.000000,  0.989477,  0.982847,  0.942199,  0.928904,  1.000000, $
;  0.983952,  0.983117,  0.933031,  0.912427,  1.000000,  0.981289,  0.970851, $
;  0.910948,  0.879329,  1.000000,  0.967599,  0.959040,  0.889481,  0.851870, $
;  1.000000,  0.952310,  0.947884,  0.866362,  0.826921,  1.000000,  0.951193, $
;  0.946048,  0.855116,  0.827365,  1.000000,  0.954611,  0.943782,  0.845662, $
;  0.821171,  1.000000,  0.981514,  0.976236,  0.868771,  0.840064]	; 16apr
;  1.000000,  0.965804,  0.961709,  0.880120,  0.801815,  1.000000,  0.970643, $
;  0.969151,  0.944180,  0.917622,  1.000000,  0.984552,  0.980421,  0.949655, $
;  0.936216,  1.000000,  0.989477,  0.982847,  0.942169,  0.929044,  1.000000, $
;  0.983952,  0.983117,  0.933004,  0.912551,  1.000000,  0.981289,  0.970851, $
;  0.910895,  0.879570,  1.000000,  0.967599,  0.959040,  0.889469,  0.851923, $
;  1.000000,  0.952310,  0.947884,  0.866292,  0.827238,  1.000000,  0.951193, $
;  0.946048,  0.855055,  0.827644,  1.000000,  0.954611,  0.943782,  0.845481, $
;  0.821994,  1.000000,  0.981514,  0.976236,  0.868593,  0.840873]	; 16sep
  1.000000,  0.965804,  0.961709,  0.880122,  0.801805,  1.000000,  0.970643, $
  0.969151,  0.944037,  0.918254,  1.000000,  0.984552,  0.980421,  0.949510, $
  0.936857,  1.000000,  0.989477,  0.982847,  0.941959,  0.929969,  1.000000, $
  0.983952,  0.983117,  0.932787,  0.913507,  1.000000,  0.981289,  0.970851, $
  0.910630,  0.880741,  1.000000,  0.967599,  0.959040,  0.889182,  0.853194, $
  1.000000,  0.952310,  0.947884,  0.865962,  0.828699,  1.000000,  0.951193, $
  0.946048,  0.854741,  0.829030,  1.000000,  0.954611,  0.943782,  0.845225, $
  0.823128,  1.000000,  0.981514,  0.976236,  0.868406,  0.841700]	;16dec
; G230L time change array 
;   1997.38   1998.84   1999.50   2002.70   2012.00  -- old
;   1997.38   1998.12   1999.05   2002.70   2012.00  -- old
;new 14feb17 1997.38   1998.40   1999.30   2002.60   2009.50   2011.20   2016.00
; 1650. 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850.
; 2950. 3050.
tc230l=[								$
;  1.000000,  1.011024,  1.020722,  0.960947,  0.966704,  0.930445,  0.939485, $
;  0.954090,  1.000000,  1.012274,  1.021680,  0.947009,  0.915203,  0.919745, $
;  0.933754,  0.928677,  1.000000,  1.015462,  1.032093,  0.948955,  0.929295, $
;  0.922227,  0.946946,  0.906785,  1.000000,  1.015680,  1.032157,  0.940112, $
;  0.927317,  0.917809,  0.939846,  0.878485,  1.000000,  1.019259,  1.029316, $
;  0.936455,  0.923811,  0.916174,  0.927579,  0.869696,  1.000000,  1.022032, $
;  1.025069,  0.945976,  0.922641,  0.924716,  0.926935,  0.887138,  1.000000, $
;  1.031599,  1.024362,  0.957351,  0.926651,  0.933735,  0.930100,  0.903016, $
;  1.000000,  1.024863,  1.014345,  0.957684,  0.921375,  0.926651,  0.930022, $
;  0.901511,  1.000000,  1.011182,  1.006599,  0.959320,  0.913929,  0.919319, $
;  0.929793,  0.901500,  1.000000,  1.007585,  1.003458,  0.963206,  0.923110, $
;  0.924155,  0.937232,  0.907651,  1.000000,  1.014336,  1.007400,  0.969297, $
;  0.948667,  0.935792,  0.945184,  0.921365,  1.000000,  1.013165,  1.010371, $
;  0.974767,  0.953537,  0.947354,  0.948718,  0.928335,  1.000000,  1.013200, $
;  1.008319,  0.975552,  0.961113,  0.952952,  0.952648,  0.937470,  1.000000, $
;  1.018072,  1.009831,  0.981213,  0.946860,  0.954944,  0.960451,  0.938675, $
;  1.000000,  1.017931,  1.012488,  0.984003,  0.952612,  0.959825,  0.963951, $
;  0.944678]			; 16apr
;  1.000000,  1.011024,  1.020722,  0.960947,  0.966704,  0.930445,  0.938981, $
;  0.956522,  1.000000,  1.012274,  1.021680,  0.947009,  0.915203,  0.919745, $
;  0.933543,  0.929690,  1.000000,  1.015462,  1.032093,  0.948955,  0.929294, $
;  0.922227,  0.946350,  0.909659,  1.000000,  1.015680,  1.032157,  0.940112, $
;  0.927317,  0.917809,  0.938927,  0.882914,  1.000000,  1.019259,  1.029316, $
;  0.936455,  0.923811,  0.916174,  0.926729,  0.873795,  1.000000,  1.022032, $
;  1.025069,  0.945976,  0.922642,  0.924716,  0.926449,  0.889484,  1.000000, $
;  1.031599,  1.024362,  0.957351,  0.926652,  0.933735,  0.929951,  0.903733, $
;  1.000000,  1.024863,  1.014345,  0.957684,  0.921375,  0.926651,  0.929865, $
;  0.902272,  1.000000,  1.011182,  1.006599,  0.959320,  0.913929,  0.919319, $
;  0.929566,  0.902594,  1.000000,  1.007585,  1.003458,  0.963206,  0.923110, $
;  0.924155,  0.937059,  0.908482,  1.000000,  1.014336,  1.007400,  0.969297, $
;  0.948667,  0.935792,  0.944950,  0.922491,  1.000000,  1.013165,  1.010371, $
;  0.974767,  0.953536,  0.947354,  0.948622,  0.928799,  1.000000,  1.013200, $
;  1.008319,  0.975552,  0.961113,  0.952952,  0.952728,  0.937083,  1.000000, $
;  1.018072,  1.009831,  0.981213,  0.946860,  0.954944,  0.960458,  0.938642, $
;  1.000000,  1.017931,  1.012488,  0.984003,  0.952612,  0.959825,  0.964086, $
;  0.944028]				;16sep 
  1.000000,  1.011024,  1.020722,  0.960947,  0.966704,  0.930445,  0.938931, $
  0.956753,  1.000000,  1.012274,  1.021680,  0.947009,  0.915203,  0.919745, $
  0.933389,  0.930401,  1.000000,  1.015462,  1.032093,  0.948955,  0.929294, $
  0.922227,  0.945658,  0.912856,  1.000000,  1.015680,  1.032157,  0.940112, $
  0.927317,  0.917809,  0.938038,  0.887020,  1.000000,  1.019259,  1.029316, $
  0.936455,  0.923811,  0.916174,  0.925992,  0.877196,  1.000000,  1.022032, $
  1.025069,  0.945976,  0.922642,  0.924716,  0.926201,  0.890629,  1.000000, $
  1.031599,  1.024362,  0.957351,  0.926651,  0.933735,  0.930069,  0.903186, $
  1.000000,  1.024863,  1.014345,  0.957684,  0.921375,  0.926651,  0.929728, $
  0.902904,  1.000000,  1.011182,  1.006599,  0.959320,  0.913929,  0.919319, $
  0.929404,  0.903344,  1.000000,  1.007585,  1.003458,  0.963206,  0.923110, $
  0.924155,  0.936643,  0.910406,  1.000000,  1.014336,  1.007400,  0.969297, $
  0.948667,  0.935792,  0.944719,  0.923559,  1.000000,  1.013165,  1.010371, $
  0.974767,  0.953536,  0.947354,  0.948388,  0.929880,  1.000000,  1.013200, $
  1.008319,  0.975552,  0.961113,  0.952952,  0.952900,  0.936289,  1.000000, $
  1.018072,  1.009831,  0.981213,  0.946860,  0.954944,  0.960413,  0.938849, $
  1.000000,  1.017930,  1.012488,  0.984003,  0.952612,  0.959825,  0.963970, $
  0.944560]				;16dec
; G230LB time change array
;  1997.38   1999.00   2000.50   2002.50   2009.50   2015.00
;  1997.38   1999.00   2000.50   2002.50   2009.50   2011.20   2016.00 2014Feb17
;   1997.38   1999.00   2000.50   2002.50   2009.50   2011.20   2017.00
; 1750. 1850. 1950. 2050. 2150. 2250. 2350. 2450. 2550. 2650. 2750. 2850. 2950.
tc230lb=[								$
; 13jul -- new FF
;  1.000000,  1.011792,  0.986375,  0.931945,  0.881679,  0.896196,  0.901722, $
;  0.895246,  1.000000,  1.028074,  1.002278,  0.939903,  0.901414,  0.907499, $
;  0.917448,  0.876290,  1.000000,  1.028549,  0.997652,  0.933279,  0.896497, $
;  0.904680,  0.913559,  0.849377,  1.000000,  1.020858,  0.984871,  0.924549, $
;  0.890538,  0.897569,  0.898574,  0.841404,  1.000000,  1.017676,  0.986427, $
;  0.935323,  0.898967,  0.901006,  0.903180,  0.860177,  1.000000,  1.016534, $
;  0.988965,  0.945954,  0.907447,  0.906544,  0.908813,  0.878816,  1.000000, $
;  1.013686,  0.990340,  0.953360,  0.908554,  0.911073,  0.913358,  0.886023, $
;  1.000000,  1.012705,  0.990032,  0.956864,  0.917110,  0.918301,  0.917514, $
;  0.892781,  1.000000,  1.011385,  0.993383,  0.964813,  0.930878,  0.929168, $
;  0.926639,  0.904434,  1.000000,  1.008548,  0.992330,  0.968821,  0.936431, $
;  0.935212,  0.932776,  0.910704,  1.000000,  1.007460,  0.992649,  0.972000, $
;  0.943284,  0.939037,  0.935316,  0.916998,  1.000000,  1.002848,  0.989190, $
;  0.970442,  0.935702,  0.937915,  0.934107,  0.915970,  1.000000,  0.998719, $
;  0.987033,  0.969026,  0.939583,  0.938681,  0.933576,  0.917918]	; 16apr
;  1.000000,  1.011792,  0.986376,  0.931945,  0.881679,  0.896196,  0.902033, $
;  0.893739,  1.000000,  1.028074,  1.002278,  0.939903,  0.901414,  0.907499, $
;  0.917151,  0.877711,  1.000000,  1.028549,  0.997652,  0.933279,  0.896497, $
;  0.904680,  0.912942,  0.852355,  1.000000,  1.020858,  0.984871,  0.924549, $
;  0.890539,  0.897569,  0.898217,  0.843127,  1.000000,  1.017676,  0.986427, $
;  0.935323,  0.898967,  0.901006,  0.903030,  0.860903,  1.000000,  1.016534, $
;  0.988965,  0.945954,  0.907447,  0.906544,  0.908949,  0.878165,  1.000000, $
;  1.013686,  0.990340,  0.953360,  0.908554,  0.911073,  0.913419,  0.885732, $
;  1.000000,  1.012705,  0.990032,  0.956864,  0.917110,  0.918301,  0.917507, $
;  0.892812,  1.000000,  1.011385,  0.993383,  0.964813,  0.930878,  0.929168, $
;  0.926591,  0.904663,  1.000000,  1.008549,  0.992330,  0.968821,  0.936431, $
;  0.935212,  0.932744,  0.910862,  1.000000,  1.007460,  0.992649,  0.972000, $
;  0.943284,  0.939037,  0.935318,  0.916989,  1.000000,  1.002848,  0.989190, $
;  0.970442,  0.935702,  0.937915,  0.934093,  0.916040,  1.000000,  0.998719, $
;  0.987033,  0.969026,  0.939583,  0.938681,  0.933660,  0.917517]	; 16sep
  1.000000,  1.011792,  0.986376,  0.931945,  0.881679,  0.896196,  0.902087, $
  0.893588,  1.000000,  1.028074,  1.002278,  0.939903,  0.901414,  0.907499, $
  0.916928,  0.878753,  1.000000,  1.028549,  0.997652,  0.933279,  0.896497, $
  0.904680,  0.912452,  0.854580,  1.000000,  1.020858,  0.984871,  0.924549, $
  0.890538,  0.897569,  0.897897,  0.844601,  1.000000,  1.017676,  0.986427, $
  0.935323,  0.898967,  0.901006,  0.903071,  0.860751,  1.000000,  1.016534, $
  0.988965,  0.945954,  0.907447,  0.906544,  0.909172,  0.877192,  1.000000, $
  1.013686,  0.990340,  0.953360,  0.908554,  0.911073,  0.913766,  0.884186, $
  1.000000,  1.012705,  0.990032,  0.956864,  0.917110,  0.918301,  0.917808, $
  0.891459,  1.000000,  1.011385,  0.993383,  0.964813,  0.930878,  0.929168, $
  0.927005,  0.902783,  1.000000,  1.008549,  0.992330,  0.968821,  0.936431, $
  0.935212,  0.933083,  0.909340,  1.000000,  1.007460,  0.992649,  0.972000, $
  0.943284,  0.939037,  0.935725,  0.915164,  1.000000,  1.002848,  0.989190, $
  0.970442,  0.935702,  0.937915,  0.934520,  0.914136,  1.000000,  0.998719, $
  0.987033,  0.969026,  0.939583,  0.938681,  0.934122,  0.915460]	; 16dec

; G430L time change array:
;   1997.38   2009.50   2015.00
;   1997.38   1999.30   2009.50   2016.00  for 2015
; 3000. 3200. 3400. 3600. 3800. 4000. 4200. 4400. 4600. 4800. 5000. 5200. 5400.
; 5600.
tc430l=[								$ 
; 13jul - new flats
; 2014aug18 - fix end WL bins.
;  1.000000,  1.007144,  0.966143,  0.976107,  0.965201,  1.000000,  1.002923, $
;  0.962383,  0.970383,  0.955406,  1.000000,  0.999254,  0.963083,  0.968833, $
;  0.954489,  1.000000,  0.996110,  0.966310,  0.969220,  0.955168,  1.000000, $
;  0.995852,  0.963316,  0.966838,  0.954462,  1.000000,  0.994712,  0.966440, $
;  0.967982,  0.955759,  1.000000,  0.993262,  0.964521,  0.966174,  0.953734, $
;  1.000000,  0.991663,  0.963587,  0.965523,  0.952667,  1.000000,  0.992785, $
;  0.963918,  0.965415,  0.952158,  1.000000,  0.991566,  0.964222,  0.965097, $
;  0.950314,  1.000000,  0.989550,  0.962689,  0.963550,  0.949270,  1.000000, $
;  0.990569,  0.963765,  0.963697,  0.949538,  1.000000,  0.988827,  0.962729, $
;  0.961751,  0.947149,  1.000000,  0.990250,  0.965704,  0.963360,  0.949752]
; 16apr
;  1.000000,  1.007144,  0.966143,  0.976285,  0.964646,  1.000000,  1.002923, $
;  0.962383,  0.970531,  0.954960,  1.000000,  0.999254,  0.963083,  0.968934, $
;  0.954185,  1.000000,  0.996110,  0.966310,  0.969219,  0.955172,  1.000000, $
;  0.995852,  0.963316,  0.966876,  0.954345,  1.000000,  0.994712,  0.966440, $
;  0.967993,  0.955728,  1.000000,  0.993262,  0.964521,  0.966228,  0.953572, $
;  1.000000,  0.991663,  0.963587,  0.965592,  0.952464,  1.000000,  0.992785, $
;  0.963918,  0.965453,  0.952048,  1.000000,  0.991566,  0.964222,  0.965169, $
;  0.950102,  1.000000,  0.989550,  0.962689,  0.963601,  0.949119,  1.000000, $
;  0.990569,  0.963765,  0.963685,  0.949581,  1.000000,  0.988827,  0.962729, $
;  0.961744,  0.947175,  1.000000,  0.990250,  0.965704,  0.963496,  0.949353]
; 16sep
  1.000000,  1.007144,  0.966143,  0.976898,  0.962915,  1.000000,  1.002923, $
  0.962383,  0.970976,  0.953702,  1.000000,  0.999254,  0.963083,  0.969395, $
  0.952886,  1.000000,  0.996110,  0.966310,  0.969548,  0.954244,  1.000000, $
  0.995852,  0.963316,  0.967296,  0.953159,  1.000000,  0.994712,  0.966440, $
  0.968302,  0.954856,  1.000000,  0.993262,  0.964521,  0.966576,  0.952590, $
  1.000000,  0.991663,  0.963587,  0.965972,  0.951393,  1.000000,  0.992785, $
  0.963918,  0.965859,  0.950902,  1.000000,  0.991566,  0.964222,  0.965674, $
  0.948677,  1.000000,  0.989550,  0.962689,  0.964158,  0.947548,  1.000000, $
  0.990569,  0.963765,  0.964329,  0.947763,  1.000000,  0.988827,  0.962729, $
  0.962445,  0.945197,  1.000000,  0.990250,  0.965704,  0.964240,  0.947251]
; 16dec
; G750L time change array:
;   1997.38   2016.0
; 5700. 6100. 6500. 6900. 7300. 7700. 8100. 8500. 8900. 9300. 9700.
tc750l=[								$ 
;   1997.38   1999.30   2009.50   2015.00
  1.000000,  0.997970,  0.984762,  0.985602,  0.978012,  1.000000,  0.998179, $
  0.982551,  0.982932,  0.972493,  1.000000,  0.996686,  0.980973,  0.981388, $
  0.970433,  1.000000,  0.995702,  0.979386,  0.977641,  0.967323,  1.000000, $
  0.993745,  0.978995,  0.976174,  0.962808,  1.000000,  0.993273,  0.981307, $
  0.974183,  0.961352,  1.000000,  0.992655,  0.987198,  0.973595,  0.963048, $
  1.000000,  0.985828,  0.966214,  0.959103,  0.946583,  1.000000,  0.987191, $
  0.971510,  0.963247,  0.949702,  1.000000,  0.981083,  0.964509,  0.954902, $
  0.941289,  1.000000,  0.974496,  0.930921,  0.940577,  0.922219]	;14sep23
; #######!!!!!!!!!!!
; HGT=7 above. Do NOT change, but would need to temp. edit back to 2015 end time
;	to use.		11 below
;   1997.38   1999.30   2009.50   2017.00
; gwidth=11
tc750l11=[								$ 
;  1.000000,  0.997072,  0.982275,  0.983013,  0.978166,  1.000000,  0.996913, $
;  0.979514,  0.980832,  0.972622,  1.000000,  0.995396,  0.977748,  0.979829, $
;  0.972087,  1.000000,  0.994755,  0.976468,  0.976784,  0.970138,  1.000000, $
;  0.993492,  0.975941,  0.976231,  0.965315,  1.000000,  0.994233,  0.978724, $
;  0.975948,  0.964762,  1.000000,  0.994998,  0.985130,  0.977282,  0.966396, $
;  1.000000,  0.989631,  0.964573,  0.964783,  0.950696,  1.000000,  0.992040, $
;  0.970246,  0.969766,  0.955344,  1.000000,  0.987383,  0.964740,  0.962992, $
;  0.947600,  1.000000,  0.980980,  0.933573,  0.948053,  0.930799]	; 16apr
;  1.000000,  0.997072,  0.982275,  0.982960,  0.978326,  1.000000,  0.996913, $
;  0.979514,  0.980716,  0.972968,  1.000000,  0.995396,  0.977748,  0.979662, $
;  0.972590,  1.000000,  0.994755,  0.976468,  0.976703,  0.970377,  1.000000, $
;  0.993492,  0.975941,  0.976090,  0.965733,  1.000000,  0.994233,  0.978724, $
;  0.975849,  0.965060,  1.000000,  0.994998,  0.985130,  0.977329,  0.966254, $
;  1.000000,  0.989631,  0.964573,  0.964772,  0.950734,  1.000000,  0.992040, $
;  0.970246,  0.969722,  0.955481,  1.000000,  0.987383,  0.964740,  0.963014, $
;  0.947538,  1.000000,  0.980980,  0.933573,  0.948296,  0.930039]	;16sep
  1.000000,  0.997051,  0.982478,  0.983272,  0.978029,  1.000000,  0.996892, $
  0.979717,  0.981034,  0.972655,  1.000000,  0.995375,  0.977950,  0.979970, $
  0.972303,  1.000000,  0.994734,  0.976670,  0.977023,  0.970055,  1.000000, $
  0.993471,  0.976143,  0.976314,  0.965683,  1.000000,  0.994212,  0.978926, $
  0.976197,  0.964659,  1.000000,  0.994978,  0.985333,  0.977740,  0.965676, $
  1.000000,  0.989611,  0.964774,  0.965177,  0.950165,  1.000000,  0.992020, $
  0.970448,  0.970037,  0.955170,  1.000000,  0.987362,  0.964941,  0.963119, $
  0.947816,  1.000000,  0.980959,  0.933771,  0.948565,  0.929848]	; 16dec
  
gwid=fix(sxpar(hd,'gwidth'))
if gwid eq 11 then tc750l=tc750l11

opt_elem=strtrim(sxpar(hd,'opt_elem'),2)
case opt_elem of	
  'G140L' : mode = 'G140L'
  'G140M' : mode = 'G140L'
  'E140M' : mode = 'G140L'
  'E140H' : mode = 'G140L'
  'G230L' : mode = 'G230L'
  'G230M' : mode = 'G230L'
  'E230M' : mode = 'G230L'
  'E230H' : mode = 'G230L'
  'PRISM' : mode = 'G230L'
  'G230LB': Mode = 'G230LB'
  'G230MB': Mode = 'G230LB'
  'G430L' : Mode = 'G430L'
  'G430M' : Mode = 'G430L'
  'G750L' : Mode = 'G750L'
  'G750M' : Mode = 'G750L'
  else: return
  endcase

; #change as time goes by:
endpts=[1997.38,2017]
if mode eq 'G140L' then endpts=[endpts(0),1999.2,2002.7,endpts(1)]
if mode eq 'G230L' then endpts=[endpts(0),1998.4,1999.3,2002.6,2009.5,	$
			2011.2,endpts(1)]
if mode eq 'G230LB' then endpts=[endpts(0),1999.0,2000.5,2002.5,2009.5,	$
			2011.2,endpts(1)]
if mode eq 'G430L' then endpts=[endpts(0),1999.30,2009.5,endpts(1)] ; 2014jul22
if mode eq 'G750L' then endpts=[endpts(0),1999.30,2009.5,endpts(1)] ; 2014jul22

; ******** END SECTION FOR UPDATES (except temp coeff below) ***************

time=absdate(sxpar(hd,'pstrtime'))  &  time=time(0)	; change yyddd to yr.xxx
if time eq 0 then begin	;use MJD from EXPSTART
        mjd = sxpar(hd,'texpstrt')			; 02sep23
 	caldat,mjd+2400000.5d0,month,day,year,hour	; Julian to calendar
	time = year + (ymd2dn(year,month,day)+hour/24.0)/365.25d0
	endif
tcorr = 1.0				; default, applies to G230L
wcorr = 1.0

case mode of
; TEMPERATURE corrections from temp only fits. Time changes SHOULD be removed!
  'G140L' : begin
 	temp=sxpar(hd,'om1cat')
	if temp le 20 or temp ge 50 then begin			; idiot check
		print,'WARNING: NO om1cat for temp corr in TTCOR',	$
				format='(///8x,a///)'
	    end else begin
;		tcorr=1-(temp-36)*.00266	;03dec22 +- .00034 3 segments
;		tcorr=1-(temp-36)*.00265	;04mar8 +- .00035 3 segments
;		tcorr=1-(temp-36)*.0027		;06mar2 +- .00035 3 segments
;		tcorr=1-(temp-36)*.0031		;09oct2 +- .00035 3 segments
;		tcorr=1-(temp-36)*.0029		;10May10 +- .00033 3 segments
;		tcorr=1-(temp-36)*.0031		;10jul10 +- .00033 3 segments
;		tcorr=1-(temp-36)*.0030		;11mar15 +- .00033 3 segments
;		tcorr=1-(temp-36)*.0031		;11aug10  +- .00034 3 segments
;		tcorr=1-(temp-36)*.0032		; 13jan  +- .00036 3 segments
;		tcorr=1-(temp-36)*.0033		; 13jun  +- .00037 3 segments
;		tcorr=1-(temp-36)*.0033		; 14feb  +- .00036 3 segments
;		tcorr=1-(temp-36)*.0033		; 14aug  +- .00037 3 segments
		tcorr=1-(temp-36)*.0033		; 16dec  +- .00037 3 segments
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
	    		if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endelse
	endcase
  'G230LB': begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
; 03may1 - ff are temp only fits and have ~0 change w/ the new flats and WLs
;		tcorr=1+(temp-19)*.00332		;04jun5  +- .0002
;		tcorr=1+(temp-19)*.00337		;05may17  +- .0002
;		tcorr=1+(temp-19)*.0034			;05dec20  +- .00018
;		tcorr=1+(temp-19)*.0031			;09aug13  +- .00021
;		tcorr=1+(temp-19)*.0030			;09oct2  +- .00018
;		tcorr=1+(temp-19)*.0033			;10may11 +- .00021
;		tcorr=1+(temp-19)*.0032			;10jul11 +- .00021
;		tcorr=1+(temp-19)*.0033			;11mar21 +- .00018 w/ E1
;		tcorr=1+(temp-19)*.0033	    ;11jun20 +- .00024 w/ scat lite corr
;		tcorr=1+(temp-19)*.0031			;11aug10 +- .00015
;		tcorr=1+(temp-19)*.0032			;13sep +- .00018
;		tcorr=1+(temp-19)*.0031			;14feb17 +- .00015
;		tcorr=1+(temp-19)*.0031			;14aug08 +- .00014
		tcorr=1+(temp-19)*.0032			;16dec2 +- .00016
; testing below:
		if gwid eq 11 then tcorr=1+(temp-19)*.0033 	;14sep+/-.00013
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
			if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endif
	endcase
  'G430L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
;		tcorr=1+(temp-19)*.0020			;04jun5 +- .0005
;		tcorr=1+(temp-19)*.0021			;05may13 +- .00045
;		tcorr=1+(temp-19)*.0019			;05dec21  +- .00061
;		tcorr=1+(temp-19)*.0021			;09jul20  +- .00051
;		tcorr=1+(temp-19)*.0023		;09aug13 +/-.00034per fix of g=4
;		tcorr=1+(temp-19)*.0026			;09oct2 +/-.00032
;		tcorr=1+(temp-19)*.0027			;10may7 +/-.00023
;		tcorr=1+(temp-19)*.0023			;11aug11 +/-.00015 w/ E1
;		tcorr=1+(temp-19)*.0021			;12jan12+/-.14 w/3nodes
;		tcorr=1+(temp-19)*.0021			;13jan+/-.14 w/3nodes
;		tcorr=1+(temp-19)*.0021			;14feb+/-.0016 w/3nodes
		tcorr=1+(temp-19)*.0022			;16dec+/-.0019 w/3nodes
; ### G430L TEST ONLY ### in next line:
		if gwid eq 11 then tcorr=1+(temp-19)*.0019 ;14sep+/-.00017 3nodes
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
			if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endif
	endcase
  'G750L' : begin 
 	temp=sxpar(hd,'OCCDHTAV')
 	if temp gt 0 and time gt 2001.5 then begin
;		tcorr=1+(temp-19)*.0011			;09aug13  +- .00020
;		tcorr=1+(temp-19)*.0008			;09oct2  +- .00022
;		tcorr=1+(temp-19)*.0006			;10may7  +- .00017
;		tcorr=1+(temp-19)*.0007			;11aug11  +- .00017
;		tcorr=1+(temp-19)*.0006			;12sep  +- .00016
;		tcorr=1+(temp-19)*.0005			;14feb  +- .00023
		tcorr=1+(temp-19)*.0006			;14jul  +- .00022
		if gwid eq 11 then tcorr=1+(temp-19)*.0012 	;14sep+/-.00015
		if gwid eq 11 then tcorr=1+(temp-19)*.0013 	;16sep+/-.00014
		if gwid eq 11 then tcorr=1+(temp-19)*.0012 	;16dec+/-.00015
		if n_elements(flux) gt 1 and not keyword_set(notemp) then begin
			flux=flux/tcorr
			if not keyword_set(silent) then print,mode,	$
							' temp. corr=',tcorr
			endif
		endif
	endcase
  else:
  endcase
if keyword_set(notime) then return

; TIME correction

case mode of	; reform: eg reformat 5 endpts*11wl-bins to 5x11 array
  'G140L' : begin & timcor=reform(tc140l,5,11) & wch=indgen(11)*50.+1175 & end
  'G230L' : begin & timcor=reform(tc230l,8,15) & wch=indgen(15)*100.+1650 & end
  'G230LB': begin & timcor=reform(tc230lb,8,13) & wch=indgen(13)*100.+1750 & end
  'G430L' : begin & timcor=reform(tc430l,5,14) & wch=indgen(14)*200.+3000 & end
  'G750L' : begin & timcor=reform(tc750l,5,11) & wch=indgen(11)*400.+5700 & end
  endcase

if time le 1997 or time ge max(endpts) then begin	; idiot check
	print,'ttcorr: Invalid Observation Date in Header = ',time
	stop
	endif
corr=timefit(endpts,timcor,time,mode=mode)	; get corr in ea WL bin @ t=time
;orig: linterp,wch,corr,wav,wcorr	;05may truncates to endpt val. Best 4 AGK @ 1mic
wcorr=interpol(corr,wch,wav)		; 14Jul24 - extrap beyond endpts
; 2014Jul24-As the corr can be a bit lumpy, 5 node spline fit makes worse lumps!
;	extrap w/ interpol makes GD71 resid shoot up after 9900A, so extrap only
;	to 9900= last node @ 9700A+dlam/2
del=wch(1)-wch(0)
bad=where(wav lt wch(0)-del/2)  &  wcorr(bad)=wcorr(bad(-1))
bad=where(wav gt wch(-1)+del/2)  &  wcorr(bad)=wcorr(bad(0))
if n_elements(flux) gt 1 then flux=flux/wcorr
if not keyword_set(silent) then $
    if min(wcorr) lt 1 or max(wcorr) gt 1 then 				$
		print,version,mode,' Time corr. made to NET or FLUX @ ',time
return
END

