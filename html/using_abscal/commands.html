

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ABSCAL Commands &mdash; abscal 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/stsci.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/stsci.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ABSCAL Data Files" href="parameter_files.html" />
    <link rel="prev" title="Using ABSCAL" href="../using_abscal.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
            <a href="../index.html" class="icon icon-home"> abscal
            
            <img src="../_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing ABSCAL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../using_abscal.html">Using ABSCAL</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../using_abscal.html#general-usage-notes">General Usage Notes</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">ABSCAL Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameter_files.html">ABSCAL Data Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="wfc3.html">ABSCAL WFC3 Scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../abscal_handbook.html">ABSCAL Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abscal_idl_code.html">ABSCAL IDL Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abscal_testing.html">ABSCAL Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">ABSCAL Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">abscal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../using_abscal.html">Using ABSCAL</a> &raquo;</li>
        
      <li>ABSCAL Commands</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/using_abscal/commands.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="abscal-commands">
<h1>ABSCAL Commands<a class="headerlink" href="#abscal-commands" title="Permalink to this headline">¶</a></h1>
<p>This section describes running ABSCAL through the provided commands. These commands are
added to your path when you install abscal, so they should be available from the command
line.</p>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#wide-field-camera-3-wfc3" id="id1">Wide Field Camera 3 (WFC3)</a></p>
<ul>
<li><p><a class="reference internal" href="#wfc3-setup" id="id2">wfc3_setup</a></p></li>
<li><p><a class="reference internal" href="#wfc3-coadd" id="id3">wfc3_coadd</a></p></li>
<li><p><a class="reference internal" href="#wfc3-wave-find-lines" id="id4">wfc3_wave_find_lines</a></p></li>
<li><p><a class="reference internal" href="#wfc3-wave-solve" id="id5">wfc3_wave_solve</a></p></li>
<li><p><a class="reference internal" href="#wfc3-all" id="id6">wfc3_all</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="wide-field-camera-3-wfc3">
<h2><a class="toc-backref" href="#id1">Wide Field Camera 3 (WFC3)</a><a class="headerlink" href="#wide-field-camera-3-wfc3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="wfc3-setup">
<h3><a class="toc-backref" href="#id2">wfc3_setup</a><a class="headerlink" href="#wfc3-setup" title="Permalink to this headline">¶</a></h3>
<p>This command creates a data table of exposures to be used in future pipline steps. The
otherwise identical idl-named version is <code class="code docutils literal notranslate"><span class="pre">wfcdir</span></code>. Its help text and options are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">wfc3_setup</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">d</span> <span class="n">DUPLICATES</span><span class="p">]</span>
                  <span class="n">template</span>

<span class="n">Build</span> <span class="n">metadata</span> <span class="n">table</span> <span class="kn">from</span> <span class="nn">input</span> <span class="n">files</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">template</span>              <span class="n">The</span> <span class="n">file</span> <span class="n">template</span> <span class="n">to</span> <span class="n">match</span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">path</span> <span class="n">to</span> <span class="n">search</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">file</span>
                        <span class="n">template</span> <span class="n">to</span> <span class="n">match</span> <span class="n">within</span> <span class="n">that</span> <span class="n">directory</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="s1">&#39;-p&#39;</span> <span class="n">option</span> <span class="ow">is</span>
                        <span class="n">used</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="nb">input</span> <span class="n">paths</span><span class="p">,</span> <span class="n">then</span> <span class="n">file</span> <span class="n">file</span> <span class="n">template</span>
                        <span class="n">will</span> <span class="n">be</span> <span class="n">joined</span> <span class="n">to</span> <span class="n">each</span> <span class="nb">input</span> <span class="n">path</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">,</span> <span class="o">--</span><span class="n">paths</span> <span class="n">PATHS</span>
                        <span class="n">A</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">paths</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">,</span> <span class="o">--</span><span class="nb">input</span> <span class="n">IN_FILE</span>
                        <span class="n">Optional</span> <span class="n">additional</span> <span class="nb">input</span> <span class="n">table</span> <span class="n">file</span><span class="o">.</span> <span class="n">If</span> <span class="n">provided</span><span class="p">,</span> <span class="n">the</span> <span class="n">program</span>
                        <span class="n">will</span> <span class="n">begin</span> <span class="n">by</span> <span class="n">reading</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">adding</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">its</span>
                        <span class="n">exposures</span> <span class="n">to</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">table</span><span class="o">.</span> <span class="n">See</span> <span class="n">the</span> <span class="n">duplicates</span> <span class="n">flag</span> <span class="k">for</span>
                        <span class="n">options</span> <span class="n">on</span> <span class="n">processing</span> <span class="n">duplicate</span> <span class="n">entries</span><span class="o">.</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">OUT_FILE</span>
                        <span class="n">Output</span> <span class="n">metadata</span> <span class="n">file</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">dirtemp_</span><span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;.</span><span class="n">log</span>
                        <span class="n">where</span> <span class="n">item</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">files</span><span class="p">,</span> <span class="s1">&#39;grism&#39;</span> <span class="k">for</span> <span class="n">grism</span> <span class="n">files</span> <span class="p">(</span><span class="ow">and</span>
                        <span class="n">associated</span> <span class="nb">filter</span> <span class="n">images</span><span class="p">),</span> <span class="s1">&#39;filter&#39;</span> <span class="ow">is</span> <span class="nb">filter</span> <span class="n">files</span><span class="p">,</span> <span class="ow">and</span> <span class="s1">&#39;scan&#39;</span> <span class="ow">is</span>
                        <span class="nb">all</span> <span class="n">scan</span><span class="o">-</span><span class="n">mode</span> <span class="n">files</span><span class="o">.</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">spec_dir</span> <span class="n">SPEC_DIR</span>
                        <span class="n">Subdirectory</span> <span class="n">where</span> <span class="n">extracted</span> <span class="ow">and</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="n">spectra</span> <span class="n">are</span> <span class="n">stored</span><span class="o">.</span> <span class="n">The</span>
                        <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="s1">&#39;spec&#39;</span><span class="o">.</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">strict_compat</span>   <span class="n">Activate</span> <span class="n">strict</span> <span class="n">compatibility</span> <span class="n">mode</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">mode</span><span class="p">,</span> <span class="n">the</span> <span class="n">script</span> <span class="n">will</span>
                        <span class="n">produce</span> <span class="n">additional</span> <span class="n">output</span> <span class="n">that</span> <span class="ow">is</span> <span class="k">as</span> <span class="n">close</span> <span class="k">as</span> <span class="n">possible</span> <span class="n">to</span>
                        <span class="n">indistinguishable</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">IDL</span> <span class="n">code</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">force</span>           <span class="n">Force</span> <span class="n">steps</span> <span class="n">to</span> <span class="n">run</span> <span class="n">even</span> <span class="k">if</span> <span class="n">output</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Print</span> <span class="n">diagnostic</span> <span class="n">information</span> <span class="k">while</span> <span class="n">running</span><span class="o">.</span>
  <span class="o">--</span><span class="n">duplicates</span> <span class="n">DUPLICATES</span>
                        <span class="n">How</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">duplicate</span> <span class="n">entries</span> <span class="p">(</span><span class="n">entries</span> <span class="n">defined</span> <span class="k">as</span> <span class="n">duplicates</span> <span class="k">if</span>
                        <span class="n">they</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="n">ipppssoot</span><span class="p">)</span><span class="o">.</span> <span class="n">Valid</span> <span class="n">values</span> <span class="n">are</span> <span class="s1">&#39;both&#39;</span> <span class="p">(</span><span class="n">keep</span>
                        <span class="n">both</span><span class="p">),</span> <span class="s1">&#39;preserve&#39;</span> <span class="p">(</span><span class="n">keep</span> <span class="n">first</span><span class="p">),</span> <span class="s1">&#39;replace&#39;</span> <span class="p">(</span><span class="n">keep</span> <span class="n">second</span><span class="p">),</span> <span class="ow">and</span>
                        <span class="s1">&#39;neither&#39;</span> <span class="p">(</span><span class="n">delete</span> <span class="n">both</span><span class="p">)</span><span class="o">.</span> <span class="n">Duplicates</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">an</span> <span class="n">issue</span> <span class="k">if</span> <span class="n">an</span>
                        <span class="nb">input</span> <span class="n">table</span> <span class="ow">is</span> <span class="n">specified</span><span class="o">.</span> <span class="n">Default</span><span class="p">:</span> <span class="s1">&#39;both&#39;</span>
</pre></div>
</div>
<p>The wfc3_setup script searches a set of directories (defaulting to the directory in which
the script is run, and adjustable via the <code class="code docutils literal notranslate"><span class="pre">-p</span></code> option) for files matching a
template. The standard template to use is “i*flt.fits” (with quotes included), which will
look for all WFC3 flatfielded exposures. The script has the option to add an additional
input table, whose files will also be added to the output table. Duplicate entries (either
present in the additional table, or between the new data files and the additional table)
are handled according to the <code class="code docutils literal notranslate"><span class="pre">-d</span></code> flag, with a default of keeping both files.</p>
<p>The output table has entries for file root (in <a class="reference external" href="https://archive.stsci.edu/hlsp/ipppssoot.html">ipppssoot</a> form), the observation set (the
ipppss of <a class="reference external" href="https://archive.stsci.edu/hlsp/ipppssoot.html">ipppssoot</a>, indicating program and visit), filter/grism, aperture, exposure
type, target, size, date, proposal, exposure time, POSTARG values from the proposal,
scan rate (if any), path on disk, a boolean “use” flag indicating whether the exposure is
valid to use, an associated filter exposure for each grism exposure (indicating a filter
exposure taken during the same visit and with the same POSTARG), full file name, the
calculated location of the target on the detector (with associated error), the CRVAL fits
header keywords, the RA and DEC of the target (corrected for target proper motion and date
of observation), the name and location of the extracted spectrum (if any exists), the name
and location of the co-added spectrum that includes the observation (if any exists), a
boolean flag indicating whether the target is a planetary nebula (and so is to be used to
calculate a wavelength solution), and a general notes column.</p>
</div>
<div class="section" id="wfc3-coadd">
<h3><a class="toc-backref" href="#id3">wfc3_coadd</a><a class="headerlink" href="#wfc3-coadd" title="Permalink to this headline">¶</a></h3>
<p>This command takes the table of exposures generated by <code class="code docutils literal notranslate"><span class="pre">wfc3_setup</span></code> and, for each
grism exposures, locates the zeroth order image on the detector, fits the spectral trace,
generates an approximate wavelength fit, and extracts the spectrum. It then groups the
extracted spectra by proposal, visit, and grism, and co-adds together all such spectra
into a single spectrum. The idl name is <code class="code docutils literal notranslate"><span class="pre">prewfc</span></code>. Its help text and options are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">wfc3_coadd</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">prefix</span> <span class="n">PREFIX</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">BKG_FLAT_ORDER</span><span class="p">]</span>
                  <span class="n">table</span>

<span class="n">Process</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">metadata</span> <span class="n">table</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">table</span>                 <span class="n">The</span> <span class="nb">input</span> <span class="n">metadata</span> <span class="n">table</span> <span class="n">to</span> <span class="n">use</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">,</span> <span class="o">--</span><span class="n">paths</span> <span class="n">PATHS</span>
                        <span class="n">A</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">paths</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">,</span> <span class="o">--</span><span class="nb">input</span> <span class="n">IN_FILE</span>
                        <span class="n">Optional</span> <span class="n">additional</span> <span class="nb">input</span> <span class="n">table</span> <span class="n">file</span><span class="o">.</span> <span class="n">If</span> <span class="n">provided</span><span class="p">,</span> <span class="n">the</span> <span class="n">program</span>
                        <span class="n">will</span> <span class="n">begin</span> <span class="n">by</span> <span class="n">reading</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">adding</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">its</span>
                        <span class="n">exposures</span> <span class="n">to</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">table</span><span class="o">.</span> <span class="n">See</span> <span class="n">the</span> <span class="n">duplicates</span> <span class="n">flag</span> <span class="k">for</span>
                        <span class="n">options</span> <span class="n">on</span> <span class="n">processing</span> <span class="n">duplicate</span> <span class="n">entries</span><span class="o">.</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">OUT_FILE</span>
                        <span class="n">Output</span> <span class="n">metadata</span> <span class="n">file</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">dirirstare_</span><span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;.</span><span class="n">log</span>
                        <span class="n">where</span> <span class="n">item</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">files</span><span class="p">,</span> <span class="s1">&#39;grism&#39;</span> <span class="k">for</span> <span class="n">grism</span> <span class="n">files</span> <span class="p">(</span><span class="ow">and</span>
                        <span class="n">associated</span> <span class="nb">filter</span> <span class="n">images</span><span class="p">),</span> <span class="s1">&#39;filter&#39;</span> <span class="ow">is</span> <span class="nb">filter</span> <span class="n">files</span><span class="p">,</span> <span class="ow">and</span> <span class="s1">&#39;scan&#39;</span> <span class="ow">is</span>
                        <span class="nb">all</span> <span class="n">scan</span><span class="o">-</span><span class="n">mode</span> <span class="n">files</span><span class="o">.</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">spec_dir</span> <span class="n">SPEC_DIR</span>
                        <span class="n">Subdirectory</span> <span class="n">where</span> <span class="n">extracted</span> <span class="ow">and</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="n">spectra</span> <span class="n">are</span> <span class="n">stored</span><span class="o">.</span> <span class="n">The</span>
                        <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="s1">&#39;spec&#39;</span><span class="o">.</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">strict_compat</span>   <span class="n">Activate</span> <span class="n">strict</span> <span class="n">compatibility</span> <span class="n">mode</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">mode</span><span class="p">,</span> <span class="n">the</span> <span class="n">script</span> <span class="n">will</span>
                        <span class="n">produce</span> <span class="n">additional</span> <span class="n">output</span> <span class="n">that</span> <span class="ow">is</span> <span class="k">as</span> <span class="n">close</span> <span class="k">as</span> <span class="n">possible</span> <span class="n">to</span>
                        <span class="n">indistinguishable</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">IDL</span> <span class="n">code</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">force</span>           <span class="n">Force</span> <span class="n">steps</span> <span class="n">to</span> <span class="n">run</span> <span class="n">even</span> <span class="k">if</span> <span class="n">output</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Print</span> <span class="n">diagnostic</span> <span class="n">information</span> <span class="k">while</span> <span class="n">running</span><span class="o">.</span>
  <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">--</span><span class="n">double</span>          <span class="n">Subsample</span> <span class="n">output</span> <span class="n">wavelength</span> <span class="n">vector</span> <span class="n">by</span> <span class="n">a</span> <span class="n">factor</span> <span class="n">of</span> <span class="mi">2</span> <span class="p">(</span><span class="n">default</span>
                        <span class="kc">False</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">prefix</span> <span class="n">PREFIX</span>       <span class="n">Prefix</span> <span class="k">for</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="n">spectra</span>
  <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">trace</span>           <span class="n">Include</span> <span class="n">result</span> <span class="n">plots</span> <span class="k">while</span> <span class="n">running</span> <span class="p">(</span><span class="n">default</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span>
  <span class="o">-</span><span class="n">b</span> <span class="n">BKG_FLAT_ORDER</span><span class="p">,</span> <span class="o">--</span><span class="n">bkg_flat_order</span> <span class="n">BKG_FLAT_ORDER</span>
                        <span class="n">Whether</span> <span class="n">to</span> <span class="n">subtract</span> <span class="n">background</span> <span class="n">before</span> <span class="ow">or</span> <span class="n">after</span> <span class="n">applying</span> <span class="n">flatfield</span><span class="o">.</span>
                        <span class="n">Default</span> <span class="ow">is</span> <span class="s1">&#39;flat_first&#39;</span><span class="o">.</span> <span class="n">Available</span> <span class="n">options</span> <span class="n">are</span> <span class="s1">&#39;flat_first&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;bkg_first&#39;</span> <span class="ow">and</span> <span class="s1">&#39;bkg_only&#39;</span><span class="o">.</span>
</pre></div>
</div>
<p>The wfc3_coadd script takes the table of exposure information provided by wfc3_setup and
loops through the grism exposures. For each exposure, if there is an associated imaging
exposure, wfc3_coadd locates the expected target image position in this exposure, and
then fits a centroid to the expected region to find the actual source centre. It then
projects the location of the zeroth order position based on the relative WCS offset, and
uses that to locate and fit the zeroth order position. If no associated image is
available, then wfc3_coadd instead uses the target co-ordinates and POSTARG values to
estimate the zeroth order position directly, and then fits that position as above.</p>
<p>After locating the zeroth order image, wfc3_coadd estimates the location of the spectral
order traces (based on its approximate wavelength solution and an approximate trace
angle). Then, for each spectral order that is visible on the detector, wfc3_coadd
collapses the order in the x direction to generate a 1D profile, and finds the centre of
that profile. Then, based on the X locations of the zeroth image and the order centres,
and the y positions of the zeroth image and the order profiles, wfc3_coadd fits a linear
trace to the spectrum, and extracts the trace centre as well as a user-defined box (with
a default width of 11 pixels) centered on the projected y location for each column of the
exposure. It then extracts background regions that parallel the trace, and divides by a
synthetic flatfield and subtracts the background (whether these are done before or after
the extraction, and in what order they’re done, is user-defined). The extracted spectrum
is then saved as a FITS binary table.</p>
<p>Finally, wfc3_coadd groups the exposures into sets which</p>
<ul class="simple">
<li><p>Have the same target</p></li>
<li><p>Use the same grism</p></li>
<li><p>Are part of the same proposal and visit</p></li>
</ul>
<p>and cross-correlates the spectral profile for all exposures in the group, and then
co-adds them together. The extracted spectra and co-added spectra are saved in a
sub-directory of the data directory.</p>
</div>
<div class="section" id="wfc3-wave-find-lines">
<h3><a class="toc-backref" href="#id4">wfc3_wave_find_lines</a><a class="headerlink" href="#wfc3-wave-find-lines" title="Permalink to this headline">¶</a></h3>
<p>The wfc3_wave_find_lines script takes a set of extracted spectra produced by the above
scripts, and obtained from observation of planetary nebulae, and uses a combination of
automatic and manual line fitting to determine the pixel position of the centre of a group
of six emission lines found in the spectral orders. Its help text and options are as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">wfc3_wave_find_lines</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span>
                            <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span>
                            <span class="n">table</span>

<span class="n">Process</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">metadata</span> <span class="n">table</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">table</span>                 <span class="n">The</span> <span class="nb">input</span> <span class="n">metadata</span> <span class="n">table</span> <span class="n">to</span> <span class="n">use</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">,</span> <span class="o">--</span><span class="n">paths</span> <span class="n">PATHS</span>
                        <span class="n">A</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">paths</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">,</span> <span class="o">--</span><span class="nb">input</span> <span class="n">IN_FILE</span>
                        <span class="n">Optional</span> <span class="n">additional</span> <span class="nb">input</span> <span class="n">table</span> <span class="n">file</span><span class="o">.</span> <span class="n">If</span> <span class="n">provided</span><span class="p">,</span> <span class="n">the</span> <span class="n">program</span>
                        <span class="n">will</span> <span class="n">begin</span> <span class="n">by</span> <span class="n">reading</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">adding</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">its</span>
                        <span class="n">exposures</span> <span class="n">to</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">table</span><span class="o">.</span> <span class="n">See</span> <span class="n">the</span> <span class="n">duplicates</span> <span class="n">flag</span> <span class="k">for</span>
                        <span class="n">options</span> <span class="n">on</span> <span class="n">processing</span> <span class="n">duplicate</span> <span class="n">entries</span><span class="o">.</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">OUT_FILE</span>
                        <span class="n">Output</span> <span class="n">metadata</span> <span class="n">file</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">wlmeastmp_</span><span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;.</span><span class="n">log</span>
                        <span class="n">where</span> <span class="n">item</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">files</span><span class="p">,</span> <span class="s1">&#39;grism&#39;</span> <span class="k">for</span> <span class="n">grism</span> <span class="n">files</span> <span class="p">(</span><span class="ow">and</span>
                        <span class="n">associated</span> <span class="nb">filter</span> <span class="n">images</span><span class="p">),</span> <span class="s1">&#39;filter&#39;</span> <span class="ow">is</span> <span class="nb">filter</span> <span class="n">files</span><span class="p">,</span> <span class="ow">and</span> <span class="s1">&#39;scan&#39;</span> <span class="ow">is</span>
                        <span class="nb">all</span> <span class="n">scan</span><span class="o">-</span><span class="n">mode</span> <span class="n">files</span><span class="o">.</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">spec_dir</span> <span class="n">SPEC_DIR</span>
                        <span class="n">Subdirectory</span> <span class="n">where</span> <span class="n">extracted</span> <span class="ow">and</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="n">spectra</span> <span class="n">are</span> <span class="n">stored</span><span class="o">.</span> <span class="n">The</span>
                        <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="s1">&#39;spec&#39;</span><span class="o">.</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">strict_compat</span>   <span class="n">Activate</span> <span class="n">strict</span> <span class="n">compatibility</span> <span class="n">mode</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">mode</span><span class="p">,</span> <span class="n">the</span> <span class="n">script</span> <span class="n">will</span>
                        <span class="n">produce</span> <span class="n">additional</span> <span class="n">output</span> <span class="n">that</span> <span class="ow">is</span> <span class="k">as</span> <span class="n">close</span> <span class="k">as</span> <span class="n">possible</span> <span class="n">to</span>
                        <span class="n">indistinguishable</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">IDL</span> <span class="n">code</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">force</span>           <span class="n">Force</span> <span class="n">steps</span> <span class="n">to</span> <span class="n">run</span> <span class="n">even</span> <span class="k">if</span> <span class="n">output</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Print</span> <span class="n">diagnostic</span> <span class="n">information</span> <span class="k">while</span> <span class="n">running</span><span class="o">.</span>
  <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">trace</span>           <span class="n">Include</span> <span class="n">result</span> <span class="n">plots</span> <span class="k">while</span> <span class="n">running</span><span class="o">.</span>
</pre></div>
</div>
<p>The wfc3_wave_find_lines script takes as input the output table created by the
<code class="code docutils literal notranslate"><span class="pre">wfc3_coadd</span></code> script. It then filters out all image exposures, as well as all
exposures of targets that are not planetary nebulae. For each such exposure, it determines
the grism used and, for each order found in the extracted spectrum, wfc3_wave_find_lines
determines which emission lines are visible in that order. Then, for each line,
wfc3_wave_find_lines chooses a region around the estimated line position, and attempts to
find a line centre for the line automatically. Whether or not it is successful,
wfc3_wave_find_lines offers the user the ability to adjust the fit, manually select a fit
if none was found, or reject an automatic fit and mark the line as not found.</p>
<p>The line centroiding code attempts to deal with widely varying planetary nebula spectra
in its find routine by</p>
<ul class="simple">
<li><p>Taking the net flux over the search region, along with a continuum estimate</p></li>
<li><p>Subtracting the continuum from the flux, setting any negative fluxes to zero</p></li>
<li><p>For any points that are farther from the centre than another point that has been set to
zero, set that point to zero. The net result of this is that the only possible points
with positive flux are a set of connected points spanning the line centre.</p></li>
<li><p>If there are no positive points, mark the fit as bad and return the centre of the search
range as the notional solution</p></li>
<li><p>If there are positive points, take the flux-weighted mean of those pixel positions, and
return that as the found centre</p></li>
</ul>
<p>The output is a table of exposures where, for each exposure, there is a single row for
each spectral order containing the zeroth order location and, for each emission line,
a location and a note. The location is either “-1” (indicating that the line is not
visible in the order) or a pixel value. The note is one of “good” (fit found
automatically), “good (ima)” (fit found to a saturated line by looking at the first ramp
in the corresponding IMA file), “bad” (no fit found, location set to centre of search
range), “custom” (user-selected location), or “rejected” (automatic fit found but rejected
by user, and location set to centre of search range as for a bad fit).</p>
</div>
<div class="section" id="wfc3-wave-solve">
<h3><a class="toc-backref" href="#id5">wfc3_wave_solve</a><a class="headerlink" href="#wfc3-wave-solve" title="Permalink to this headline">¶</a></h3>
<p>The wfc3_wave_solve script takes the output of the <code class="code docutils literal notranslate"><span class="pre">wfc3_wave_find_lines</span></code> script and
uses it to generate a 2D wavelength fit over the entire grism. Its help text and options
are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">wfc3_wave_solve</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span>
                       <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span>
                       <span class="n">table</span>

<span class="n">Process</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">metadata</span> <span class="n">table</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">table</span>                 <span class="n">The</span> <span class="nb">input</span> <span class="n">metadata</span> <span class="n">table</span> <span class="n">to</span> <span class="n">use</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">,</span> <span class="o">--</span><span class="n">paths</span> <span class="n">PATHS</span>
                        <span class="n">A</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">paths</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">,</span> <span class="o">--</span><span class="nb">input</span> <span class="n">IN_FILE</span>
                        <span class="n">Optional</span> <span class="n">additional</span> <span class="nb">input</span> <span class="n">table</span> <span class="n">file</span><span class="o">.</span> <span class="n">If</span> <span class="n">provided</span><span class="p">,</span> <span class="n">the</span> <span class="n">program</span>
                        <span class="n">will</span> <span class="n">begin</span> <span class="n">by</span> <span class="n">reading</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">adding</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">its</span>
                        <span class="n">exposures</span> <span class="n">to</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">table</span><span class="o">.</span> <span class="n">See</span> <span class="n">the</span> <span class="n">duplicates</span> <span class="n">flag</span> <span class="k">for</span>
                        <span class="n">options</span> <span class="n">on</span> <span class="n">processing</span> <span class="n">duplicate</span> <span class="n">entries</span><span class="o">.</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">OUT_FILE</span>
                        <span class="n">Output</span> <span class="n">metadata</span> <span class="n">file</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">wlmeastmp_</span><span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;.</span><span class="n">log</span>
                        <span class="n">where</span> <span class="n">item</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">files</span><span class="p">,</span> <span class="s1">&#39;grism&#39;</span> <span class="k">for</span> <span class="n">grism</span> <span class="n">files</span> <span class="p">(</span><span class="ow">and</span>
                        <span class="n">associated</span> <span class="nb">filter</span> <span class="n">images</span><span class="p">),</span> <span class="s1">&#39;filter&#39;</span> <span class="ow">is</span> <span class="nb">filter</span> <span class="n">files</span><span class="p">,</span> <span class="ow">and</span> <span class="s1">&#39;scan&#39;</span> <span class="ow">is</span>
                        <span class="nb">all</span> <span class="n">scan</span><span class="o">-</span><span class="n">mode</span> <span class="n">files</span><span class="o">.</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">spec_dir</span> <span class="n">SPEC_DIR</span>
                        <span class="n">Subdirectory</span> <span class="n">where</span> <span class="n">extracted</span> <span class="ow">and</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="n">spectra</span> <span class="n">are</span> <span class="n">stored</span><span class="o">.</span> <span class="n">The</span>
                        <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="s1">&#39;spec&#39;</span><span class="o">.</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">strict_compat</span>   <span class="n">Activate</span> <span class="n">strict</span> <span class="n">compatibility</span> <span class="n">mode</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">mode</span><span class="p">,</span> <span class="n">the</span> <span class="n">script</span> <span class="n">will</span>
                        <span class="n">produce</span> <span class="n">additional</span> <span class="n">output</span> <span class="n">that</span> <span class="ow">is</span> <span class="k">as</span> <span class="n">close</span> <span class="k">as</span> <span class="n">possible</span> <span class="n">to</span>
                        <span class="n">indistinguishable</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">IDL</span> <span class="n">code</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">force</span>           <span class="n">Force</span> <span class="n">steps</span> <span class="n">to</span> <span class="n">run</span> <span class="n">even</span> <span class="k">if</span> <span class="n">output</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Print</span> <span class="n">diagnostic</span> <span class="n">information</span> <span class="k">while</span> <span class="n">running</span><span class="o">.</span>
  <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">trace</span>           <span class="n">Include</span> <span class="n">result</span> <span class="n">plots</span> <span class="k">while</span> <span class="n">running</span><span class="o">.</span>
</pre></div>
</div>
<p>The wfc3_wave_solve script takes the output of the <code class="code docutils literal notranslate"><span class="pre">wfc3_wave_find_lines</span></code> script,
and loops over the rows filtering by grism and then by order. For each order, it selects
all emission lines where at least half of the input data have a good fit for that line. It
then takes the two farthest apart selected lines and uses them to derive an approximate
dispersion solution. It then uses all of the files and all of the selected lines to fit a
wavelength solution to the detector of the form</p>
<div class="math notranslate nohighlight">
\[\lambda = b + m \times \Delta \rm{px}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta \rm{px}\)</span> is the distance of the pixel from the zeroth order image,
<span class="math notranslate nohighlight">\(b = b_1 + b_2 x + b_3 y\)</span> where <span class="math notranslate nohighlight">\(b_n\)</span> is a constant, and
<span class="math notranslate nohighlight">\(m = m_1 + m_2 x + m_3 y\)</span> where <span class="math notranslate nohighlight">\(m_n\)</span> is a constant. In effect,
wfc3_wave_solve uses the least squares method to fit a plane over the detector, where
each individual good line fit acts as an <span class="math notranslate nohighlight">\((x,y,z)\)</span> point for fitting b and m, with
the distance of the point from the zeroth order centre acting as the z value for b, and
the dispersion at that point acting as the z value for m.</p>
<p>The wfc3_wave_solve script then takes the resulting best-fit parameters, tests them
against the various input files to display error estimates, and writes the fit parameters
to an output table with a single entry for each order of each grism for which a fit could
be derived.</p>
</div>
<div class="section" id="wfc3-all">
<h3><a class="toc-backref" href="#id6">wfc3_all</a><a class="headerlink" href="#wfc3-all" title="Permalink to this headline">¶</a></h3>
<p>The wfc3_all script takes the same input as <code class="code docutils literal notranslate"><span class="pre">wfc3_setup</span></code>, and then runs
<code class="code docutils literal notranslate"><span class="pre">wfc3_setup</span></code>, <code class="code docutils literal notranslate"><span class="pre">wfc3_coadd</span></code>, <code class="code docutils literal notranslate"><span class="pre">wfc3_wave_find_lines</span></code>, and
<code class="code docutils literal notranslate"><span class="pre">wfc3_wave_solve</span></code> sequentially, using the output of each command as the input to the
next. Its help text is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">wfc3_all</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span>
                <span class="p">[</span><span class="o">--</span><span class="n">duplicates</span> <span class="n">DUPLICATES</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">prefix</span> <span class="n">PREFIX</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span>
                <span class="n">template</span>

<span class="n">Run</span> <span class="nb">all</span> <span class="n">WFC3</span> <span class="n">Scripts</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">template</span>              <span class="n">The</span> <span class="n">file</span> <span class="n">template</span> <span class="n">to</span> <span class="n">match</span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">path</span> <span class="n">to</span> <span class="n">search</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">file</span>
                        <span class="n">template</span> <span class="n">to</span> <span class="n">match</span> <span class="n">within</span> <span class="n">that</span> <span class="n">directory</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="s1">&#39;-p&#39;</span> <span class="n">option</span> <span class="ow">is</span>
                        <span class="n">used</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="nb">input</span> <span class="n">paths</span><span class="p">,</span> <span class="n">then</span> <span class="n">file</span> <span class="n">file</span> <span class="n">template</span>
                        <span class="n">will</span> <span class="n">be</span> <span class="n">joined</span> <span class="n">to</span> <span class="n">each</span> <span class="nb">input</span> <span class="n">path</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">p</span> <span class="n">PATHS</span><span class="p">,</span> <span class="o">--</span><span class="n">paths</span> <span class="n">PATHS</span>
                        <span class="n">A</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">paths</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">IN_FILE</span><span class="p">,</span> <span class="o">--</span><span class="nb">input</span> <span class="n">IN_FILE</span>
                        <span class="n">Optional</span> <span class="n">additional</span> <span class="nb">input</span> <span class="n">table</span> <span class="n">file</span><span class="o">.</span> <span class="n">If</span> <span class="n">provided</span><span class="p">,</span> <span class="n">the</span> <span class="n">program</span>
                        <span class="n">will</span> <span class="n">begin</span> <span class="n">by</span> <span class="n">reading</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">adding</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">its</span>
                        <span class="n">exposures</span> <span class="n">to</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">table</span><span class="o">.</span> <span class="n">See</span> <span class="n">the</span> <span class="n">duplicates</span> <span class="n">flag</span> <span class="k">for</span>
                        <span class="n">options</span> <span class="n">on</span> <span class="n">processing</span> <span class="n">duplicate</span> <span class="n">entries</span><span class="o">.</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUT_FILE</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">OUT_FILE</span>
                        <span class="n">Output</span> <span class="n">metadata</span> <span class="n">file</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">wl_solution_</span><span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;.</span><span class="n">log</span>
                        <span class="n">where</span> <span class="n">item</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">files</span><span class="p">,</span> <span class="s1">&#39;grism&#39;</span> <span class="k">for</span> <span class="n">grism</span> <span class="n">files</span> <span class="p">(</span><span class="ow">and</span>
                        <span class="n">associated</span> <span class="nb">filter</span> <span class="n">images</span><span class="p">),</span> <span class="s1">&#39;filter&#39;</span> <span class="ow">is</span> <span class="nb">filter</span> <span class="n">files</span><span class="p">,</span> <span class="ow">and</span> <span class="s1">&#39;scan&#39;</span> <span class="ow">is</span>
                        <span class="nb">all</span> <span class="n">scan</span><span class="o">-</span><span class="n">mode</span> <span class="n">files</span><span class="o">.</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SPEC_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">spec_dir</span> <span class="n">SPEC_DIR</span>
                        <span class="n">Subdirectory</span> <span class="n">where</span> <span class="n">extracted</span> <span class="ow">and</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="n">spectra</span> <span class="n">are</span> <span class="n">stored</span><span class="o">.</span> <span class="n">The</span>
                        <span class="n">default</span> <span class="n">value</span> <span class="ow">is</span> <span class="s1">&#39;spec&#39;</span><span class="o">.</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">strict_compat</span>   <span class="n">Activate</span> <span class="n">strict</span> <span class="n">compatibility</span> <span class="n">mode</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">mode</span><span class="p">,</span> <span class="n">the</span> <span class="n">script</span> <span class="n">will</span>
                        <span class="n">produce</span> <span class="n">additional</span> <span class="n">output</span> <span class="n">that</span> <span class="ow">is</span> <span class="k">as</span> <span class="n">close</span> <span class="k">as</span> <span class="n">possible</span> <span class="n">to</span>
                        <span class="n">indistinguishable</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">IDL</span> <span class="n">code</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">force</span>           <span class="n">Force</span> <span class="n">steps</span> <span class="n">to</span> <span class="n">run</span> <span class="n">even</span> <span class="k">if</span> <span class="n">output</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Print</span> <span class="n">diagnostic</span> <span class="n">information</span> <span class="k">while</span> <span class="n">running</span><span class="o">.</span>
  <span class="o">--</span><span class="n">duplicates</span> <span class="n">DUPLICATES</span>
                        <span class="n">How</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">duplicate</span> <span class="n">entries</span> <span class="p">(</span><span class="n">entries</span> <span class="n">defined</span> <span class="k">as</span> <span class="n">duplicates</span> <span class="k">if</span>
                        <span class="n">they</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="n">ipppssoot</span><span class="p">)</span><span class="o">.</span> <span class="n">Valid</span> <span class="n">values</span> <span class="n">are</span> <span class="s1">&#39;both&#39;</span> <span class="p">(</span><span class="n">keep</span>
                        <span class="n">both</span><span class="p">),</span> <span class="s1">&#39;preserve&#39;</span> <span class="p">(</span><span class="n">keep</span> <span class="n">first</span><span class="p">),</span> <span class="s1">&#39;replace&#39;</span> <span class="p">(</span><span class="n">keep</span> <span class="n">second</span><span class="p">),</span> <span class="ow">and</span>
                        <span class="s1">&#39;neither&#39;</span> <span class="p">(</span><span class="n">delete</span> <span class="n">both</span><span class="p">)</span><span class="o">.</span> <span class="n">Duplicates</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">an</span> <span class="n">issue</span> <span class="k">if</span> <span class="n">an</span>
                        <span class="nb">input</span> <span class="n">table</span> <span class="ow">is</span> <span class="n">specified</span><span class="o">.</span> <span class="n">Default</span><span class="p">:</span> <span class="s1">&#39;both&#39;</span>
  <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">--</span><span class="n">double</span>          <span class="n">Subsample</span> <span class="n">output</span> <span class="n">wavelength</span> <span class="n">vector</span> <span class="n">by</span> <span class="n">a</span> <span class="n">factor</span> <span class="n">of</span> <span class="mi">2</span> <span class="p">(</span><span class="n">default</span>
                        <span class="kc">False</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">prefix</span> <span class="n">PREFIX</span>       <span class="n">Prefix</span> <span class="k">for</span> <span class="n">co</span><span class="o">-</span><span class="n">added</span> <span class="n">spectra</span>
  <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">trace</span>           <span class="n">Include</span> <span class="n">result</span> <span class="n">plots</span> <span class="k">while</span> <span class="n">running</span> <span class="p">(</span><span class="n">default</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>The wfc3_all script simply runs all of the above WFC3 scripts in sequence.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="parameter_files.html" class="btn btn-neutral float-right" title="ABSCAL Data Files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../using_abscal.html" class="btn btn-neutral float-left" title="Using ABSCAL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Brian York.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>