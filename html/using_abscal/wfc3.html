

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ABSCAL WFC3 Scripts &mdash; abscal 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/stsci.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/stsci.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ABSCAL Handbook" href="../abscal_handbook.html" />
    <link rel="prev" title="ABSCAL Data Files" href="parameter_files.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
            <a href="../index.html" class="icon icon-home"> abscal
            
            <img src="../_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing ABSCAL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../using_abscal.html">Using ABSCAL</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../using_abscal.html#general-usage-notes">General Usage Notes</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="commands.html">ABSCAL Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameter_files.html">ABSCAL Data Files</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ABSCAL WFC3 Scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../abscal_handbook.html">ABSCAL Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abscal_idl_code.html">ABSCAL IDL Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abscal_testing.html">ABSCAL Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">ABSCAL Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">abscal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../using_abscal.html">Using ABSCAL</a> &raquo;</li>
        
      <li>ABSCAL WFC3 Scripts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/using_abscal/wfc3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="abscal-wfc3-scripts">
<h1>ABSCAL WFC3 Scripts<a class="headerlink" href="#abscal-wfc3-scripts" title="Permalink to this headline">¶</a></h1>
<p>This section describes using the ABSCAL WFC3 scripts as python modules. This allows for
greater customization than running the
<a class="reference external" href="./commands.html#wide-field-camera-3-wfc3">ABSCAL WFC3 command scripts</a>,
although it can also be slightly more complicated.</p>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#preprocess-table-create-py" id="id18"><code class="code docutils literal notranslate"><span class="pre">preprocess_table_create.py</span></code></a></p></li>
<li><p><a class="reference internal" href="#reduce-grism-coadd-py" id="id19"><code class="code docutils literal notranslate"><span class="pre">reduce_grism_coadd.py</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#adjustable-parameters" id="id20">Adjustable Parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reduce-grism-extract-py" id="id21"><code class="code docutils literal notranslate"><span class="pre">reduce_grism_extract.py</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id22">Adjustable Parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reduce-grism-wavelength-py" id="id23"><code class="code docutils literal notranslate"><span class="pre">reduce_grism_wavelength.py</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#wlmeas" id="id24"><code class="code docutils literal notranslate"><span class="pre">wlmeas</span></code></a></p></li>
<li><p><a class="reference internal" href="#wlmake" id="id25"><code class="code docutils literal notranslate"><span class="pre">wlmake</span></code></a></p></li>
<li><p><a class="reference internal" href="#id12" id="id26">Adjustable parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#util-filter-locate-image-py" id="id27"><code class="code docutils literal notranslate"><span class="pre">util_filter_locate_image.py</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#id13" id="id28">Adjustable Parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#util-grism-cross-correlate-py" id="id29"><code class="code docutils literal notranslate"><span class="pre">util_grism_cross_correlate.py</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#id15" id="id30">Adjustable Parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#notes" id="id31">Notes</a></p></li>
</ul>
</div>
<div class="section" id="preprocess-table-create-py">
<h2><a class="toc-backref" href="#id18"><code class="code docutils literal notranslate"><span class="pre">preprocess_table_create.py</span></code></a><a class="headerlink" href="#preprocess-table-create-py" title="Permalink to this headline">¶</a></h2>
<p>This module is designed to create an exposure metadata table, or append to an existing
metadata table. Its intended entry point is the <code class="code docutils literal notranslate"><span class="pre">populate_table()</span></code> function. It is
possible to customize the behaviour of this function by</p>
<ul class="simple">
<li><p>Adding a specific existing table using the <code class="code docutils literal notranslate"><span class="pre">data_table</span></code> keyword. This should be
used to start out the function with some existing exposures, although it <em>can</em> also be
used to customize the directory search path and the search pattern when creating the
table. Sending an empty table to <code class="code docutils literal notranslate"><span class="pre">populate_table()</span></code> is not recommended as a way to
set these values (the supported way is to send no table and to include the relevant
values as keyword arguments).</p></li>
<li><p>The function verbosity and IDL compatibility mode can be directly set by specifying the
relevant keywords.</p></li>
<li><p>The <code class="code docutils literal notranslate"><span class="pre">overrides</span></code> dictionary is included for compatibility, and to allow for
potential future expansion, but there are currently no defaults that can be overridden
by this dictionary.</p></li>
</ul>
<p>When running, the function makes use of</p>
<ul class="simple">
<li><p>Whatever file type (e.g. “flt”, “drz”, “ima”, “raw”) is specified in the template string.</p></li>
<li><p>The support (spt.fits) file, for determining scan rate. Without that file, all input
files will be interpreted as having a scan rate of zero.</p></li>
</ul>
<p>For more detail, <a class="reference external" href="../autoapi/abscal/wfc3/preprocess_table_create/index.html">see the preprocess_table_create API reference</a>.</p>
</div>
<div class="section" id="reduce-grism-coadd-py">
<h2><a class="toc-backref" href="#id19"><code class="code docutils literal notranslate"><span class="pre">reduce_grism_coadd.py</span></code></a><a class="headerlink" href="#reduce-grism-coadd-py" title="Permalink to this headline">¶</a></h2>
<p>This module is designed to group a list of grism exposures by program and visit and, for
each exposure in a given group, if there is not an extracted spectrum available for the
exposure, create one using <a class="reference internal" href="#reduce-grism-extract-py">reduce_grism_extract.py</a> <a class="footnote-reference brackets" href="#a" id="id1">1</a>. Once each exposure has an
extracted spectrum available, then for the group,</p>
<ul>
<li><p>Take all of the input exposures belonging to a particular group, and extract the
wavelength, net flux, flux error, fitted y position of the trace, data quality value of
the trace, background flux, gross flux, and exposure time, then store the
values in a set of 2D <code class="code docutils literal notranslate"><span class="pre">numpy</span></code> arrays, where the second axis represents the
individual exposures in the group.</p></li>
<li><p>Create a 2D mask array of the same size as the above arrays, and set it to 0 wherever
a pixel in one of the input arrays has a DQ value that should result in its exclusion,
where the corresponding DQ values are 4 (bad detector pixel), 8 (deviant bias value),
16 (hot pixel), 64 (warm pixel), 128 (bad reference pixel), and 256 (full-well
saturation) (see <a class="reference external" href="https://www.stsci.edu/itt/review/dhb_2011/WFC3/wfc3_Ch23.html">Chapter 23 of the WFC3 data handbook</a> for more information on data
quality flags).</p></li>
<li><p>Interpolate a net flux value for each single and double bad pixel, that is</p>
<blockquote>
<div><ul class="simple">
<li><p>For a single bad pixel with good pixels on either side of it, set that pixel’s flux
to the average of the two good pixels</p></li>
<li><p>For a pair of adjacent bad pixels with good pixels on either side of the pair, set
the flux of both pixels to the average of the two good pixels</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For each spectral order,</p>
<blockquote>
<div><ul class="simple">
<li><p>Check all spectra for whether they contain good data for that order <a class="footnote-reference brackets" href="#d" id="id2">4</a> and, if
none do, skip co-adding the order</p></li>
<li><p>Cross-correlate the order region of each spectrum against the first spectrum,
deriving the best fit with an offset of <span class="math notranslate nohighlight">\(&lt;2.7\)</span> pixels. If no offset can be
derived, if the offset derived is <span class="math notranslate nohighlight">\(\ge2.7\)</span> pixels, or if the joint coverage
of the two spectra is missing more than 1000 angstroms of the wavelength range
assigned to the order, the offset is set to 0 pixels.</p></li>
<li><p>A new wavelength array is created for each of the spectra consisting of its existing
wavelength array plus the derived offset multiplied by the dispersion at the central
wavelength of the order. For the first spectrum, this array is the same as its
existing array. If the <code class="code docutils literal notranslate"><span class="pre">-d</span></code> flag is set, then all spectra will have their
number of points doubled.</p></li>
<li><p>Each spectrum is interpolated to provide a new flux at the corrected wavelengths</p></li>
<li><p>For each of the data arrays above (net flux, flux error, etc.), a new array is
created that is the sum (or combination, in the case of error) of all the spectra
that had good data for that point. Interpolation is used to fill in points where
none of the spectra had good data, although those points remain flagged in the DQ
array.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>A final data array is created for each group, consisting of all the data points for
each spectral order, sorted so that the wavelengths are monotonically increasing. The
result is written out as a FITS file and an astropy table.</p></li>
</ul>
<p>For more detail, <a class="reference external" href="../autoapi/abscal/wfc3/reduce_grism_coadd/index.html">see the reduce_grism_coadd API reference</a>.</p>
<div class="section" id="adjustable-parameters">
<h3><a class="toc-backref" href="#id20">Adjustable Parameters</a><a class="headerlink" href="#adjustable-parameters" title="Permalink to this headline">¶</a></h3>
<p>The adjustable parameters for reduce_grism_coadd consist of a combination of default
values, command-line arguments, and output overrides corresponding to specific exposures.</p>
<div class="section" id="default-values">
<h4>Default Values<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h4>
<p>These are passed to the <code class="code docutils literal notranslate"><span class="pre">coadd()</span></code> function via the <code class="code docutils literal notranslate"><span class="pre">overrides</span></code> parameter,
which takes a python dictionary. The default parameter values are found in the
abscal.wfc3.data.defaults sub-module/directory, stored as a
<a class="reference external" href="./parameter_files.html">parameter file</a>. The parameters are:</p>
<dl class="simple">
<dt>width: float, default 22</dt><dd><p>The width of the cross-correlation search region. <a class="footnote-reference brackets" href="#f" id="id3">6</a></p>
</dd>
<dt>wbeg: float, default 7500 (G102) or 10,000 (G141)</dt><dd><p>The start value (in Angstroms) of the valid wavelength range for the (negative) first
order spectrum. For the second order, this value is doubled.</p>
</dd>
<dt>wend: float, default 11,800 (G102) or 17,500 (G141)</dt><dd><p>The end value (in Angstroms) of the valid wavelength range for the (negative) first
order spectrum. For the second order, this value is doubled.</p>
</dd>
<dt>regbeg_m1: float, default -13,500 (G102) or -19,000 (G141)</dt><dd><p>The start of the -1st order region, in Angstroms. <a class="footnote-reference brackets" href="#e" id="id4">5</a></p>
</dd>
<dt>regend_m1: float, default -3,800 (G102) or -5,100 (G141)</dt><dd><p>The end of the -1st order region, in Angstroms.</p>
</dd>
<dt>regbeg_p1: float, default -3,800 (G102) or -5,100 (G141)</dt><dd><p>The start of the 1st order region, in Angstroms.</p>
</dd>
<dt>regend_p1: float, default 13,500 (G102) or 19,000 (G141)</dt><dd><p>The end of the 1st order region, in Angstroms.</p>
</dd>
<dt>regbeg_p2: float, default 13,500 (G102) or 19,000 (G141)</dt><dd><p>The start of the 2nd order region, in Angstroms.</p>
</dd>
<dt>regend_p2: float, default 27,000 (G102) or 38,000 (G141)</dt><dd><p>The end of the 2nd order region, in Angstroms.</p>
</dd>
</dl>
</div>
<div class="section" id="command-line-arguments">
<h4>Command-line Arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h4>
<dl class="simple">
<dt>double: <code class="code docutils literal notranslate"><span class="pre">-d</span></code>, <code class="code docutils literal notranslate"><span class="pre">--double</span></code>, default False</dt><dd><p>Whether to double the number of points in the resampled spectra, and thus interpolate
the data to match.</p>
</dd>
</dl>
</div>
<div class="section" id="exposure-specific-overrides">
<h4>Exposure-specific Overrides<a class="headerlink" href="#exposure-specific-overrides" title="Permalink to this headline">¶</a></h4>
<p>Exposure-specific overrides for reduce_grism_coadd are found at
“abscal_base/wfc3/data/reduce_grism_coadd.yaml”.</p>
</div>
</div>
</div>
<div class="section" id="reduce-grism-extract-py">
<h2><a class="toc-backref" href="#id21"><code class="code docutils literal notranslate"><span class="pre">reduce_grism_extract.py</span></code></a><a class="headerlink" href="#reduce-grism-extract-py" title="Permalink to this headline">¶</a></h2>
<p>This module is designed to take a table of WFC3 IR grism exposures, and extract 1D spectra
of each exposure. The suggested entry point is the <code class="code docutils literal notranslate"><span class="pre">reduce</span></code> function, which loops
through the table and, for each grism exposure:</p>
<ul>
<li><p>If the exposure is scan mode, raise a <code class="code docutils literal notranslate"><span class="pre">NotImplemented</span></code> exception</p></li>
<li><p>If the exposure is stare mode,</p>
<blockquote>
<div><ul>
<li><p>If there is an associated filter exposure (i.e. a filter exposure taken as part of
the same program and visit, and with the same POSTARG), use the
<a class="reference internal" href="#util-filter-locate-image-py">util_filter_locate_image.py</a> module to find the target’s position on the detector,
and then use a hardcoded offset to estimate the position of the zeroth-order image.</p></li>
<li><p>If there is no filter exposure, or if the image could not be found on the filter
exposure, use the grism exposure’s WCS to estimate the location of the zeroth-order
image.</p></li>
<li><p>Find the zeroth-order image using a centroiding algorithm. If it can’t be found,
then the estimated position derived above will be used.</p></li>
<li><p>Assign an approximate mapping from x pixel value to wavelength.</p>
<blockquote>
<div><ul class="simple">
<li><p>If the zeroth-order image was found, use a mapping based on the zeroth-order
location (as described further in <a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2015/WFC3-2015-10.pdf">WFC3 ISR 2015-10</a>).</p></li>
<li><p>Otherwise, use an aXe-derived mapping discussed in <a class="reference external" href="https://www.stsci.edu/files/live/sites/www/files/home/hst/instrumentation/wfc3/documentation/instrument-science-reports-isrs/_documents/2016/WFC3-2016-15.pdf">WFC3 ISR 2016-15</a>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Subtract a scaled 2D flatfield</p></li>
<li><p>If the background/flatfield cube subtraction order is set to do the flatfield
subtraction first, scale and subtract a flatfield cube.</p></li>
<li><p>For each spectral order, use the wavelength/x pixel mapping derived above to create
a pixel search range for that order, and use an approximate slope specified as a
parameter to estimate the y location of that order. Collapse the resulting box along
the x direction, giving a 1D count rate profile. Fit the centre of that profile to
give a y location of the spectral order. Use the midpoint of the x range as the x
location of the order.</p></li>
<li><p>Using all of the found orders (including the zeroth order, if found), fit a linear
trace profile <a class="footnote-reference brackets" href="#g" id="id5">7</a></p></li>
<li><p>Extract background traces on either side of the target trace, and use them to create
a background spectrum</p></li>
<li><p>If the background/flatfield cube subtraction order is set to do the flatfield
subtraction second, scale and subtract a flatfield cube</p></li>
<li><p>Extract the gross and net count rates, background count rate, data quality flags
affecting the spectrum, exposure time, and weighted exposure time for the target
trace.</p></li>
<li><p>Create a FITS file with a bintable extension containing all of the 1D spectra
extracted, as well as header cards specifying the keywords used to obtain the
extractions.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>For more detail, <a class="reference external" href="../autoapi/abscal/wfc3/reduce_grism_extract/index.html">see the reduce_grism_extract API reference</a>.</p>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id22">Adjustable Parameters</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The adjustable parameters for reduce_grism_extract consist of a combination of default
values, command-line arguments, and output overrides corresponding to specific exposures.</p>
<div class="section" id="id7">
<h4>Default Values<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>These are passed to the <code class="code docutils literal notranslate"><span class="pre">reduce()</span></code> function via the <code class="code docutils literal notranslate"><span class="pre">overrides</span></code> parameter,
which takes a python dictionary. The default parameter values are found in the
abscal.wfc3.data.defaults sub-module/directory, stored as a
<a class="reference external" href="./parameter_files.html">parameter file</a>. The parameters are:</p>
<dl class="simple">
<dt>xc: float, default -1</dt><dd><p>X centre of zeroth order image. If set to a negative value, the submodule will find
and fit the centre itself, either from a corresponding filter exposure (preferred) or
from the grism exposure directly.</p>
</dd>
<dt>yc: float, default -1</dt><dd><p>The same as xc, but the Y centre.</p>
</dd>
<dt>xerr: float, default -1</dt><dd><p>Measured error in xc. Set when xc is set. Passed through to FITS header.</p>
</dd>
<dt>yerr: float, default -1</dt><dd><p>As xerr, but error in yc.</p>
</dd>
<dt>ywidth: int, default 11</dt><dd><p>Width of the extraction box at each x pixel.</p>
</dd>
<dt>y_offset: int, default 0</dt><dd><p>Offset of the initial spectral trace in the y direction. Added directly to the
approximate initial trace fit, before the actual trace is fit.</p>
</dd>
<dt>gwidth: int, default 6</dt><dd><p>Width of smoothing kernel for background smoothing</p>
</dd>
<dt>bwidth: int, default 13</dt><dd><p>Width of background extraction box at each x pixel</p>
</dd>
<dt>bmedian: int, default 7</dt><dd><p>Width of background median-smoothing region</p>
</dd>
<dt>bmean1: int, default 7</dt><dd><p>Width of first background boxcar-smoothing box</p>
</dd>
<dt>bmean2: int, default 7</dt><dd><p>Width of second background boxcar-smoothing box</p>
</dd>
<dt>bdist: int, default 25 + bwidth//2</dt><dd><p>Distance from spectral trace centre to background trace centres.</p>
</dd>
<dt>slope: float, default 1</dt><dd><p>Slope of spectral trace in radians. If this is set to a value other than its default
value, then the supplied value will be used in determining the trace, and the slope
will not be fit.</p>
</dd>
<dt>yshift: int, default 0</dt><dd><p>Offset to the initial spectral trace slope. Added directly to the approximate initial
trace fit, before the actual trace is fit.</p>
</dd>
<dt>ix_shift: float, default 252 (G102), 188 (G141)</dt><dd><p>Delta in the x direction from the target centroid in the imaging exposure to the
zeroth order centroid in the grism exposure.</p>
</dd>
<dt>iy_shift: float, default 4 (G102), 1 (G141)</dt><dd><p>As per ix_shift, but in the y direction</p>
</dd>
<dt>wl_offset: flot, default 0</dt><dd><p>Offset of the wavelength fit. Added directly to the fit.</p>
</dd>
<dt>wlrang_m1_low: float, default 8000 (G102), 10800 (G141)</dt><dd><p>Start of the -1st order wavelength range. <a class="footnote-reference brackets" href="#h" id="id9">8</a></p>
</dd>
<dt>wlrang_m1_high: float, default 10000 (G102), 16000 (G141)</dt><dd><p>End of the -1st order wavelength range.</p>
</dd>
<dt>wlrang_p1_low: float, default 8800 (G102), 10800 (G141)</dt><dd><p>Start of the 1st order wavelength range.</p>
</dd>
<dt>wlrang_p1_high: float, default 11000 (G102), 16000 (G141)</dt><dd><p>End of the 1st order wavelength range.</p>
</dd>
<dt>wlrang_p2_low: float, default 8000 (G102), 10000 (G141)</dt><dd><p>Start of the -1st order wavelength range.</p>
</dd>
<dt>wlrang_p2_high: float, default 10800 (G102), 13000 (G141)</dt><dd><p>End of the -1st order wavelength range.</p>
</dd>
</dl>
</div>
<div class="section" id="id10">
<h4>Command-line Arguments<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<dl class="simple">
<dt>bkg_flat_order: <code class="code docutils literal notranslate"><span class="pre">-b</span></code>, <code class="code docutils literal notranslate"><span class="pre">--bkg_flat_order</span></code>, default “flat_first”</dt><dd><p>Whether to subtract a scaled flatfield cube before or after fitting and subtracting
the detector background. Options are “flat_first” to flatfield before background
subtraction, “bkg_first” to do background subtraction before flatfielding, and
“bkg_only” to not do flatfielding at all. <em>NOTE</em> that this flag does not affect the
2D scaled flatfield subtraction, which always occurs and always happens before either
background subtraction or cube flatfield subtraction.</p>
</dd>
</dl>
</div>
<div class="section" id="id11">
<h4>Exposure-specific Overrides<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>Exposure-specific overrides for reduce_grism_coadd are found at
“abscal_base/wfc3/data/reduce_grism_extract.yaml”.</p>
</div>
</div>
</div>
<div class="section" id="reduce-grism-wavelength-py">
<h2><a class="toc-backref" href="#id23"><code class="code docutils literal notranslate"><span class="pre">reduce_grism_wavelength.py</span></code></a><a class="headerlink" href="#reduce-grism-wavelength-py" title="Permalink to this headline">¶</a></h2>
<p>This module has two central functions, <code class="code docutils literal notranslate"><span class="pre">wlmeas()</span></code> and <code class="code docutils literal notranslate"><span class="pre">wlmake()</span></code>, which will
be discussed separately.</p>
<div class="section" id="wlmeas">
<h3><a class="toc-backref" href="#id24"><code class="code docutils literal notranslate"><span class="pre">wlmeas</span></code></a><a class="headerlink" href="#wlmeas" title="Permalink to this headline">¶</a></h3>
<p>This function takes a table of exposures, selects those that are marked as being grism
exposures of planetary nebulae (PN), and uses them to produce a final wavelength scale for
WFC3 IR grism exposures. It does this by:</p>
<ul>
<li><p>Taking a list of emission lines found in PN spectra</p></li>
<li><p>For each PN exposure,</p>
<blockquote>
<div><ul>
<li><p>For each spectral order present on the detector,</p>
<blockquote>
<div><ul class="simple">
<li><p>Identifying the emission lines that are found within that spectral order</p></li>
<li><p>Using the wavelength scale from <a class="reference internal" href="#reduce-grism-extract-py">reduce_grism_extract.py</a> to find the
approximate pixel location of that line</p></li>
<li><p>Taking the net spectrum in the line-finding region, and making a flux-weighted
centroid of the region</p></li>
<li><p>If a successful fit is found, letting the user approve, modify, or reject it</p></li>
<li><p>If no fit is found, letting the user add one if desired</p></li>
<li><p>Recording the fit location (or the centre of the search region if there was no
successful fit) to an output table</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Once all of the exposures have had all of their emission line fits recorded, the output
table is written out in astropy format.</p>
</div>
<div class="section" id="wlmake">
<h3><a class="toc-backref" href="#id25"><code class="code docutils literal notranslate"><span class="pre">wlmake</span></code></a><a class="headerlink" href="#wlmake" title="Permalink to this headline">¶</a></h3>
<p>This function takes the same input table of exposures as <a class="reference internal" href="#wlmeas">wlmeas</a>, as well as the output
table produced by <a class="reference internal" href="#wlmeas">wlmeas</a>, and derives a wavelength fit based on a pixel’s location
relative to the centre of the zeroth-order image. It derives a separate fit for each order
of each grism, and records the fit parameters to an output table.</p>
<p>For more detail, <a class="reference external" href="../autoapi/abscal/wfc3/reduce_grism_wavelength/index.html">see the reduce_grism_wavelength API reference</a>.</p>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id26">Adjustable parameters</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Neither function currently has any adjustable parameters.</p>
</div>
</div>
<div class="section" id="util-filter-locate-image-py">
<h2><a class="toc-backref" href="#id27"><code class="code docutils literal notranslate"><span class="pre">util_filter_locate_image.py</span></code></a><a class="headerlink" href="#util-filter-locate-image-py" title="Permalink to this headline">¶</a></h2>
<p>This module locates the target centroid in imaging exposures. The main entry point
function, <code class="code docutils literal notranslate"><span class="pre">locate_image()</span></code>, takes a table of exposures, filters out any non-imaging
exposures and, for each exposure,</p>
<ul>
<li><p>Take the image data, and set the edges of the image to zero.</p></li>
<li><p>Use the image WCS and the target co-ordinates (corrected for proper motion if the target
was recognized as a standard star) to predict the target location on the detector</p></li>
<li><p>If the target was not close to the edge of the detector,</p>
<blockquote>
<div><ul class="simple">
<li><p>Set the image data to zero except for a small region around the predicted location</p></li>
<li><p>Median-filter the image with a 3-pixel kernel</p></li>
<li><p>Take an even small region of the image around the brightest pixel in the smoothed
image</p></li>
<li><p>Subtract the median value of the small region from the region</p></li>
<li><p>Subtract 1/5 of the brightest pixel value from the region</p></li>
<li><p>Set any pixels with negative values to zero</p></li>
<li><p>Create two image profiles, one collapsed along the X axis and the other collapsed
along the Y axis</p></li>
<li><p>Produce a flux-weighted mean value for each profile, and set the target pixel
position to those values</p></li>
<li><p>Set the error values to <span class="math notranslate nohighlight">\(\rm{pos}_{found} - \rm{pos}_{predicted}\)</span>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If the target was close to the detector edge, or not found, return “-1” as co-ordinates.</p></li>
<li><p>Return the image co-ordinates and image error values.</p></li>
</ul>
<p>For more detail, <a class="reference external" href="../autoapi/abscal/wfc3/util_filter_locate_image/index.html">see the util_filter_locate_image API reference</a>.</p>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id28">Adjustable Parameters</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>The adjustable parameters for util_filter_locate_image consist of a pair of default
values.</p>
<div class="section" id="id14">
<h4>Default Values<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>These are passed to the <code class="code docutils literal notranslate"><span class="pre">locate_image()</span></code> function via the <code class="code docutils literal notranslate"><span class="pre">overrides</span></code>
parameter,  which takes a python dictionary. The default parameter values are zero. The
parameters are:</p>
<dl class="simple">
<dt>xstar: float, default 0</dt><dd><p>The predicted star x position. 0 means unknown.</p>
</dd>
<dt>ystar: float, default 0</dt><dd><p>The predicted star y position. 0 means unknown.</p>
</dd>
</dl>
<p>If either of these values is set to something other than zero, the WCS fitting part of the
function will not be run, and the provided values will be treated as the predicted
position.</p>
</div>
</div>
</div>
<div class="section" id="util-grism-cross-correlate-py">
<h2><a class="toc-backref" href="#id29"><code class="code docutils literal notranslate"><span class="pre">util_grism_cross_correlate.py</span></code></a><a class="headerlink" href="#util-grism-cross-correlate-py" title="Permalink to this headline">¶</a></h2>
<p>This module cross-correlates two spectra. The entry point function,
<code class="code docutils literal notranslate"><span class="pre">cross_correlate()</span></code> takes two spectra and computes a correlation coefficient for
every shift within a provided width, then returns the maximum signal value along with an
array of values.</p>
<p>For more detail, <a class="reference external" href="../autoapi/abscal/wfc3/util_grism_cross_correlate/index.html">see the util_grism_cross_correlate API reference</a>.</p>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id30">Adjustable Parameters</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>The adjustable parameters for util_grism_cross_correlate consist of a set of default
values.</p>
<div class="section" id="id16">
<h4>Default Values<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>These are passed to the <code class="code docutils literal notranslate"><span class="pre">cross_correlate()</span></code> function via the <code class="code docutils literal notranslate"><span class="pre">overrides</span></code>
parameter,  which takes a python dictionary.  The default parameter values are found in
the abscal.wfc3.data.defaults sub-module/directory, stored as a
<a class="reference external" href="./parameter_files.html">parameter file</a>. The parameters are:</p>
<dl class="simple">
<dt>ishift: int, default 0</dt><dd><p>Approximate initial shift. The correlation search will start here. This value will
also be added to the final fit.</p>
</dd>
<dt>width: int, default 15</dt><dd><p>Size (in pixels) of the correlation search region</p>
</dd>
<dt>i1: int, default 0</dt><dd><p>First pixel of the spectrum to use in correlation search</p>
</dd>
<dt>i2: int, default <code class="code docutils literal notranslate"><span class="pre">len(first_spectrum)-1</span></code></dt><dd><p>Last pixel of the spectrum to use in correlation search.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="notes">
<h2><a class="toc-backref" href="#id31">Notes</a><a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="a"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Before extracting a spectrum, the script will look in its output location to see
if a spectrum with the appropriate name already exists. By default, if one does exist,
it will use that spectrum instead of performing a new extraction. The <code class="code docutils literal notranslate"><span class="pre">-f</span></code> flag
will force the script to create a new extracted spectrum even if one already exists.</p>
</dd>
<dt class="label" id="b"><span class="brackets">2</span></dt>
<dd><p>And if the associated FITS file can be found, and if the target is on the detector
in the imaging exposure.</p>
</dd>
<dt class="label" id="c"><span class="brackets">3</span></dt>
<dd><p>The average exposure time is the image exposure time multiplied by the number of
pixels extracted in a given column (i.e. the number of pixels without DQ flags that
would prevent their being added to the extraction), and divided by the total number of
pixels in the extraction box for that column.</p>
</dd>
<dt class="label" id="d"><span class="brackets"><a class="fn-backref" href="#id2">4</a></span></dt>
<dd><p>In order to check whether an input file has data in an order’s spectral range,</p>
<ul class="simple">
<li><p>Define a spectral range for the order based on the <code class="code docutils literal notranslate"><span class="pre">wbeg</span></code> and <code class="code docutils literal notranslate"><span class="pre">wend</span></code>
parameters, where <span class="math notranslate nohighlight">\(\rm{start} = \rm{wbeg}*\rm{order}\)</span>,
<span class="math notranslate nohighlight">\(\rm{end} = \rm{wend}*\rm{order}\)</span>, and
<span class="math notranslate nohighlight">\(\rm{range} = \rm{end} - \rm{start}\)</span>.</p></li>
<li><p>Define a central range as <span class="math notranslate nohighlight">\(\rm{start}_c = \rm{start} + 0.14 * \rm{range}\)</span>, and
<span class="math notranslate nohighlight">\(\rm{end}_c = \rm{end} - 0.14 * \rm{range}\)</span></p></li>
<li><p>Define a file as having data in the range if its maximum wavelength is <span class="math notranslate nohighlight">\(\ge\)</span>
<span class="math notranslate nohighlight">\(\rm{end}_c\)</span>, and its minimum wavelength is <span class="math notranslate nohighlight">\(\le\)</span> <span class="math notranslate nohighlight">\(\rm{start}_c\)</span></p></li>
</ul>
<p>Files that do not have data in the range are simply not included when creating the
co-added values for that particular order.</p>
</dd>
<dt class="label" id="e"><span class="brackets"><a class="fn-backref" href="#id4">5</a></span></dt>
<dd><p>These regions are used to divide the overall spectrum into three (-1st order,
1st order, and 2nd order). A wavelength being in a particular region does not mean that
the wavelength is a valid part of that spectral order (i.e. a wavelength at which the
grism has non-zero throughput for that order).</p>
</dd>
<dt class="label" id="f"><span class="brackets"><a class="fn-backref" href="#id3">6</a></span></dt>
<dd><p>This parameter is passed directly through to <a class="reference internal" href="#util-grism-cross-correlate-py">util_grism_cross_correlate.py</a>, and
is not used directly in co-adding.</p>
</dd>
<dt class="label" id="g"><span class="brackets"><a class="fn-backref" href="#id5">7</a></span></dt>
<dd><p>It is possible to set the <code class="code docutils literal notranslate"><span class="pre">slope</span></code> parameter in order to bypass the trace
fitting and use a supplied angle instead.</p>
</dd>
<dt class="label" id="h"><span class="brackets"><a class="fn-backref" href="#id9">8</a></span></dt>
<dd><p>All of the keywords in this form are multiplied by the current order before use,
so the actual values are correct only for the 1st order.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../abscal_handbook.html" class="btn btn-neutral float-right" title="ABSCAL Handbook" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="parameter_files.html" class="btn btn-neutral float-left" title="ABSCAL Data Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Brian York.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>