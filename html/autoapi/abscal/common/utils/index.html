

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>abscal.common.utils &mdash; abscal 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/stsci.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/stsci.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="abscal.extern" href="../../extern/index.html" />
    <link rel="prev" title="abscal.common.standard_stars" href="../standard_stars/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
            <a href="../../../../index.html" class="icon icon-home"> abscal
            
            <img src="../../../../_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installing ABSCAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_abscal.html">Using ABSCAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../abscal_handbook.html">ABSCAL Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../abscal_idl_code.html">ABSCAL IDL Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../abscal_testing.html">ABSCAL Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">ABSCAL Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">abscal</span></code></a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html#subpackages">Subpackages</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">abscal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">API Reference</a> &raquo;</li>
        
          <li><a href="../../index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">abscal</span></code></a> &raquo;</li>
        
          <li><a href="../index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">abscal.common</span></code></a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">abscal.common.utils</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/autoapi/abscal/common/utils/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-abscal.common.utils">
<span id="abscal-common-utils"></span><h1><a class="reference internal" href="#module-abscal.common.utils" title="abscal.common.utils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">abscal.common.utils</span></code></a><a class="headerlink" href="#module-abscal.common.utils" title="Permalink to this headline">¶</a></h1>
<p>This module includes general utility functions.</p>
<div class="section" id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Brian York</p></li>
</ul>
</div>
<div class="section" id="use">
<h2>Use<a class="headerlink" href="#use" title="Permalink to this headline">¶</a></h2>
<p>Individual functions from this module are intended to be imported where
needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abscal.common.utils</span> <span class="kn">import</span> <span class="n">absdate</span>
</pre></div>
</div>
</div>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline">¶</a></h2>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#abscal.common.utils.absdate" title="abscal.common.utils.absdate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">absdate</span></code></a>(pstrtime)</p></td>
<td><p>Get the date in decimal years.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#abscal.common.utils.get_base_data_dir" title="abscal.common.utils.get_base_data_dir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_base_data_dir</span></code></a>()</p></td>
<td><p>Find the location of the ABSCAL data files.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#abscal.common.utils.get_data_file" title="abscal.common.utils.get_data_file"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_data_file</span></code></a>(module, fname, defaults=False)</p></td>
<td><p>Find an internal data file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#abscal.common.utils._extract_dict" title="abscal.common.utils._extract_dict"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_extract_dict</span></code></a>(input_dict, output_dict, input_keys)</p></td>
<td><p>Recursively extract values from a defaults dictionary.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#abscal.common.utils.get_defaults" title="abscal.common.utils.get_defaults"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_defaults</span></code></a>(module, *args)</p></td>
<td><p>Find an internal defaults data file, load it using YAML, and return the resulting</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#abscal.common.utils.set_param" title="abscal.common.utils.set_param"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_param</span></code></a>(param, default, row, issues, pre, overrides={}, verbose=False)</p></td>
<td><p>Set a parameter value</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#abscal.common.utils.set_params" title="abscal.common.utils.set_params"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_params</span></code></a>(defaults, row, issues, pre, overrides={}, verbose=False)</p></td>
<td><p>Set multiple parameter values</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#abscal.common.utils.set_image" title="abscal.common.utils.set_image"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_image</span></code></a>(images, row, issues, pre, overrides={}, verbose=False)</p></td>
<td><p>Update an image based on known issues.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#abscal.common.utils.air2vac" title="abscal.common.utils.air2vac"><code class="xref py py-obj docutils literal notranslate"><span class="pre">air2vac</span></code></a>(air)</p></td>
<td><p>Convert a set of wavelengths from air to vacuum.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#abscal.common.utils.smooth_model" title="abscal.common.utils.smooth_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smooth_model</span></code></a>(wave, flux, fwhm)</p></td>
<td><p>Smooth a model spectrum with a non-uniform sampling interval.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#abscal.common.utils.trapezoidal" title="abscal.common.utils.trapezoidal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trapezoidal</span></code></a>(wave, flux, wmin, wmax)</p></td>
<td><p>Make a trapezoidal integral</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#abscal.common.utils.integral" title="abscal.common.utils.integral"><code class="xref py py-obj docutils literal notranslate"><span class="pre">integral</span></code></a>(x, y, xmin, xmax)</p></td>
<td><p>Return the approximate integral of y over x for the range (xmin, xmax)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#abscal.common.utils.tabinv" title="abscal.common.utils.tabinv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tabinv</span></code></a>(xarr, x)</p></td>
<td><p>Find the effective index in xarr of each element in x.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#abscal.common.utils.linecen" title="abscal.common.utils.linecen"><code class="xref py py-obj docutils literal notranslate"><span class="pre">linecen</span></code></a>(wave, spec, cont)</p></td>
<td><p>Find the centre of an emission line.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.absdate">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">absdate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pstrtime</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.absdate" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the date in decimal years.</p>
<p>This is used to figure out a target position, given that we have the target
co-ordinates, the co-ordinate epoch, the annual proper motion, and the observation
time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>pstrtime</strong> (<em>str</em><em> or </em><em>Time</em><em> or </em><em>datetime</em>) – The observation start time</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>dt</strong> – The observation year + fractional (decimal) year</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.get_base_data_dir">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">get_base_data_dir</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.get_base_data_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the location of the ABSCAL data files.</p>
<p>ABSCAL stores both default parameters and exposure-specific corrections and settings
in a number of data files. There are default copies stored internally, but they can
also be stored elsewhere. The ABSCAL_DATA environment variable points to that
location, although there is always a fallback to local data if a specified file does
not exist elsewhere.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>data_dir</strong> – The directory pointed to by ABSCAL_DATA (if both the environment variable and
the directory to which it points exist)</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.get_data_file">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">get_data_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.get_data_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Find an internal data file.</p>
<p>Returns the path to a file named <cite>fname</cite> in the data directory of the
(sub)module named <cite>module</cite>. Keeps there from being a lot of repetitive code in order
to find data file paths.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module</strong> (<em>str</em>) – The module to search in, using standard dot separators (e.g.
abscal.wfc3)</p></li>
<li><p><strong>fname</strong> (<em>str</em>) – The file name of interest</p></li>
<li><p><strong>defaults</strong> (<em>bool</em><em>, </em><em>default False</em>) – Whether to append a “defaults” directory to the final path</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data_file</strong> – Full path to the data file. If no file is found at the generated path, None will
be returned. This is not necessarily a failure state, because (for example) a
function may call for a known-issues file even though there are no current known
issues (and thus no file to return). This way, the code doesn’t need to be
changed when there <em>is</em> a file, and a user can add a file to their local directory
without needing to alter the code, because the code will just transparently find
the file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils._extract_dict">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">_extract_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils._extract_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively extract values from a defaults dictionary.</p>
<p>A defaults dictionary consists of:</p>
<ul class="simple">
<li><p>an optional “all” key</p></li>
<li><p>zero or more other keys, each of whose values is a defaults dictionary</p></li>
</ul>
<p>The goal is to add any matching values to an output dictionary, with more specific
matching values overriding less specific matching values. As such, given an input
dictionary and a list of keywords,</p>
<ul class="simple">
<li><p>Add all key/value pairs from the “all” dictionary (if present) to the output
dictionary.</p></li>
<li><p>For each keyword in the list, if that keyword is in the dictionary, call this
function recursively on the value of that key, which is (see above) a dictionary.</p></li>
<li><p>Don’t check on whether a value already exists in the output dictionary, because
more-specific overrides less-specific (if you need a default for a specific value to
definitely override a more general default, nest that value as a keyword inside the
more general dictionary).</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dict</strong> (<em>dict</em>) – The dictionary to search</p></li>
<li><p><strong>output_dict</strong> (<em>dict</em>) – The dictionary to build from</p></li>
<li><p><strong>input_keys</strong> (<em>list</em>) – A list of keys to search for</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>output_dict</strong> – The edited output dictionary</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.get_defaults">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">get_defaults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.get_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Find an internal defaults data file, load it using YAML, and return the resulting
dictionary.</p>
<p>Takes the dot-separated module path (e.g. “abscal.wfc3.reduce_grism_extract”), splits
off the last item (e.g. [“abscal.wfc3”, “reduce_grism_extract”]), adds “.yaml” to the
end of the second item (e.g. [“abscal.wfc3”, “reduce_grism_extract.yaml”]), adds
“.defaults” to the first item
(e.g. [“abscal.wfc3.defaults”, “reduce_grism_extract.yaml”]), and feeds the result
into <code class="code docutils literal notranslate"><span class="pre">get_data_file()</span></code>. Then loads the resulting file as a dictionary, and
builds a new dictionary consisting of:</p>
<ul class="simple">
<li><p>All key/value pairs in the “all” dictionary</p></li>
<li><p>All key/value pairs in any dictionary matching any of the keyword arguments</p></li>
<li><p>The above two items from any dictionary matching any of the keyword arguments,
extending recursively into the depths of the dictionary.</p></li>
</ul>
<p>The result will be a flat (i.e. single-level) dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module</strong> (<em>str</em>) – The module to search in, using standard dot separators (e.g. abscal.wfc3)</p></li>
<li><p><strong>args</strong> (<em>list</em>) – A list of specific keyword arguments, provided to ensure the inclusion of
specific sub-values or sub-dictionaries.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>defaults</strong> – Dictionary of default parameters.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.set_param">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">set_param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">issues</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overrides</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.set_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a parameter value</p>
<p>Given a parameter name, that parameter’s default value, a data table
row, and a JSON dictionary which may have an entry for the current row that
will override the parameter, return the parameter value that should be used.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>param</strong> (<em>str</em>) – The parameter to check and return</p></li>
<li><p><strong>default</strong> (<em>object</em>) – The default value for that parameter</p></li>
<li><p><strong>row</strong> (<a class="reference internal" href="../exposure_data_table/index.html#abscal.common.exposure_data_table.AbscalDataTable" title="abscal.common.exposure_data_table.AbscalDataTable"><em>abscal.common.exposure_data_table.AbscalDataTable</em></a>) – A single-row table containing the data of interest.</p></li>
<li><p><strong>issues</strong> (<em>dict</em>) – A dictionary containing a set of parameters (one of which may be
param), along with information to identify files whose parameters
should be adjusted .</p></li>
<li><p><strong>overrides</strong> (<em>dict</em>) – A dictionary containing any parameters whose value is being overridden
by the user.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Whether or not informational output should be printed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>value</strong> – The appropriate value for the parameter given</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.set_params">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">set_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">defaults</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">issues</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overrides</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.set_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Set multiple parameter values</p>
<p>Given a dictionary of default values, a metadata row, a dictionary of
known issues and overrides, a dictionary of user-supplied overrides,
and a verbose flag, produce a dictionary of parameters (all with the
appropriate value) which also contains a ‘set’ key (an array of all
the parameters that have been overridden from their default values).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>defaults</strong> (<em>dict</em>) – A dictionary of default values (also names the parameters)</p></li>
<li><p><strong>row</strong> (<a class="reference internal" href="../exposure_data_table/index.html#abscal.common.exposure_data_table.AbscalDataTable" title="abscal.common.exposure_data_table.AbscalDataTable"><em>abscal.common.exposure_data_table.AbscalDataTable</em></a>) – A single-row table containing the data of interest.</p></li>
<li><p><strong>issues</strong> (<em>dict</em>) – A dictionary containing a set of parameters, along with information to
identify files whose parameters should be adjusted.</p></li>
<li><p><strong>overrides</strong> (<em>dict</em>) – A dictionary containing any parameters whose value is being overridden
by the user.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Whether or not informational output should be printed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>params</strong> – The supplied parameters, each with its value.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.set_image">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">set_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">issues</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overrides</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.set_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Update an image based on known issues.</p>
<p>Given an image, image metadata, and a set of known issues, determine if any
of the known issues apply to the image in question and, if they do, make
the appropriate edits to the image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images</strong> (<em>dict</em>) – Dict of (SCI, ERR, DQ) np.ndarray images</p></li>
<li><p><strong>row</strong> (<a class="reference internal" href="../exposure_data_table/index.html#abscal.common.exposure_data_table.AbscalDataTable" title="abscal.common.exposure_data_table.AbscalDataTable"><em>abscal.common.exposure_data_table.AbscalDataTable</em></a>) – A single-row table containing metadata on the image</p></li>
<li><p><strong>issues</strong> (<em>dict</em>) – A dictionary containing a set of parameters, along with information to
identify files whose parameters should be adjusted.</p></li>
<li><p><strong>overrides</strong> (<em>dict</em>) – A dictionary containing any parameters whose value is being overridden
by the user.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Whether or not informational output should be printed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>image</strong> – Tuple of (SCI, ERR, DQ) np.ndarray images, as edited.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.air2vac">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">air2vac</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">air</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.air2vac" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a set of wavelengths from air to vacuum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>air</strong> (<em>array-like</em>) – Air wavelengths</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>vac</strong> – Vacuum wavelengths</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array-like</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.smooth_model">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">smooth_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.smooth_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Smooth a model spectrum with a non-uniform sampling interval.</p>
<p>Based on Ralph Bohlin’s “smomod.pro”, which itself references “tin.pro”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wave</strong> (<em>array-like</em>) – Wavelength array</p></li>
<li><p><strong>flux</strong> (<em>array-like</em>) – Flux array</p></li>
<li><p><strong>fwhm</strong> (<em>float</em>) – FWHM of delta function.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>smoothed</strong> – Smoothed flux array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array-like</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.trapezoidal">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">trapezoidal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wmin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wmax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.trapezoidal" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a trapezoidal integral</p>
<p>Trapezoidal ‘integral’ (really an average) from Ralph Bohlin’s ‘tin.pro’
and ‘integral.pro’. Uses wmin and wmax to set limits</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wave</strong> (<em>array-like</em>) – Wavelength array</p></li>
<li><p><strong>flux</strong> (<em>array-like</em>) – Flux array</p></li>
<li><p><strong>wmin</strong> (<em>array-like</em>) – Wavelength array shifted bluewards by FWHM/2</p></li>
<li><p><strong>wmax</strong> (<em>array-like</em>) – Wavelength array shifted redwards by FWHM/2</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>trapint</strong> – Flux array after trapezoidal integral</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array-like</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.integral">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">integral</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xmin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xmax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.integral" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the approximate integral of y over x for the range (xmin, xmax)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em>) – X value array</p></li>
<li><p><strong>y</strong> (<em>array-like</em>) – Y value array. Must be the same length as x</p></li>
<li><p><strong>xmin</strong> (<em>float</em>) – minimum x value for integral</p></li>
<li><p><strong>xmax</strong> (<em>float</em>) – maximum x value for integral</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>int</strong> – integral value</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.tabinv">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">tabinv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xarr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.tabinv" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the effective index in xarr of each element in x.</p>
<p>The effective index for each element j in x is the value i such that
<span class="math notranslate nohighlight">\(xarr[i] &lt;= x[j] &lt;= xarr[i+1]\)</span>, to which is added an interpolation fraction
based on the size of the intervals in xarr.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_arr</strong> (<em>array-like</em>) – The array of values to search</p></li>
<li><p><strong>x</strong> (<em>float</em><em> or </em><em>array-like</em>) – Value (or list of values) to look for in x_arr</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ieff</strong> – Effective index</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="abscal.common.utils.linecen">
<span class="sig-prename descclassname"><span class="pre">abscal.common.utils.</span></span><span class="sig-name descname"><span class="pre">linecen</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wave</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cont</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#abscal.common.utils.linecen" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the centre of an emission line.</p>
<p>Computes the centroid of an emission line over the range of</p>
<dl class="field-list simple">
<dt class="field-odd">Math</dt>
<dd class="field-odd"><p>xapprox pm fwhm/2</p>
</dd>
</dl>
<p>after subtracting any continuum and half value at the remaining peak. After
clipping at zero, the weights of the remaining spectral wings approach zero,
so any marginally missed or included point matters little.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wave</strong> (<em>np.ndarray</em>) – 1-d array of x values</p></li>
<li><p><strong>spec</strong> (<em>np.ndarray</em>) – 1-d array of y values</p></li>
<li><p><strong>cont</strong> (<em>float</em>) – Approximate continuum value</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>centroid</strong> (<em>float</em>) – The x value of the centroid</p></li>
<li><p><strong>badflag</strong> (<em>bool</em>) – False for good data, true for bad data</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../../extern/index.html" class="btn btn-neutral float-right" title="abscal.extern" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../standard_stars/index.html" class="btn btn-neutral float-left" title="abscal.common.standard_stars" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Brian York.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>